<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chi Ti·∫øt L·ªô Tr√¨nh - H·ªçc T·∫≠p Th√¥ng Minh</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
        <script>
    const tokeen = localStorage.getItem('token');
    if(!tokeen) {alert('Vui l√≤ng ƒëƒÉng nh·∫≠p!');window.location.href = 'login.html';}
  </script>
  <style>
            :root {
        --primary:#007bff;
        --primary-dark: #1e6fe6;
        --muted: #6b7280;
        --bg: #f5f8fb;
        --header-height: 80px;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', sans-serif; background: #f5f7fa; color: #1f2937; }

    /* Header - replaced with fixed-bar styles */
    .fixed-bar { position: fixed; top: 0; left: 0; width: 100%; height: 80px; background: #007bff; box-shadow: 0 2px 6px rgba(0,0,0,0.15); z-index: 1000; }
    .bar-inner {
        max-width: 1200px;
        height: 100%;
        margin: 0 auto;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 20px;
        box-sizing: border-box;
    }

    .brand {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .brand-icon {
        width: 48px;
        height: 48px;
        background: rgba(255,255,255,0.2);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 22px;
        flex-shrink: 0;
    }

    .brand-text {
        display: flex;
        flex-direction: column;
    }

    .brand-title {
        color: white;
        font-size: 20px;
        font-weight: 700;
    }

    .brand-sub {
        color: rgba(255,255,255,0.9);
        font-size: 12px;
        font-weight: 600;
    }

    .nav-buttons {
        display: flex;
        gap: 22px;
        align-items: center;
    }

    .nav-btn {
        background: none;
        color: #fff;
        padding: 0;
        font-size: 15px;
        font-weight: 600;
        border-radius: 9999px;
    }

    .nav-btn .fa {
        margin-right: 8px;
        opacity: 0.95;
    }


    button {
        font-family: 'Inter', sans-serif;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        border: none;
        border-radius: 9999px;
        padding: 10px 20px;
        font-size: 15px;
        font-weight: 600;
    }

    .userInfo {
        color: white;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .login-btn {
        background: white;
        color: #333;
        box-shadow: 0 2px 5px rgba(0,0,0,0.12);
    }

    .login-btn:hover {
        background: #f0f0f0;
    }

    .register-btn {
        background: #28a745;
        color: white;
        box-shadow: 0 2px 5px rgba(0,0,0,0.12);
    }

    .register-btn:hover {
        background: #218838;
    }

    .logout-btn {
        background: linear-gradient(135deg, #4b0ee5 0%, #0682d4 100%);
        color: white;
        box-shadow: 0 2px 5px rgba(0,0,0,0.12);
    }

    .toApp-btn {
        background: #000;
        color: white;
        box-shadow: 0 2px 5px rgba(0,0,0,0.12);
    }

    .admin-btn {
        background: #6f42c1;
        color: white;
        box-shadow: 0 2px 5px rgba(0,0,0,0.12);
    }
html, body {
      height: 100%;
      margin: 0;
    }

    body {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      overflow-x: hidden;
    }
.page-offset {
  flex: 1 0 auto;  /* Ph·∫ßn n·ªôi dung ch√≠nh s·∫Ω chi·∫øm h·∫øt kh√¥ng gian, ƒë·∫©y footer xu·ªëng d∆∞·ªõi */
  box-sizing: border-box;
  padding-top: 100px;  /* Gi·ªØ nguy√™n padding ƒë·ªÉ tr√°nh ch·ªìng header fixed */
}

    /* (rest of styles same as previous roadmap_details) */
    .analysis-section { background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); padding: 30px; border-radius: 16px; margin-bottom: 30px; border-left: 5px solid #10b981; }
    .analysis-section h3 { color: #065f46; margin-bottom: 15px; font-size: 1.3rem; }
    .analysis-content { color: #374151; line-height: 1.8; white-space: pre-wrap; }
    .roadmap-section h3 { color: #1f2937; margin-bottom: 20px; font-size: 1.3rem; }
    table { width: 100%; border-collapse: collapse; background: white; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-radius: 12px; overflow: hidden; margin-bottom: 40px; }
    thead { background: linear-gradient(135deg, #007bff, #1e40af); color: white; position: sticky; top: 0; z-index: 10; }
    th { padding: 15px; text-align: left; font-weight: 600; font-size: 0.9rem; }
    td { padding: 15px; border-bottom: 1px solid #e5e7eb; vertical-align: top; }
    tbody tr:hover { background: #f9fafb; }
    .day-cell { text-align: center; font-weight: 700; color: #007bff; background: #f0f9ff; }

    .breadcrumb { max-width: 1200px; margin: 24px auto 0; padding: 0 24px; display: flex; align-items: center; gap: 8px; font-size: 14px; color: #6b7280; }
    .breadcrumb a { color: #6b7280; text-decoration: none; }
    .breadcrumb a:hover { color: #007bff; }
    .container { max-width: 1200px; margin: 32px auto 80px; padding: 0 24px; }
    .roadmap-overview { background: white; border-radius: 20px; padding: 40px; margin-bottom: 32px; box-shadow: 0 4px 12px rgba(0,0,0,0.06); }
    .overview-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 24px; gap: 24px; }
    .overview-title h1 { font-size: 36px; font-weight: 700; margin-bottom: 16px; line-height: 1.2; }
    .overview-badges { display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 20px; }
    .badge { padding: 8px 16px; border-radius: 10px; font-size: 13px; font-weight: 700; display: inline-flex; align-items: center; gap: 6px; }
    .badge-level { background: #dbeafe; color: #1e40af; }
    .badge-duration { background: #dcfdf4; color: #065f46; }
    .badge-learners { background: #fef3c7; color: #92400e; }
    .overview-stats { display: grid; grid-template-columns: repeat(5, 1fr); gap: 24px; padding-top: 24px; border-top: 2px solid #e5e7eb; }
    .stat-box { text-align: center; }
    .stat-value { font-size: 32px; font-weight: 700; color: #007bff; display: block; margin-bottom: 8px; }
    .stat-label { font-size: 14px; color: #6b7280; font-weight: 500; }
    .rating-box { display: flex; align-items: center; gap: 8px; font-size: 24px; }
    .rating-stars { color: #fbbf24; }
    .days-section { margin-top: 32px; }
    .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
    .section-header h2 { font-size: 28px; font-weight: 700; }
    .progress-indicator { display: flex; align-items: center; gap: 12px; padding: 12px 20px; background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
    .progress-bar-mini { width: 120px; height: 8px; background: #e5e7eb; border-radius: 10px; overflow: hidden; }
    .progress-fill-mini { height: 100%; background: linear-gradient(90deg, #007bff, #1e40af); }
    .day-card { background: white; border-radius: 16px; padding: 28px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); border: 2px solid #e5e7eb; transition: all 0.3s; cursor: pointer; }
    .day-card:hover { border-color: #007bff; box-shadow: 0 8px 24px rgba(0, 123, 255, 0.15); }
    .day-card.completed { border-color: #10b981; background: linear-gradient(to right, #f0fdf4 0%, white 20%); }
    .day-card.in-progress { border-color: #f59e0b; background: linear-gradient(to right, #fffbeb 0%, white 20%); }
    .day-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .day-number { display: flex; align-items: center; gap: 16px; }
    .day-badge { width: 48px; height: 48px; border-radius: 12px; background: linear-gradient(135deg, #007bff, #1e40af); color: white; display: flex; align-items: center; justify-content: center; font-size: 18px; font-weight: 700; }
    .day-card.completed .day-badge { background: linear-gradient(135deg, #10b981, #059669); }
    .day-card.in-progress .day-badge { background: linear-gradient(135deg, #f59e0b, #d97706); }
    .day-info h3 { font-size: 20px; font-weight: 700; margin-bottom: 4px; }
    .day-meta { display: flex; gap: 16px; font-size: 13px; color: #6b7280; }
    .meta-tag { display: flex; align-items: center; gap: 4px; }
    .status-badge { padding: 6px 12px; border-radius: 8px; font-size: 12px; font-weight: 700; text-transform: uppercase; }
    .status-completed { background: #dcfdf4; color: #065f46; }
    .status-progress { background: #fef3c7; color: #92400e; }
    .status-not-started { background: #f3f4f6; color: #6b7280; }
    .day-content { margin-top: 20px; padding-top: 20px; border-top: 1px solid #e5e7eb; }
    .content-section { margin-bottom: 20px; }
    .content-section h4 { font-size: 15px; font-weight: 700; color: #4b5563; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
    .content-section p { font-size: 15px; line-height: 1.7; color: #1f2937; margin-bottom: 12px; }
    .content-section ul { list-style: none; padding-left: 0; }
    .content-section li { padding: 8px 0; padding-left: 24px; position: relative; font-size: 14px; line-height: 1.6; }
    .content-section li:before { content: "‚úì"; position: absolute; left: 0; color: #10b981; font-weight: 700; }
    .expand-btn { display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px; background: #f3f4f6; border: none; border-radius: 10px; font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.2s; margin-top: 12px; }
    .expand-btn:hover { background: #e5e7eb; }
    .create-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 12px 24px;
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
    border: none;
    border-radius: 12px;
    font-weight: 700;
    font-size: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
}

.create-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
    background: linear-gradient(135deg, #059669 0%, #047857 100%);
}

.create-btn:active {
    transform: translateY(0);
}

.create-btn i {
    font-size: 16px;
}
    .loading { text-align: center; padding: 60px 24px; color: #6b7280; }
    .spinner { width: 48px; height: 48px; margin: 0 auto 20px; border: 4px solid #e5e7eb; border-top-color: #007bff; border-radius: 50%; animation: spin 0.8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
footer {
  flex-shrink: 0;  /* Quan tr·ªçng! */
  background: #1a202c;
  color: #e5e7eb;
  padding: 28px 20px 16px;
  margin-top: 40px;
}

    .footer-content {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 2fr 1fr 1fr;
        gap: 24px;
        margin-bottom: 20px;
    }

    .footer-brand {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .footer-logo {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .footer-logo-icon {
        width: 44px;
        height: 44px;
        background: var(--primary);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 20px;
    }

    .footer-logo-text {
        display: flex;
        flex-direction: column;
    }

    .footer-logo-title {
        font-size: 18px;
        font-weight: 700;
        color: white;
    }

    .footer-logo-sub {
        font-size: 11px;
        color: #9ca3af;
    }

    .footer-desc {
        color: #9ca3af;
        line-height: 1.5;
        font-size: 13px;
    }

    .footer-social {
        display: flex;
        gap: 12px;
        margin-top: 8px;
    }

    .social-icon {
        width: 36px;
        height: 36px;
        background: #374151;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        transition: all 0.3s ease;
        text-decoration: none;
    }

    .social-icon:hover {
        background: var(--primary);
        transform: translateY(-2px);
    }

    .footer-section h3 {
        font-size: 15px;
        font-weight: 700;
        color: white;
        margin: 0 0 12px 0;
    }

    .footer-links {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .footer-link {
        color: #9ca3af;
        text-decoration: none;
        font-size: 13px;
        transition: color 0.3s ease;
    }

    .footer-link:hover {
        color: var(--primary);
    }

    .footer-bottom {
        max-width: 1200px;
        margin: 0 auto;
        padding-top: 16px;
        border-top: 1px solid #374151;
        text-align: center;
        color: #9ca3af;
        font-size: 13px;
    }
    @media (max-width: 768px) {
      .overview-stats { grid-template-columns: repeat(2, 1fr); }
      .overview-header { flex-direction: column; }
      .day-meta { flex-direction: column; gap: 8px; }
    }
    /* Modal styles - CH·ªà D√ÄNH CHO DETAILS MODAL */
#detailsModal.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 2000;
    backdrop-filter: blur(5px);
    padding: 20px;
    overflow-y: auto;
}

#detailsModal.modal-overlay.active {
    display: flex;
}

#detailsModal .modal-content {
    background: white;
    width: 95%;
    max-width: 1200px;
    max-height: 90vh;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 25px 50px rgba(0,0,0,0.3);
    display: flex;
    flex-direction: column;
    animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(-50px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

#detailsModal .modal-header {
    background: linear-gradient(135deg, #007bff, #007bff);
    color: white;
    padding: 25px 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

#detailsModal .modal-header h2 {
    margin: 0 0 5px 0;
    font-size: 24px;
}

#detailsModal .modal-header p {
    margin: 0;
    opacity: 0.9;
    font-size: 14px;
}

#detailsModal .close-modal {
    background: none;
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
    padding: 5px 10px;
    transition: transform 0.2s;
}

#detailsModal .close-modal:hover {
    transform: scale(1.1);
}

#detailsModal .modal-body {
    flex: 1;
    overflow-y: auto;
    padding: 30px;
}

/* Feedback Modal Styles - ƒê·∫∂T RI√äNG ƒê·ªÇ KH√îNG XUNG ƒê·ªòT */
#feedbackModal.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 2001;
    backdrop-filter: blur(5px);
    padding: 20px;
    overflow-y: auto;
}

#feedbackModal.modal-overlay.active {
    display: flex;
}

#feedbackModal .modal-content {
    background: white;
    width: 95%;
    max-width: 900px;
    max-height: 90vh;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 25px 50px rgba(0,0,0,0.3);
    display: flex;
    flex-direction: column;
    animation: slideIn 0.3s ease-out;
}

#feedbackModal .modal-header {
    background: linear-gradient(135deg, #007bff, #007bff);
    color: white;
    padding: 25px 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

#feedbackModal .modal-header h2 {
    margin: 0 0 5px 0;
    font-size: 24px;
}

#feedbackModal .modal-header p {
    margin: 0;
    opacity: 0.9;
    font-size: 14px;
}

#feedbackModal .close-modal {
    background: none;
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
    padding: 5px 10px;
    transition: transform 0.2s;
}

#feedbackModal .close-modal:hover {
    transform: scale(1.1);
}

#feedbackModal .modal-body {
    flex: 1;
    overflow-y: auto;
    padding: 30px;
    color: #1f2937;
}

/* Feedback Modal Specific Styles */
#feedbackModal .info-box {
    background: #fff3cd;
    padding: 15px;
    border-radius: 8px;
    border-left: 4px solid #ffc107;
}

#feedbackModal .rating-group {
    margin-bottom: 25px;
    background: white;
    padding: 20px;
    border-radius: 12px;
    border: 2px solid #e5e7eb;
}

#feedbackModal .rating-group label {
    display: block;
    font-weight: 600;
    color: #374151;
    margin-bottom: 12px;
    font-size: 14px;
}

#feedbackModal .rating-stars {
    display: flex;
    gap: 8px;
    font-size: 32px;
}

#feedbackModal .star {
    cursor: pointer;
    color: #d1d5db;
    transition: all 0.2s ease;
}

#feedbackModal .star:hover,
#feedbackModal .star.active {
    color: #fbbf24;
    transform: scale(1.2);
}

#feedbackModal .rating-value {
    margin-top: 10px;
    font-size: 14px;
    color: #6b7280;
    font-weight: 600;
}

#feedbackModal .textarea-group {
    margin-bottom: 20px;
    background: white;
    padding: 20px;
    border-radius: 12px;
    border: 2px solid #e5e7eb;
}

#feedbackModal .textarea-group label {
    display: block;
    font-weight: 600;
    color: #374151;
    margin-bottom: 10px;
    font-size: 14px;
}

#feedbackModal .textarea-group textarea {
    width: 100%;
    padding: 12px;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    font-family: inherit;
    font-size: 14px;
    resize: vertical;
    min-height: 80px;
    transition: all 0.3s ease;
}

#feedbackModal .textarea-group textarea:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
}

#feedbackModal .submit-evaluation-btn {
    width: 100%;
    padding: 16px 32px;
    background: linear-gradient(135deg, #f59e0b, #d97706);
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
}

#feedbackModal .submit-evaluation-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(245, 158, 11, 0.3);
}

#feedbackModal .submit-evaluation-btn:disabled {
    background: #9ca3af;
    cursor: not-allowed;
    transform: none;
}
    @media (max-width: 768px) {
      .page-header h1 { font-size: 28px; }
      .category-stats { flex-direction: column; align-items: flex-start; gap: 12px; }
      .roadmaps-grid { grid-template-columns: 1fr; }
      .footer-content { grid-template-columns: 1fr; gap: 32px; }
      .nav-menu { display: none; }
      .nav-buttons { gap: 12px; padding-right: 12px; }
    }
    /* ƒê·∫£m b·∫£o c√≥ c√°c style n√†y */
.analysis-section { 
  background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); 
  padding: 30px; 
  border-radius: 16px; 
  margin-bottom: 30px; 
  border-left: 5px solid #10b981; 
}

.analysis-section h3 { 
  color: #065f46; 
  margin-bottom: 15px; 
  font-size: 1.3rem; 
}

.analysis-content { 
  color: #374151; 
  line-height: 1.8; 
  white-space: pre-wrap; 
}

.roadmap-section h3 { 
  color: #1f2937; 
  margin-bottom: 20px; 
  font-size: 1.3rem; 
}

table { 
  width: 100%; 
  border-collapse: collapse; 
  background: white; 
  box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
  border-radius: 12px; 
  overflow: hidden; 
  margin-bottom: 40px; 
}

thead { 
  background: linear-gradient(135deg, #007bff, #1e40af); 
  color: white; 
  position: sticky; 
  top: 0; 
  z-index: 10; 
}

th { 
  padding: 15px; 
  text-align: left; 
  font-weight: 600; 
  font-size: 0.9rem; 
}

td { 
  padding: 15px; 
  border-bottom: 1px solid #e5e7eb; 
  vertical-align: top; 
}

tbody tr:hover { 
  background: #f9fafb; 
}

.day-cell { 
  text-align: center; 
  font-weight: 700; 
  color: #007bff; 
  background: #f0f9ff; 
}
.rating-display {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 20px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
}

.rating-display i {
    color: #fbbf24;
    font-size: 24px;
}

.rating-display .rating-value {
    font-size: 28px;
    font-weight: 700;
    color: #007bff;
}

.rating-display .rating-label {
    font-size: 13px;
    color: #6b7280;
    font-weight: 500;
}
  </style>
</head>
<body>
<div class="fixed-bar">
  <div class="bar-inner">
    <div class="brand">
      <div class="brand-icon">
        <i class="fa-solid fa-graduation-cap"></i>
      </div>
      <div class="brand-text">
        <div class="brand-title">Con ƒë∆∞·ªùng ƒëam m√™</div>
        <div class="brand-sub">AI-Powered Learning Path</div>
      </div>
    </div>
    <div class="nav-buttons" id="mainNavButtons">
      <!-- Buttons s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JavaScript -->
    </div>
    <div id="userArea" class="userInfo">
      <button class="login-btn"><i class="fa-solid fa-right-to-bracket"></i> ƒêƒÉng nh·∫≠p</button>
      <button class="register-btn"><i class="fa-solid fa-user-plus"></i> ƒêƒÉng k√Ω</button>
    </div>
  </div>
</div>

  <div class="page-offset">
    <div class="breadcrumb">
      <a href="main.html"><i class="fas fa-home"></i></a>
      <span>/</span>
      <a href="#" id="categoryLink">Lƒ©nh v·ª±c</a>
      <span>/</span>
      <span class="current">Chi ti·∫øt l·ªô tr√¨nh</span>
    </div>

    <div class="container">
      <div id="loadingState" class="loading">
        <div class="spinner"></div>
        <p>ƒêang t·∫£i th√¥ng tin l·ªô tr√¨nh...</p>
      </div>

      <div id="roadmapContent" style="display: none;">
        <div class="roadmap-overview">
          <!-- Th√™m ngay sau roadmap-overview v√† tr∆∞·ªõc days-section -->
          <div class="overview-header">
            <div class="overview-title">
              <h1 id="roadmapTitle">L·ªô Tr√¨nh H·ªçc</h1>
              <div class="overview-badges" id="badgesContainer"></div>
              <div class="day-meta" id="metaContainer"></div>
            </div>
          </div>

          <div class="overview-stats" id="statsContainer"></div>
        </div>
        
        <div id="promptMessage" role="status" aria-live="polite"></div>
        <div class="days-section">
          <div class="section-header">
            <h2>L·ªô Tr√¨nh Chi Ti·∫øt Theo Ng√†y</h2>
            <div class="progress-indicator">
              <button class="create-btn" onclick="createRoadmap()"><i class="fa-solid fa-plus"></i> H·ªçc l·ªô tr√¨nh n√†y</button>
              <span style="font-size: 14px; font-weight: 600; color: #4b5563;">Ti·∫øn ƒë·ªô:</span>
              <div class="progress-bar-mini"><div class="progress-fill-mini" id="progressFill" style="width: 0%"></div></div>
              <span style="font-size: 14px; font-weight: 700; color: #4f46e5;" id="progressText">0%</span>
            </div>
          </div>

          <div id="daysContainer"></div>

<div id="analysisAndDetails" style="display: none;">
  <!-- Ph√¢n t√≠ch AI -->
  <div class="analysis-section">
    <h3>üìä Ph√¢n T√≠ch AI</h3>
    <div class="analysis-content" id="analysisContent"></div>
  </div>
  
  <!-- B·∫£ng chi ti·∫øt -->
  <div class="roadmap-section">
    <h3>üìÖ L·ªô Tr√¨nh Chi Ti·∫øt</h3>
    <table>
      <thead>
        <tr>
          <th style="width: 60px;">Ng√†y</th>
          <th style="min-width: 150px;">M·ª•c ti√™u</th>
          <th style="min-width: 150px;">N·ªôi dung</th>
          <th style="min-width: 120px;">B√†i t·∫≠p</th>
          <th style="min-width: 100px;">T√†i li·ªáu</th>
          <th style="min-width: 100px;">H∆∞·ªõng d·∫´n</th>
          <th style="width: 80px;">Th·ªùi l∆∞·ª£ng</th>
          <th style="width: 120px;">Tr·∫°ng th√°i</th>
        </tr>
      </thead>
      <tbody id="detailsTableBody">
        <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JS -->
      </tbody>
    </table>
  </div>
</div>
          <!-- Modal chi ti·∫øt l·ªô tr√¨nh -->

        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-brand">
                <div class="footer-logo">
                    <div class="footer-logo-icon">
                        <i class="fa-solid fa-graduation-cap"></i>
                    </div>
                    <div class="footer-logo-text">
                        <div class="footer-logo-title">Con ƒë∆∞·ªùng ƒëam m√™</div>
                        <div class="footer-logo-sub">AI-Powered Learning Path</div>
                    </div>
                </div>
                <p class="footer-desc">N·ªÅn t·∫£ng h·ªçc t·∫≠p c√° nh√¢n h√≥a s·ª≠ d·ª•ng tr√≠ tu·ªá nh√¢n t·∫°o ƒë·ªÉ t·∫°o l·ªô tr√¨nh h·ªçc ph√π h·ª£p v·ªõi s·ªü th√≠ch v√† m·ª•c ti√™u c·ªßa t·ª´ng ng∆∞·ªùi.</p>
            </div>

            <div class="footer-section">
                <h3>T√≠nh NƒÉng</h3>
                <div class="footer-links">
                    <a href="auth-check.html?target=create_roadmap_page.html" class="footer-link">T·∫°o l·ªô tr√¨nh v·ªõi AI</a>
                    <a href="auth-check.html?target=path.html" class="footer-link">L∆∞u tr·ªØ c√°c l·ªô tr√¨nh</a>
                    <a href="auth-check.html?target=progress.html" class="footer-link">Theo d√µi ti·∫øn ƒë·ªô</a>
                </div>
            </div>

            <div class="footer-section">
                <h3>H·ªó Tr·ª£</h3>
                <div class="footer-links">
                    <a href="https://mail.google.com/mail/?view=cm&fs=1&to=passionpathaisystem@gmail.com" target="_blank" rel="noopener noreferrer" class="footer-link">Li√™n h·ªá</a>
                    <a href="https://zalo.me/g/drfrli672" target="_blank" rel="noopener noreferrer" class="footer-link">Trung t√¢m tr·ª£ gi√∫p</a>
                    <a href="javascript:void(0)" onclick="openFeedbackModal()" style="color: #9ca3af; text-decoration: none; font-size: 13px; transition: color 0.3s ease;">Thu th·∫≠p √Ω ki·∫øn</a>
                </div>
            </div>
        </div>

        <div class="footer-bottom">
            ¬© 2025 Con ƒë∆∞·ªùng ƒëam m√™. All rights reserved. Made with <i class="fa-solid fa-heart" style="color:#e74c3c;"></i> for learners worldwide.
        </div>
        
        <!-- Feedback Modal -->
        <div class="modal-overlay" id="feedbackModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div>
                        <h2>üìã Thu Th·∫≠p √ù Ki·∫øn</h2>
                        <p>ƒê√°nh gi√° tr·∫£i nghi·ªám c·ªßa b·∫°n v·ªõi h·ªá th·ªëng</p>
                    </div>
                    <button class="close-modal" onclick="closeFeedbackModal()">‚úï</button>
                </div>
                <div class="modal-body">
                    <div class="info-box">
                        <strong>üìå M·ª•c ƒë√≠ch thu th·∫≠p:</strong>
                        <p style="margin: 10px 0 0 0; line-height: 1.6;">
                            K·∫øt qu·∫£ kh·∫£o s√°t s·∫Ω ƒë∆∞·ª£c t·ªïng h·ª£p nh·∫±m ho√†n thi·ªán m√¥ h√¨nh thi·∫øt k·∫ø l·ªô tr√¨nh h·ªçc c√° nh√¢n h√≥a, 
                            ƒë·∫£m b·∫£o t√≠nh hi·ªáu qu·∫£ v√† tr·∫£i nghi·ªám t·ªët h∆°n cho ng∆∞·ªùi d√πng.
                        </p>
                    </div>

                    <form id="feedbackForm">
                        <div style="background: #f0f9ff; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                            <h3 style="color: #0369a1; margin-bottom: 15px;">‚≠ê ƒê√°nh Gi√° (1-5)</h3>
                            <p style="margin-bottom: 20px; font-size: 14px;">
                                Sau khi tr·∫£i nghi·ªám l·ªô tr√¨nh h·ªçc c√° nh√¢n h√≥a, vui l√≤ng cho √Ω ki·∫øn ƒë√°nh gi√° theo c√°c ti√™u ch√≠ sau 
                                (ch·ªçn 1‚Üí5, trong ƒë√≥ 1 = ch∆∞a t·ªët, 5 = r·∫•t t·ªët)
                            </p>

                            <!-- Rating 1 -->
                            <div class="rating-group">
                                <label>1. M·ª©c ƒë·ªô ph√π h·ª£p c·ªßa n·ªôi dung h·ªçc *</label>
                                <div class="rating-stars" id="rating_1">
                                    <span class="star" onclick="setFeedbackRating('rating_1', 1)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_1', 2)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_1', 3)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_1', 4)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_1', 5)">‚òÖ</span>
                                </div>
                                <div class="rating-value">Ch·ªçn: <span id="rating_1-value">0</span>/5</div>
                            </div>

                            <!-- Rating 2 -->
                            <div class="rating-group">
                                <label>2. M·ª©c ƒë·ªô h·ªØu √≠ch c·ªßa h·ªçc li·ªáu (link, b√†i t·∫≠p, h∆∞·ªõng d·∫´n) *</label>
                                <div class="rating-stars" id="rating_2">
                                    <span class="star" onclick="setFeedbackRating('rating_2', 1)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_2', 2)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_2', 3)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_2', 4)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_2', 5)">‚òÖ</span>
                                </div>
                                <div class="rating-value">Ch·ªçn: <span id="rating_2-value">0</span>/5</div>
                            </div>

                            <!-- Rating 3 -->
                            <div class="rating-group">
                                <label>3. T√≠nh d·ªÖ hi·ªÉu, d·ªÖ √°p d·ª•ng *</label>
                                <div class="rating-stars" id="rating_3">
                                    <span class="star" onclick="setFeedbackRating('rating_3', 1)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_3', 2)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_3', 3)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_3', 4)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_3', 5)">‚òÖ</span>
                                </div>
                                <div class="rating-value">Ch·ªçn: <span id="rating_3-value">0</span>/5</div>
                            </div>

                            <!-- Rating 4 -->
                            <div class="rating-group">
                                <label>4. T√≠nh th·ª±c t·∫ø v√† kh·∫£ nƒÉng ·ª©ng d·ª•ng v√†o c√¥ng vi·ªác / h·ªçc t·∫≠p *</label>
                                <div class="rating-stars" id="rating_4">
                                    <span class="star" onclick="setFeedbackRating('rating_4', 1)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_4', 2)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_4', 3)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_4', 4)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_4', 5)">‚òÖ</span>
                                </div>
                                <div class="rating-value">Ch·ªçn: <span id="rating_4-value">0</span>/5</div>
                            </div>

                            <!-- Rating 5 -->
                            <div class="rating-group">
                                <label>5. T√≠nh c√° nh√¢n h√≥a (ph√π h·ª£p phong c√°ch h·ªçc, m·ª•c ti√™u c√° nh√¢n) *</label>
                                <div class="rating-stars" id="rating_5">
                                    <span class="star" onclick="setFeedbackRating('rating_5', 1)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_5', 2)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_5', 3)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_5', 4)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_5', 5)">‚òÖ</span>
                                </div>
                                <div class="rating-value">Ch·ªçn: <span id="rating_5-value">0</span>/5</div>
                            </div>

                            <!-- Rating 6 -->
                            <div class="rating-group">
                                <label>6. M·ª©c ƒë·ªô duy tr√¨ ƒë·ªông l·ª±c h·ªçc *</label>
                                <div class="rating-stars" id="rating_6">
                                    <span class="star" onclick="setFeedbackRating('rating_6', 1)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_6', 2)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_6', 3)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_6', 4)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_6', 5)">‚òÖ</span>
                                </div>
                                <div class="rating-value">Ch·ªçn: <span id="rating_6-value">0</span>/5</div>
                            </div>

                            <!-- Rating 7 -->
                            <div class="rating-group">
                                <label>7. Tr·∫£i nghi·ªám t·ªïng th·ªÉ v·ªõi h·ªá th·ªëng *</label>
                                <div class="rating-stars" id="rating_7">
                                    <span class="star" onclick="setFeedbackRating('rating_7', 1)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_7', 2)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_7', 3)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_7', 4)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_7', 5)">‚òÖ</span>
                                </div>
                                <div class="rating-value">Ch·ªçn: <span id="rating_7-value">0</span>/5</div>
                            </div>

                            <!-- Rating 8 -->
                            <div class="rating-group">
                                <label>8. S·ª± ti·ªán l·ª£i c·ªßa ng∆∞·ªùi d√πng sau khi h·ªçc xong l·ªô tr√¨nh *</label>
                                <div class="rating-stars" id="rating_8">
                                    <span class="star" onclick="setFeedbackRating('rating_8', 1)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_8', 2)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_8', 3)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_8', 4)">‚òÖ</span>
                                    <span class="star" onclick="setFeedbackRating('rating_8', 5)">‚òÖ</span>
                                </div>
                                <div class="rating-value">Ch·ªçn: <span id="rating_8-value">0</span>/5</div>
                            </div>
                        </div>

                        <!-- C√¢u h·ªèi m·ªü -->
                        <div style="background: #fef3c7; padding: 20px; border-radius: 12px; margin-top: 20px;">
                            <h3 style="color: #92400e; margin-bottom: 15px;">üí¨ C√¢u H·ªèi M·ªü</h3>

                            <div class="textarea-group">
                                <label>1. B·∫°n th√≠ch nh·∫•t ƒëi·ªÉm n√†o trong l·ªô tr√¨nh h·ªçc n√†y?</label>
                                <textarea id="question_1" rows="3" placeholder="Chia s·∫ª √Ω ki·∫øn c·ªßa b·∫°n..."></textarea>
                            </div>

                            <div class="textarea-group">
                                <label>2. B·∫°n g·∫∑p kh√≥ khƒÉn g√¨ trong qu√° tr√¨nh h·ªçc?</label>
                                <textarea id="question_2" rows="3" placeholder="Chia s·∫ª √Ω ki·∫øn c·ªßa b·∫°n..."></textarea>
                            </div>

                            <div class="textarea-group">
                                <label>3. B·∫°n c√≥ ƒë·ªÅ xu·∫•t c·∫£i thi·ªán n√†o ƒë·ªÉ h·ªá th·ªëng c√° nh√¢n h√≥a t·ªët h∆°n?</label>
                                <textarea id="question_3" rows="3" placeholder="Chia s·∫ª √Ω ki·∫øn c·ªßa b·∫°n..."></textarea>
                            </div>
                        </div>

                        <button type="submit" class="submit-evaluation-btn">
                            üíæ G·ª≠i Ph·∫£n H·ªìi
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </footer>

  <script>
        const loginBtn = document.querySelector(".login-btn");
const registerBtn = document.querySelector(".register-btn");
const userArea = document.getElementById("userArea");
const ADMIN_TOKEN = 'admin-token';

function showAuthButtons() {
  if (loginBtn) loginBtn.style.display = "inline-flex";
  if (registerBtn) registerBtn.style.display = "inline-flex";
  const children = Array.from(userArea.children);
  children.forEach(c => {
    if (!c.classList.contains('login-btn') && !c.classList.contains('register-btn')) {
      try {
        userArea.removeChild(c);
      } catch (e) {}
    }
  });
}

if (loginBtn) {
  loginBtn.addEventListener("click", () => {
    window.location.href = "login.html";
  });
}

if (registerBtn) {
  registerBtn.addEventListener("click", () => {
    window.location.href = "register.html";
  });
}

function wireLogoutAndNav(logoutEl) {
  if (!logoutEl) return;
  logoutEl.addEventListener('click', () => {
    localStorage.removeItem('token');
    localStorage.removeItem('role');
    
    // ‚úÖ REDIRECT V·ªÄ MAIN.HTML NGAY L·∫¨P T·ª®C
    window.location.href = 'main.html';
  });
}

async function loadUser() {
  const token = localStorage.getItem('token');
  const navButtons = document.getElementById('mainNavButtons');
  
  // Lu√¥n hi·ªÉn th·ªã navigation buttons ngay t·ª´ ƒë·∫ßu
  if (navButtons) {
    navButtons.innerHTML = `
      <button class="nav-btn" id="btnHome"><i class="fa-solid fa-house"></i> Trang Ch·ªß</button>
      <button class="nav-btn" id="btnPath"><i class="fa-solid fa-route"></i> L·ªô Tr√¨nh H·ªçc</button>
      <button class="nav-btn" id="btnProgress"><i class="fa-solid fa-chart-line"></i> Ti·∫øn ƒê·ªô</button>
    `;
    
    // Add event listeners cho nav buttons
    document.getElementById('btnHome').addEventListener('click', () => { 
      window.location.href = 'main.html'; 
    });
    
    document.getElementById('btnPath').addEventListener('click', () => { 
      const token = localStorage.getItem('token');
      if (!token) {
        window.location.href = 'login.html';
      } else {
        window.location.href = 'path.html';
      }
    });
    
    document.getElementById('btnProgress').addEventListener('click', () => { 
      const token = localStorage.getItem('token');
      if (!token) {
        window.location.href = 'login.html';
      } else {
        window.location.href = 'progress.html';
      }
    });
  }
  
  showAuthButtons();
  if (!token) return;

  let name = 'Ng∆∞·ªùi d√πng';
  let serverRole = 'user';

  if (token === ADMIN_TOKEN) {
    name = 'Admin';
    serverRole = 'admin';
    localStorage.setItem('role', 'admin');
  } else {
    try {
      const res = await fetch('/api/me', { headers: { 'Authorization': 'Bearer ' + token }});
      if (!res.ok) { 
        showAuthButtons(); 
        return; 
      }
      const data = await res.json();
      serverRole = (data && (data.role || (data.user && data.user.role))) ? (data.role || data.user.role) : 'user';
      name = (data && data.user && data.user.name) ? data.user.name : 'Ng∆∞·ªùi d√πng';
      localStorage.setItem('role', serverRole);
    } catch (err) {
      console.error(err);
      showAuthButtons();
      return;
    }
  }

  if (document.querySelector('.login-btn')) {
    document.querySelector('.login-btn').style.display = 'none';
  }
  if (document.querySelector('.register-btn')) {
    document.querySelector('.register-btn').style.display = 'none';
  }

  userArea.innerHTML = `
    <span>Xin ch√†o <strong style="color:white;">${name}</strong></span>
    <button id="logout" class="logout-btn"><i class="fa-solid fa-right-from-bracket"></i> ƒêƒÉng xu·∫•t</button>
  `;
  const logoutEl = document.getElementById('logout');
  wireLogoutAndNav(logoutEl);


  // Active state
  const params = new URLSearchParams(window.location.search);
  const page = params.get('page') || 'progress';
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  const idMap = { home: 'btnHome', path: 'btnPath', progress: 'btnProgress', admin: 'btnAdmin' };
  const btnId = idMap[page];
  if (btnId) {
    const el = document.getElementById(btnId);
    if (el) el.classList.add('active');
  }
}

// Initialize
loadUser().catch((e)=>console.error(e));
    const API_BASE_URL = 'http://localhost:3000/api';
    const urlParams = new URLSearchParams(window.location.search);
    const roadmapId = urlParams.get('id');
    const token = localStorage.getItem('token');
    if (!token) {
      window.location.href = 'login.html';
    }

    let roadmapData = null;
    let details = null;
    let daysData = [];
    const days = [];

    async function createRoadmap(){
      try {
        const roadmapDataSystem = {
          roadmap_name: roadmapData.roadmap_name,
          category: roadmapData.category,
          sub_category: roadmapData.sub_category || null,
          start_level: roadmapData.start_level,
          duration_days: roadmapData.duration_days,
          duration_hours: roadmapData.duration_hours,
          expected_outcome: roadmapData.expected_outcome,
          study_guide: roadmapData.usage_instructions,
          roadmap_analyst: roadmapData.roadmap_analyst
        };

        details.forEach((onerow, idx) => {
          const dayData = {
            day_number: idx + 1,
            study_date: null,
            completion_status: 'NOT_STARTED',
            daily_goal: onerow.daily_goal || '',
            learning_content: onerow.learning_content || '',
            practice_exercises: onerow.practice_exercises || '',
            learning_materials: onerow.learning_materials || '',
            study_guide: onerow.usage_instructions || '',
            study_duration: onerow.study_duration || 2
          };
          days.push(dayData);
        });

        if (days.length > 0) roadmapDataSystem.days = days;

        const response = await fetch('/api/roadmap_from_system', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${localStorage.getItem('token')}` },
          body: JSON.stringify({ roadmapDataSystem: roadmapDataSystem })
        });

        if (!response.ok) {
          const errData = await response.json().catch(() => ({}));
          throw new Error(errData.error || (`HTTP ${response.status}`));
        }
        showMessage('‚úÖ L·ªô tr√¨nh ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng!' , 'success');
        setTimeout(() => {
          if (window.opener) { window.opener.location.href = 'path.html'; window.close(); }
          else { window.location.href = 'path.html'; }
        }, 1200);
      } catch (error) {
        console.error('createRoadmap:', error);
      }
    }

    function showMessage(message, type = 'info') {
      const msgDiv = document.createElement('div');
      msgDiv.className = type === 'success' ? 'success-message' : 'error-message';
      msgDiv.textContent = message;
      promptMessage.innerHTML = '';
      promptMessage.appendChild(msgDiv);
      setTimeout(() => { msgDiv.remove(); }, 3000);
    }

// THAY TH·∫æ h√†m viewRoadmapDetails hi·ªán t·∫°i b·∫±ng code n√†y:
async function viewRoadmapDetails(roadmapId, roadmap_analyst) {
  // Hi·ªÉn th·ªã loading
  document.getElementById('analysisContent').innerHTML = '<div class="loading"><div class="spinner"></div><br><br>ƒêang t·∫£i chi ti·∫øt...</div>';
  document.getElementById('detailsTableBody').innerHTML = '';
  document.getElementById('analysisAndDetails').style.display = 'block';
  
  try {
    const response = await fetch(`/api/roadmapsystem/${roadmapId}/details`, {
      method: 'GET', 
      headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
    });
    if (!response.ok) throw new Error('Failed to fetch roadmap details');
    const result = await response.json();
    details = result.data;
    displayRoadmapDetails(roadmap_analyst, details);
  } catch (error) {
    console.error('Error fetching details:', error);
    document.getElementById('analysisContent').innerHTML = `<div class="error">‚ö†Ô∏è Kh√¥ng th·ªÉ t·∫£i chi ti·∫øt: ${error.message}</div>`;
  }
}

// THAY TH·∫æ h√†m displayRoadmapDetails hi·ªán t·∫°i b·∫±ng code n√†y:
function displayRoadmapDetails(roadmap, details) {
  // Hi·ªÉn th·ªã ph·∫ßn ph√¢n t√≠ch AI
  document.getElementById('analysisContent').innerHTML = roadmap;
  
  // Hi·ªÉn th·ªã b·∫£ng chi ti·∫øt
  const tbody = document.getElementById('detailsTableBody');
  tbody.innerHTML = details.map(d => `
    <tr>
      <td class="day-cell">${d.day_number}</td>
      <td><strong>${d.daily_goal}</strong></td>
      <td>${d.learning_content}</td>
      <td>${d.practice_exercises || '-'}</td>
      <td>
        ${d.learning_materials ? 
          `<a href="${d.learning_materials}" target="_blank" style="color: #4f46e5;">Xem</a>` : 
          '-'
        }
      </td>
      <td>${d.usage_instructions || '-'}</td>
      <td style="text-align: center;"><strong>${d.study_duration}h</strong></td>
      <td>Ch∆∞a b·∫Øt ƒë·∫ßu</td>
    </tr>
  `).join('');
  
  // Hi·ªÉn th·ªã ph·∫ßn n√†y
  document.getElementById('analysisAndDetails').style.display = 'block';
}


async function loadRoadmapDetails() {
  if (!roadmapId) { alert('Kh√¥ng t√¨m th·∫•y ID l·ªô tr√¨nh'); window.location.href = 'main.html'; return; }
  try {
    const roadmapResponse = await fetch(`/api/roadmapsystem/${roadmapId}`, { 
      method: 'GET', 
      headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` } 
    });
    const roadmapResult = await roadmapResponse.json();
    if (!roadmapResult.success) throw new Error('Kh√¥ng th·ªÉ t·∫£i th√¥ng tin l·ªô tr√¨nh');
    roadmapData = roadmapResult.data;
    
    // ‚úÖ TH√äM DEBUG N√ÄY
    console.log('üîç roadmapData:', roadmapData);
    console.log('üîç roadmap_analyst:', roadmapData.roadmap_analyst);
    
    viewRoadmapDetails(roadmapId, roadmapData.roadmap_analyst);
    renderRoadmap();
  } catch (error) {
    console.error('Error:', error);
    alert('Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu: ' + error.message);
    window.location.href = 'main.html';
  } finally {
    document.getElementById('loadingState').style.display = 'none';
    document.getElementById('roadmapContent').style.display = 'block';
  }
}

function renderRoadmap() {
  console.log('üîç roadmapData:', roadmapData);
  document.getElementById('roadmapTitle').textContent = roadmapData.roadmap_name;
  
  const categoryLink = document.getElementById('categoryLink');
  categoryLink.textContent = roadmapData.category;
  
  if (roadmapData.category_id) {
    categoryLink.href = `main_category.html?category=${roadmapData.category_id}`;
  } else {
    categoryLink.href = `main_category.html?category=${encodeURIComponent(roadmapData.category)}`;
  }
  
  const badgesHTML = `<span class="badge badge-level"><i class="fas fa-signal"></i> ${getLevelText(roadmapData.start_level)}</span><span class="badge badge-duration"><i class="fas fa-calendar"></i> ${roadmapData.duration_days} ng√†y</span><span class="badge badge-learners"><i class="fas fa-users"></i> ${roadmapData.total_user_learning || 0} h·ªçc vi√™n</span>`;
  document.getElementById('badgesContainer').innerHTML = badgesHTML;
  
  const metaHTML = `<div class="meta-tag"><i class="fas fa-clock"></i><span>${roadmapData.duration_hours} gi·ªù h·ªçc</span></div>${roadmapData.sub_category ? `<div class="meta-tag"><i class="fas fa-tag"></i><span>${escapeHtml(roadmapData.sub_category)}</span></div>` : ''}`;
document.getElementById('metaContainer').innerHTML = metaHTML;

// X√ìA ph·∫ßn ratingContainer ·ªü ƒë√¢y

// ‚úÖ BUILD TO√ÄN B·ªò STATS HTML C√ôNG L√öC
// ‚úÖ BUILD TO√ÄN B·ªò STATS HTML C√ôNG L√öC
let statsHTML = `
  <div class="stat-box"><span class="stat-value">${roadmapData.duration_days}</span><span class="stat-label">Ng√†y h·ªçc</span></div>
  <div class="stat-box"><span class="stat-value">${roadmapData.duration_hours}h</span><span class="stat-label">T·ªïng th·ªùi gian</span></div>
  <div class="stat-box"><span class="stat-value">${roadmapData.total_user_learning || 0}</span><span class="stat-label">H·ªçc vi√™n</span></div>
`;

// ‚úÖ HI·ªÇN TH·ªä S·ªê NG∆Ø·ªúI ƒê√ÅNH GI√Å >= 4 SAO T·ªîNG TH·ªÇ
if (roadmapData.high_overall_rating_count > 0) {
  statsHTML += `
    <div class="stat-box">
      <div class="rating-box" style="display: flex; align-items: center; gap: 8px; justify-content: center;">
        
        <span class="stat-value" style="font-size: 28px;">${roadmapData.high_overall_rating_count}</span><span class="stat-value" style="font-size: 20px; margin-top: 1px">h·ªçc vi√™n</span>
      </div>
      <span class="stat-label">ƒê√°nh gi√° T·ªïng th·ªÉ: ‚â•4‚≠ê</span>
    </div>
  `;
}
// <i class="fas fa-star" style="color: #fbbf24; font-size: 24px;"></i>
// <i class="fas fa-chart-line" style="color: #10b981; font-size: 24px;"></i>
// ‚úÖ HI·ªÇN TH·ªä S·ªê NG∆Ø·ªúI ƒê√ÅNH GI√Å >= 4 SAO HI·ªÜU QU·∫¢
if (roadmapData.high_effectiveness_count > 0) {
  statsHTML += `
    <div class="stat-box">
      <div class="rating-box" style="display: flex; align-items: center; gap: 8px; justify-content: center;">
        
        <span class="stat-value" style="font-size: 28px;">${roadmapData.high_effectiveness_count}</span><span class="stat-value" style="font-size: 20px; margin-top: 1px">h·ªçc vi√™n</span>
      </div>
      <span class="stat-label">ƒê√°nh gi√° Hi·ªáu qu·∫£: ‚â•4‚≠ê</span>
    </div>
  `;
}

// ‚úÖ G√ÅN 1 L·∫¶N DUY NH·∫§T
document.getElementById('statsContainer').innerHTML = statsHTML;
}
    function renderDays() {
      const container = document.getElementById('daysContainer');
      if (daysData.length === 0) { container.innerHTML = '<p style="text-align: center; color: #6b7280; padding: 40px;">Ch∆∞a c√≥ th√¥ng tin chi ti·∫øt</p>'; return; }
      const completedDays = daysData.filter(d => d.completion_status === 'COMPLETED').length;
      const progressPercent = Math.round((completedDays / daysData.length) * 100);
      document.getElementById('progressFill').style.width = progressPercent + '%';
      document.getElementById('progressText').textContent = progressPercent + '%';
      container.innerHTML = daysData.map(day => {
        const statusClass = day.completion_status === 'COMPLETED' ? 'completed' : day.completion_status === 'IN_PROGRESS' ? 'in-progress' : '';
        const statusBadge = day.completion_status === 'COMPLETED' ? '<span class="status-badge status-completed">‚úì Ho√†n th√†nh</span>' : day.completion_status === 'IN_PROGRESS' ? '<span class="status-badge status-progress">ƒêang h·ªçc</span>' : '<span class="status-badge status-not-started">Ch∆∞a b·∫Øt ƒë·∫ßu</span>';
        return `
          <div class="day-card ${statusClass}" id="day-${day.detail_id}">
            <div class="day-header">
              <div class="day-number">
                <div class="day-badge">${day.day_number}</div>
                <div class="day-info">
                  <h3>Ng√†y ${day.day_number}: ${escapeHtml(day.daily_goal)}</h3>
                  <div class="day-meta">
                    <div class="meta-tag"><i class="fas fa-clock"></i><span>${day.study_duration}h h·ªçc t·∫≠p</span></div>
                    ${day.study_date ? `<div class="meta-tag"><i class="fas fa-calendar"></i><span>${formatDate(day.study_date)}</span></div>` : ''}
                  </div>
                </div>
              </div>
              ${statusBadge}
            </div>
            <div class="day-content" id="content-${day.detail_id}" style="display: none;">
              <div class="content-section"><h4><i class="fas fa-bullseye"></i> M·ª•c ti√™u h·ªçc t·∫≠p</h4><p>${escapeHtml(day.daily_goal)}</p></div>
              <div class="content-section"><h4><i class="fas fa-book"></i> N·ªôi dung h·ªçc</h4><p>${escapeHtml(day.learning_content)}</p></div>
              ${day.practice_exercises ? `<div class="content-section"><h4><i class="fas fa-tasks"></i> B√†i t·∫≠p th·ª±c h√†nh</h4><p>${escapeHtml(day.practice_exercises)}</p></div>` : ''}
              ${day.learning_materials ? `<div class="content-section"><h4><i class="fas fa-folder-open"></i> T√†i li·ªáu h·ªçc t·∫≠p</h4><p>${escapeHtml(day.learning_materials)}</p></div>` : ''}
              ${day.usage_instructions ? `<div class="content-section"><h4><i class="fas fa-info-circle"></i> H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng</h4><p>${escapeHtml(day.usage_instructions)}</p></div>` : ''}
            </div>
            <button class="expand-btn" onclick="toggleDay(${day.detail_id})"><i class="fas fa-chevron-down" id="icon-${day.detail_id}"></i><span id="text-${day.detail_id}">Xem chi ti·∫øt</span></button>
          </div>
        `;
      }).join('');
    }

    function toggleDay(dayId) {
      const content = document.getElementById(`content-${dayId}`);
      const icon = document.getElementById(`icon-${dayId}`);
      const text = document.getElementById(`text-${dayId}`);
      if (content.style.display === 'none') {
        content.style.display = 'block'; icon.className = 'fas fa-chevron-up'; text.textContent = 'Thu g·ªçn';
      } else {
        content.style.display = 'none'; icon.className = 'fas fa-chevron-down'; text.textContent = 'Xem chi ti·∫øt';
      }
    }

    function getLevelText(level) { const levels = { 'Beginner': 'C∆° b·∫£n', 'Intermediate': 'Trung c·∫•p', 'Advanced': 'N√¢ng cao' }; return levels[level] || level; }
    function formatDate(dateString) { if (!dateString) return ''; const date = new Date(dateString); return date.toLocaleDateString('vi-VN', { year: 'numeric', month: 'long', day: 'numeric' }); }
    function escapeHtml(text) { if (!text) return ''; const div = document.createElement('div'); div.textContent = text; return div.innerHTML; }

    document.addEventListener('DOMContentLoaded', () => { loadRoadmapDetails(); });

    // Load navigation buttons based on user role ‚Äî updated to create actual Home button like main.html
    async function loadNavButtons() {
      const navButtons = document.getElementById('mainNavButtons');
      if (!navButtons) return;
      const token = localStorage.getItem('token');
      const role = localStorage.getItem('role') || 'user';
      let navHtml = `<button class="nav-btn" id="btnHome"><i class="fa-solid fa-house"></i> Trang Ch·ªß</button>`;
      if (token) {
        navHtml += `<button class="nav-btn" id="btnPath"><i class="fa-solid fa-route"></i> L·ªô Tr√¨nh H·ªçc</button>`;
        navHtml += `<button class="nav-btn" id="btnProgress"><i class="fa-solid fa-chart-line"></i> Ti·∫øn ƒê·ªô</button>`;
        if (role === 'admin') navHtml += `<button class="nav-btn" id="btnAdmin"><i class="fa-solid fa-user-shield"></i> Qu·∫£n Tr·ªã</button>`;
      } else {
        navHtml += `<button class="nav-btn" id="btnPath"><i class="fa-solid fa-route"></i> L·ªô Tr√¨nh H·ªçc</button>`;
        navHtml += `<button class="nav-btn" id="btnProgress"><i class="fa-solid fa-chart-line"></i> Ti·∫øn ƒê·ªô</button>`;
      }
      navButtons.innerHTML = navHtml;
      const btnHome = document.getElementById('btnHome'); if (btnHome) btnHome.addEventListener('click', () => { window.location.href = 'main.html'; });
      const btnPath = document.getElementById('btnPath'); if (btnPath) btnPath.addEventListener('click', () => { window.location.href = 'path.html'; });
      const btnProgress = document.getElementById('btnProgress'); if (btnProgress) btnProgress.addEventListener('click', () => { window.location.href = 'progress.html'; });
      const btnAdmin = document.getElementById('btnAdmin'); if (btnAdmin) btnAdmin.addEventListener('click', () => { window.location.href = 'admin.html?page=admin'; });
    }

    // Call on page load
    document.addEventListener('DOMContentLoaded', loadNavButtons);
        if (!token) {
      window.location.href = 'login.html';
    }

    // Feedback Modal Functions
    let feedbackRatings = {};
    
    function openFeedbackModal() {
        // Check if user is logged in
        const token = localStorage.getItem('token');
        if (!token) {
            alert('Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ g·ª≠i ph·∫£n h·ªìi!');
            window.location.href = 'login.html';
            return;
        }

        document.getElementById('feedbackModal').classList.add('active');
        feedbackRatings = {}; // Reset ratings
        
        // Reset all stars
        for (let i = 1; i <= 8; i++) {
            const stars = document.querySelectorAll(`#feedbackModal #rating_${i} .star`);
            stars.forEach(star => star.classList.remove('active'));
            document.getElementById(`rating_${i}-value`).textContent = '0';
        }
        
        // Reset textareas
        document.getElementById('question_1').value = '';
        document.getElementById('question_2').value = '';
        document.getElementById('question_3').value = '';
    }

    function closeFeedbackModal() {
        document.getElementById('feedbackModal').classList.remove('active');
    }

    function setFeedbackRating(ratingId, value) {
        feedbackRatings[ratingId] = value;
        
        const stars = document.querySelectorAll(`#feedbackModal #${ratingId} .star`);
        stars.forEach((star, index) => {
            if (index < value) {
                star.classList.add('active');
            } else {
                star.classList.remove('active');
            }
        });
        
        document.getElementById(`${ratingId}-value`).textContent = value;
    }

    function showNotification(message, type) {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = message;
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 10000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        `;
        
        if (type === 'success') {
            notification.style.background = '#059669';
        } else {
            notification.style.background = '#dc2626';
        }
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.transform = 'translateX(0)';
        }, 100);
        
        setTimeout(() => {
            notification.style.transform = 'translateX(400px)';
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }

    // Handle feedback form submission
    document.getElementById('feedbackForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // Validate all 8 ratings are filled
        for (let i = 1; i <= 8; i++) {
            if (!feedbackRatings[`rating_${i}`]) {
                showNotification(`‚ö† Vui l√≤ng ƒë√°nh gi√° t·∫•t c·∫£ 8 ti√™u ch√≠!`, 'error');
                return;
            }
        }
        
        const submitBtn = this.querySelector('button[type="submit"]');
        submitBtn.disabled = true;
        submitBtn.innerHTML = '</div> ƒêang g·ª≠i...';
        
        try {
            const payload = {
                rating_1: feedbackRatings.rating_1,
                rating_2: feedbackRatings.rating_2,
                rating_3: feedbackRatings.rating_3,
                rating_4: feedbackRatings.rating_4,
                rating_5: feedbackRatings.rating_5,
                rating_6: feedbackRatings.rating_6,
                rating_7: feedbackRatings.rating_7,
                rating_8: feedbackRatings.rating_8,
                question_1: document.getElementById('question_1').value.trim(),
                question_2: document.getElementById('question_2').value.trim(),
                question_3: document.getElementById('question_3').value.trim()
            };
            
            const response = await fetch('/api/feedback/submit', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                },
                body: JSON.stringify(payload)
            });
            
            const result = await response.json();
            
            if (result.success) {
                showNotification('‚úÖ C·∫£m ∆°n b·∫°n ƒë√£ g·ª≠i ph·∫£n h·ªìi!', 'success');
                setTimeout(() => {
                    closeFeedbackModal();
                }, 1500);
            } else {
                throw new Error(result.error || 'Kh√¥ng th·ªÉ g·ª≠i ph·∫£n h·ªìi');
            }
            
        } catch (error) {
            console.error('Error submitting feedback:', error);
            showNotification('‚úó ' + error.message, 'error');
        } finally {
            submitBtn.disabled = false;
            submitBtn.innerHTML = 'üíæ G·ª≠i Ph·∫£n H·ªìi';
        }
    });

    // Close modal when clicking outside
    document.getElementById('feedbackModal').addEventListener('click', function(e) {
        if (e.target === this) closeFeedbackModal();
    });
    
  </script>
  
</body>
</html>
