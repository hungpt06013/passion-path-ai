<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L·ªô Tr√¨nh H·ªçc C·ªßa T√¥i</title>
    <head>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    </head>
      <script>
    const tokeen = localStorage.getItem('token');
    if(!tokeen) {alert('Vui l√≤ng ƒëƒÉng nh·∫≠p!');window.location.href = 'login.html';}
  </script>
 <style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: #f5f5f5;
        min-height: 100vh;
        padding: 20px;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        overflow: hidden;
    }

    .header {
        background: linear-gradient(135deg, #007bff 0%, #007bff 100%);
        color: white;
        padding: 40px 30px;
        text-align: center;
        position: relative;
    }

    .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        font-weight: 700;
    }

    .header p {
        font-size: 1.1rem;
        opacity: 0.9;
    }

    .create-btn {
        position: absolute;
        right: 70px;
        padding: 12px 24px;
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
    }

    .create-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        border-color: rgba(255, 255, 255, 0.5);
        transform: translateY(-2px);
    }

    .upload-btn {
        position: absolute;
        left: 100px;
        padding: 12px 24px;
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
    }

    .upload-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        border-color: rgba(255, 255, 255, 0.5);
        transform: translateY(-2px);
    }

    .content {
        padding: 40px;
    }

    .roadmaps-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
        gap: 30px;
    }

    .roadmap-card {
        background: white;
        border-radius: 16px;
        padding: 25px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        border: 2px solid #e5e7eb;
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
    }

    .roadmap-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 12px 30px rgba(0,0,0,0.15);
        border-color: #007bff;
    }

    .delete-roadmap-btn {
        position: absolute;
        top: 307px;
        right: 15px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 8px;
        padding: 14px 14px;
        font-size: 0.85rem;
        cursor: pointer;
        transition: all 0.3s ease;
        z-index: 5;
    }

    .delete-roadmap-btn:hover {
        background: #0056b3;
        transform: scale(1.05);
    }

    .roadmap-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 15px;
    }

    .roadmap-title {
        font-size: 1.3rem;
        font-weight: 700;
        color: #1f2937;
        flex: 1;
    }

    .status-badge {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        white-space: nowrap;
        margin-left: 10px;
    }

.status-not-started {
    background: #dc2626;
    color: #ffffff;
    font-weight: 700;
}

.status-active {
    background: #f59e0b;
    color: #ffffff;
    font-weight: 700;
}

.status-completed {
    background: #16a34a;
    color: #ffffff;
    font-weight: 700;
}

    .roadmap-meta {
        display: flex;
        gap: 15px;
        margin-bottom: 15px;
        font-size: 0.9rem;
        color: #6b7280;
    }

    .meta-item {
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .progress-section {
        margin: 15px 0;
    }

    .progress-label {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        font-size: 0.9rem;
        font-weight: 600;
        color: #374151;
    }

    .progress-bar {
        width: 100%;
        height: 8px;
        background: #e5e7eb;
        border-radius: 4px;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #007bff, #007bff);
        transition: width 0.3s ease;
    }

    .roadmap-stats {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        margin: 20px 0;
        padding: 15px;
        background: #f9fafb;
        border-radius: 12px;
    }

    .stat-item {
        text-align: center;
    }

    .stat-value {
        font-size: 1.4rem;
        font-weight: 700;
        color: #007bff;
    }

    .stat-label {
        font-size: 0.8rem;
        color: #6b7280;
        margin-top: 4px;
    }

    .view-details-btn {
        width: 85%;
        padding: 12px;
        background: linear-gradient(135deg, #007bff, #007bff);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 0.95rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 15px;
        display: block;
    }

    .view-details-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(79, 70, 229, 0.3);
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
    }

    .empty-icon {
        font-size: 4rem;
        margin-bottom: 20px;
    }

    .empty-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 10px;
    }

    .empty-text {
        color: #6b7280;
        margin-bottom: 30px;
        font-size: 1.05rem;
    }

    .empty-btn {
        padding: 12px 30px;
        background: linear-gradient(135deg, #007bff, #007bff);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .empty-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(79, 70, 229, 0.3);
    }

    .loading {
        text-align: center;
        padding: 40px;
        color: #6b7280;
    }

    .spinner {
        display: inline-block;
        width: 30px;
        height: 30px;
        border: 4px solid #e5e7eb;
        border-radius: 50%;
        border-top-color: #007bff;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        backdrop-filter: blur(5px);
        padding: 20px;
    }

    .modal-overlay.active {
        display: flex;
    }

    .modal-content {
        background: white;
        width: 95%;
        max-width: 1400px;
        max-height: 95vh;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 25px 50px rgba(0,0,0,0.3);
        display: flex;
        flex-direction: column;
        animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(-50px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .modal-header {
        background: linear-gradient(135deg, #007bff, #007bff);
        color: white;
        padding: 25px 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .close-modal {
        background: none;
        border: none;
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
        padding: 5px 10px;
    }

    .modal-body {
        flex: 1;
        overflow-y: auto;
        padding: 30px;
    }

    .analysis-section {
        background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
        padding: 30px;
        border-radius: 16px;
        margin-bottom: 30px;
        border-left: 5px solid #10b981;
    }

    .analysis-section h3 {
        color: #065f46;
        margin-bottom: 15px;
        font-size: 1.3rem;
    }

    .analysis-content {
        color: #374151;
        line-height: 1.8;
        white-space: pre-wrap;
    }

    .roadmap-section h3 {
        color: #1f2937;
        margin-bottom: 20px;
        font-size: 1.3rem;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        border-radius: 12px;
        overflow: hidden;
        margin-bottom: 40px;
    }

    thead {
        background: linear-gradient(135deg, #007bff, #007bff);
        color: white;
        position: sticky;
        top: 0;
        z-index: 10;
    }

    th {
        padding: 15px;
        text-align: left;
        font-weight: 600;
        font-size: 0.9rem;
    }

    td {
        padding: 15px;
        border-bottom: 1px solid #e5e7eb;
        vertical-align: top;
    }

    tbody tr:hover {
        background: #f9fafb;
    }

    .day-cell {
        text-align: center;
        font-weight: 700;
        color: #007bff;
        background: #f0f9ff;
    }

    select {
        padding: 8px 12px;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 0.85rem;
        cursor: pointer;
        width: 100%;
        transition: all 0.3s ease;
    }

    select:hover {
        border-color: #007bff;
    }

    .date-cell {
        text-align: center;
        font-weight: 600;
        color: #059669;
        background: #f0fdf4;
    }

    .evaluation-section {
        background: linear-gradient(135deg, #fef3c7 0%, #fef08a 100%);
        padding: 30px;
        border-radius: 16px;
        border-left: 5px solid #f59e0b;
        margin-top: 40px;
    }

    .evaluation-section h3 {
        color: #92400e;
        margin-bottom: 25px;
        font-size: 1.3rem;
    }

    .rating-group {
        margin-bottom: 25px;
        background: white;
        padding: 20px;
        border-radius: 12px;
        border: 2px solid #e5e7eb;
    }

    .rating-group label {
        display: block;
        font-weight: 600;
        color: #374151;
        margin-bottom: 12px;
        font-size: 1rem;
    }

    .rating-stars {
        display: flex;
        gap: 8px;
        font-size: 2rem;
    }

    .star {
        cursor: pointer;
        color: #d1d5db;
        transition: all 0.2s ease;
    }

    .star:hover,
    .star.active {
        color: #fbbf24;
        transform: scale(1.2);
    }

    .rating-value {
        margin-top: 10px;
        font-size: 0.9rem;
        color: #6b7280;
        font-weight: 600;
    }

    .textarea-group {
        margin-bottom: 20px;
        background: white;
        padding: 20px;
        border-radius: 12px;
        border: 2px solid #e5e7eb;
    }

    .textarea-group label {
        display: block;
        font-weight: 600;
        color: #374151;
        margin-bottom: 10px;
    }

    .textarea-group textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-family: inherit;
        font-size: 0.95rem;
        resize: vertical;
        min-height: 100px;
        transition: all 0.3s ease;
    }

    .textarea-group textarea:focus {
        outline: none;
        border-color: #007bff;
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
    }

    .select-group {
        margin-bottom: 20px;
        background: white;
        padding: 20px;
        border-radius: 12px;
        border: 2px solid #e5e7eb;
    }

    .select-group label {
        display: block;
        font-weight: 600;
        color: #374151;
        margin-bottom: 10px;
    }

    .select-group select {
        width: 100%;
    }

    .checkbox-group {
        margin-bottom: 20px;
        background: white;
        padding: 20px;
        border-radius: 12px;
        border: 2px solid #e5e7eb;
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .checkbox-group label {
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 600;
        color: #374151;
        cursor: pointer;
        margin: 0;
    }

    .checkbox-group input[type="checkbox"] {
        width: 20px;
        height: 20px;
        cursor: pointer;
    }

    .submit-evaluation-btn {
        width: 100%;
        padding: 16px 32px;
        background: linear-gradient(135deg, #f59e0b, #d97706);
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 1.1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 20px;
    }

    .submit-evaluation-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(245, 158, 11, 0.3);
    }

    .submit-evaluation-btn:disabled {
        background: #9ca3af;
        cursor: not-allowed;
        transform: none;
    }

    .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 25px;
        border-radius: 8px;
        color: white;
        font-weight: 600;
        z-index: 10000;
        transform: translateX(400px);
        transition: transform 0.3s ease;
    }

    .notification.show {
        transform: translateX(0);
    }

    .notification.success {
        background: #059669;
    }

    .notification.error {
        background: #dc2626;
    }

    .form-group {
        margin-bottom: 15px;
    }

    .form-group label {
        display: block;
        font-weight: 600;
        margin-bottom: 8px;
        color: #374151;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        font-size: 14px;
        font-family: 'Inter', sans-serif;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
        outline: none;
        border-color: #007bff;
        box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
    }

    .submit-btn {
        background: #007bff;
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        font-weight: 600;
        width: 100%;
        margin-top: 10px;
        border: none;
        cursor: pointer;
    }

    .submit-btn:hover {
        background: #0056b3;
    }

    .submit-btn:disabled {
        background: #6c757d;
        cursor: not-allowed;
    }

    .info-box {
        background: #fff3cd;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        border-left: 4px solid #ffc107;
    }

    @media (max-width: 768px) {
        .roadmaps-grid {
            grid-template-columns: 1fr;
        }

        .header h1 {
            font-size: 2rem;
        }

        .create-btn {
            position: static;
            margin-top: 20px;
            width: 100%;
        }

        .modal-content {
            width: 98%;
            max-height: 98vh;
        }

        table {
            font-size: 0.8rem;
        }

        th, td {
            padding: 10px 6px;
        }
    }

.fixed-bar {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 80px;
    background: var(--primary);
    box-shadow: 0 6px 20px rgba(14, 30, 37, 0.12);
    z-index: 50;
}

/* Layout container - keeps content centered but lets nav expand */
.bar-inner {
    max-width: 1200px;
    height: 100%;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 20px;
    box-sizing: border-box;
    gap: 16px;
}

/* Brand (left) */
.brand {
    display: flex;
    align-items: center;
    gap: 12px;
    flex: 0 0 auto;
    min-width: 0;
}

.brand-icon {
    width: 48px;
    height: 48px;
    background: rgba(255,255,255,0.2);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 22px;
    flex-shrink: 0;
}

.brand-text {
    display: flex;
    flex-direction: column;
    gap: 3px;
    line-height: 1;
    min-width: 0;
}

.brand-title {
    color: white;
    font-size: 20px;
    font-weight: 700;
    white-space: normal;
    word-break: break-word;
    line-height: 1.05;
}

.brand-sub {
    color: rgba(255,255,255,0.9);
    font-size: 12px;
    font-weight: 600;
    white-space: normal;
    line-height: 1;
}

/* Nav buttons (center) - take remaining space */
.nav-buttons {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    padding: 4px 12px 4px 6px;
    min-width: 0;
    white-space: nowrap;
    flex-wrap: nowrap;
    gap: 22px;
}

.nav-buttons::-webkit-scrollbar { 
    height: 6px; 
}

.nav-buttons::-webkit-scrollbar-thumb { 
    background: rgba(0, 0, 0, 0.12); 
    border-radius: 6px; 
}

.nav-btn {
    background: none;
    color: #fff;
    padding: 6px 12px;
    font-size: 15px;
    font-weight: 600;
    border-radius: 9999px;
    white-space: nowrap;
    flex-shrink: 0;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.nav-btn .fa {
    margin-right: 4px;
    opacity: 0.95;
}

.nav-btn.active {
    color: #e6f2ff;
    text-decoration: underline;
}

/* User area (right) */
.userInfo {
    color: white;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 10px;
    flex: 0 0 auto;
    min-width: 0;
}
    .toMain {
        background: #000;
        color: #fff;
        box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    }

    .toMain:hover {
        background: #222;
    }
    @media (max-width: 768px) {
        .bar-inner {
            flex-direction: column;
            height: auto;
            padding: 15px;
            gap: 10px;
        }

        .fixed-bar {
            height: auto;
        }

        .nav-buttons {
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
    }

    @media (max-width: 480px) {
        .brand-title {
            font-size: 16px;
        }

        .brand-sub {
            font-size: 11px;
        }

        .nav-btn {
            font-size: 13px;
            padding: 8px 12px;
        }
    }

    body {
        font-family: 'Inter', sans-serif;
        margin-top: 80px;
    }

    button {
        font-family: 'Inter', sans-serif;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        border: none;
        border-radius: 9999px;
        padding: 10px 18px;
        font-size: 15px;
        font-weight: 600;
    }

    .nav-btn {
        background: none;
        color: #fff;
        padding: 0;
        font-size: 15px;
        font-weight: 600;
        border-radius: 9999px;
    }

    .nav-btn .fa {
        margin-right: 8px;
        opacity: 0.95;
    }

    .nav-btn.active {
        color: #e6f2ff;
        text-decoration: underline;
    }

    .toMain {
        background: #000;
        color: #fff;
        box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    }

    .toMain:hover {
        background: #222;
    }

    :root {
        --primary: #007bff;
        --primary-dark: #1e6fe6;
        --muted: #6b7280;
        --bg: #f5f8fb;
    }

    html, body {
        height: 100%;
        overflow-x: hidden;
        overflow-y: auto;
    }

    body {
        margin: 0;
        padding: 0;
        background: var(--bg);
        font-family: 'Inter', sans-serif;
        color: #0f172a;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    .userInfo {
        color: white;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .login-btn {
        background: white;
        color: #333;
        box-shadow: 0 2px 5px rgba(0,0,0,0.12);
    }

    .login-btn:hover {
        background: #f0f0f0;
    }

    .register-btn {
        background: #28a745;
        color: white;
        box-shadow: 0 2px 5px rgba(0,0,0,0.12);
    }

    .register-btn:hover {
        background: #218838;
    }

    .logout-btn {
        background: linear-gradient(135deg, #4b0ee5 0%, #0682d4 100%);
        color: white;
        box-shadow: 0 2px 5px rgba(0,0,0,0.12);
    }
    /*.logout-btn:hover {
        background: linear-gradient(135deg, #4b0ee5 0%, #0682d4 100%);
        opacity: 0.9;
    }*/
    .toApp-btn {
        background: #000;
        color: white;
        box-shadow: 0 2px 5px rgba(0,0,0,0.12);
    }

    .admin-btn {
        background: #6f42c1;
        color: white;
        box-shadow: 0 2px 5px rgba(0,0,0,0.12);
    }

    footer {
        background: #1a202c;
        color: #e5e7eb;
        padding: 28px 20px 16px;
        margin-top: 40px;
    }

    .footer-content {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 2fr 1fr 1fr;
        gap: 24px;
        margin-bottom: 20px;
    }

    .footer-brand {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .footer-logo {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .footer-logo-icon {
        width: 44px;
        height: 44px;
        background: var(--primary);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 20px;
    }

    .footer-logo-text {
        display: flex;
        flex-direction: column;
    }

    .footer-logo-title {
        font-size: 18px;
        font-weight: 700;
        color: white;
    }

    .footer-logo-sub {
        font-size: 11px;
        color: #9ca3af;
    }

    .footer-desc {
        color: #9ca3af;
        line-height: 1.5;
        font-size: 13px;
    }

    .footer-social {
        display: flex;
        gap: 12px;
        margin-top: 8px;
    }

    .social-icon {
        width: 36px;
        height: 36px;
        background: #374151;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        transition: all 0.3s ease;
        text-decoration: none;
    }

    .social-icon:hover {
        background: var(--primary);
        transform: translateY(-2px);
    }

    .footer-section h3 {
        font-size: 15px;
        font-weight: 700;
        color: white;
        margin: 0 0 12px 0;
    }

    .footer-links {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .footer-link {
        color: #9ca3af;
        text-decoration: none;
        font-size: 13px;
        transition: color 0.3s ease;
    }

    .footer-link:hover {
        color: var(--primary);
    }

    .footer-bottom {
        max-width: 1200px;
        margin: 0 auto;
        padding-top: 16px;
        border-top: 1px solid #374151;
        text-align: center;
        color: #9ca3af;
        font-size: 13px;
    }
</style>
</head>
<body>

<!-- ========== NAV BAR: REPLACED WITH main.html exact HTML ========== -->
<div class="fixed-bar">
    <div class="bar-inner">
        <div class="brand">
            <div class="brand-icon">
                <i class="fa-solid fa-graduation-cap"></i>
            </div>
            <div class="brand-text">
                <div class="brand-title">Con ƒë∆∞·ªùng ƒëam m√™</div>
                <div class="brand-sub">AI-Powered Learning Path</div>
            </div>
        </div>
        <div class="nav-buttons" id="mainNavButtons">
            <!-- Buttons s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JavaScript / ho·∫∑c gi·ªØ d·∫°ng tƒ©nh n·∫øu b·∫°n mu·ªën -->
            <button class="nav-btn" id="btnHome"><i class="fa-solid fa-house"></i> Trang Ch·ªß</button>
            <button class="nav-btn active" id="btnPath"><i class="fa-solid fa-route"></i> L·ªô Tr√¨nh H·ªçc</button>
            <button class="nav-btn" id="btnProgress"><i class="fa-solid fa-chart-line"></i> Ti·∫øn ƒê·ªô</button>
        </div>
        <div id="userArea" class="userInfo">
        <button class="login-btn"><i class="fa-solid fa-right-to-bracket"></i> ƒêƒÉng nh·∫≠p</button>
        <button class="register-btn"><i class="fa-solid fa-user-plus"></i> ƒêƒÉng k√Ω</button>
        </div>
    </div>
</div>
<!-- ========== END NAV BAR ========== -->

    <div class="container" style="margin-top:120px;">
        <div class="header">
            <button class="create-btn" onclick="goToCreateRoadmap()">
                ‚ûï T·∫°o L·ªô Tr√¨nh M·ªõi
            </button>
           <button class="upload-btn" onclick="openUploadModal()">
                üì§ Upload Excel
            </button>
            <h1>üõ£Ô∏è L·ªô Tr√¨nh H·ªçc C·ªßa T√¥i</h1>
            <p id="header-subtitle">ƒêang t·∫£i d·ªØ li·ªáu...</p>
        </div>
        <div class="content" id="content-area">
            <div class="loading">
                <div class="spinner"></div>
                <br><br>
                ƒêang t·∫£i l·ªô tr√¨nh h·ªçc...
            </div>
        </div>
    </div>

    <!-- Modal xem chi ti·∫øt -->
    <div class="modal-overlay" id="detailsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div>
                    <h2 id="modal-title">Chi ti·∫øt l·ªô tr√¨nh</h2>
                    <p style="opacity: 0.9;">Ph√¢n t√≠ch AI, l·ªô tr√¨nh h·ªçc chi ti·∫øt v√† ƒë√°nh gi√°</p>
                </div>
                <button class="close-modal" onclick="closeModal()">‚úï</button>
            </div>
            <div class="modal-body" id="modal-body">
                <div class="loading">
                    <div class="spinner"></div>
                    <br><br>
                    ƒêang t·∫£i chi ti·∫øt...
                </div>
            </div>
        </div>
    </div>

<!-- ========== SCRIPTS: T·∫§T C·∫¢ GI·ªÆ NGUY√äN NH∆Ø TRONG path.html ========== -->
<script>
    const token = localStorage.getItem('token');
    // (Ph·∫ßn script gi·ªØ nguy√™n ho√†n to√†n t·ª´ path.html g·ªëc)
    // M√¨nh ch√®n nguy√™n c√°c h√†m ch√≠nh: fetchRoadmaps, renderRoadmaps, displayRoadmapDetails,
    // updateStatus, submitEvaluation, upload handling, setupNavigation, initApp, v.v.
    let currentRoadmapId = null;
    let evaluationData = {};
    let allRoadmaps = [];
    // ‚úÖ H√ÄM FORMAT GI·ªú: Chuy·ªÉn s·ªë th·∫≠p ph√¢n th√†nh "X gi·ªù Y ph√∫t"
    function formatHours(hours) {
        if (!hours || isNaN(hours)) return '0m';
        
        const totalMinutes = Math.round(hours * 60);
        const h = Math.floor(totalMinutes / 60);
        const m = totalMinutes % 60;
        
        if (h === 0) return `${m}m`;
        if (m === 0) return `${h}h`;
        return `${h}h ${m}m`;
    }
    // Utility functions
    function getAuthHeaders() {
        const token = localStorage.getItem('token');
        return {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
        };
    }

    function showNotification(message, type) {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = message;
        document.body.appendChild(notification);

        setTimeout(() => notification.classList.add('show'), 100);
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }

    // ====================================================
    // FETCH ALL ROADMAPS FROM API
    // ====================================================
    async function fetchRoadmaps() {
        try {
            const response = await fetch('/api/roadmap', {
                method: 'GET',
                headers: getAuthHeaders()
            });

            if (!response.ok) {
                 showNotification('‚ùå C√≥ l·ªói x·∫£y ra khi load page' || response.statuss, 'error');
                if (response.status === 401) {
                    window.location.href = 'login.html';
                    return;
                }
            }

            const contentType = response.headers.get('content-type') || '';
            const text = await response.text();

            if (!contentType.includes('application/json')) {
                console.error('API did not return JSON. body:', text);
                throw new Error('Server did not return JSON: ' + (text.slice(0,200) || ''));
            }

            let result;
            try {
                result = JSON.parse(text);
            } catch (e) {
                console.error('Failed to parse JSON from API. raw body:', text);
                throw new Error('Invalid JSON response from server');
            }

            allRoadmaps = result.data || [];
            renderRoadmaps(allRoadmaps);

        } catch (error) {
            console.error('Error fetching roadmaps:', error);
            showNotification('‚ùå C√≥ l·ªói x·∫£y ra khi load page', 'error');
        }
    }

function getStatusBadge(roadmap) {
    const progress = parseFloat(roadmap.progress_percentage || 0);
    const status = roadmap.status; // ‚úÖ Nh·∫≠n status ƒë√£ ƒë∆∞·ª£c t√≠nh to√°n t·ª´ backend
    
    if (progress >= 100 || status === 'COMPLETED') {
        return `<span class="status-badge status-completed">Ho√†n th√†nh</span>`;
    }
    
    if (progress > 0 || status === 'IN_PROGRESS') {
        return `<span class="status-badge status-active">ƒêang h·ªçc</span>`;
    }
    
    return `<span class="status-badge status-not-started">Ch∆∞a h·ªçc</span>`;
}
function renderRoadmaps(roadmaps) {
    const contentArea = document.getElementById('content-area');
    const subtitle = document.getElementById('header-subtitle');

    if (roadmaps.length === 0) {
        subtitle.textContent = "B·∫°n ch∆∞a c√≥ l·ªô tr√¨nh h·ªçc n√†o";
        contentArea.innerHTML = `
            <div class="empty-state">
                <div class="empty-icon">üìö</div>
                <div class="empty-title">Ch∆∞a c√≥ l·ªô tr√¨nh h·ªçc</div>
                <div class="empty-text">H√£y t·∫°o l·ªô tr√¨nh h·ªçc ƒë·∫ßu ti√™n ƒë·ªÉ b·∫Øt ƒë·∫ßu h√†nh tr√¨nh h·ªçc t·∫≠p c·ªßa b·∫°n</div>
                <button class="empty-btn" onclick="goToCreateRoadmap()">
                    ‚ûï T·∫°o L·ªô Tr√¨nh M·ªõi
                </button>
            </div>
        `;
        return;
    }

    subtitle.textContent = `B·∫°n ƒëang c√≥ ${roadmaps.length} l·ªô tr√¨nh h·ªçc`;

    const roadsHTML = roadmaps.map(r => {
        // ‚úÖ T√çNH TRUNG B√åNH 5 TI√äU CH√ç
        let avgRating = null;
        if (r.overall_rating && r.learning_effectiveness && r.difficulty_suitability && r.content_relevance && r.engagement_level) {
            const sum = parseFloat(r.overall_rating) + 
                       parseFloat(r.learning_effectiveness) + 
                       parseFloat(r.difficulty_suitability) + 
                       parseFloat(r.content_relevance) + 
                       parseFloat(r.engagement_level);
            avgRating = (sum / 5).toFixed(1);
        }
        
        return `
        <div class="roadmap-card">
            <button class="delete-roadmap-btn" onclick="event.stopPropagation(); confirmDeleteRoadmap(${r.roadmap_id}, '${r.roadmap_name.replace(/'/g, "\\'")}')">
                <i class="fa-solid fa-trash"></i> X√≥a
            </button>
            <div class="roadmap-header">
                <div class="roadmap-title">${r.roadmap_name}</div>
                ${getStatusBadge(r)}
            </div>

            <div class="roadmap-meta">
                <div class="meta-item">üìÇ ${r.category}</div>
                <div class="meta-item">‚è±Ô∏è ${r.duration_days} ng√†y</div>
            </div>

            <div class="progress-section">
                <div class="progress-label">
                    <span>Ti·∫øn ƒë·ªô</span>
                    <span>${parseFloat(r.progress_percentage).toFixed(0)}%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${r.progress_percentage}%"></div>
                </div>
            </div>

            <div class="roadmap-stats">
                <div class="stat-item">
                    <div class="stat-value">${r.duration_days}</div>
                    <div class="stat-label">Ng√†y h·ªçc</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${formatHours(r.total_studied_hours)}</div>
                    <div class="stat-label">ƒê√£ h·ªçc</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${r.start_level}</div>
                    <div class="stat-label">Tr√¨nh ƒë·ªô</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${avgRating ? avgRating + '‚≠ê' : '-'}</div>
                    <div class="stat-label">ƒê√°nh gi√°</div>
                </div>
            </div>

            <button class="view-details-btn" onclick="openDetails(${r.roadmap_id})">
                üëÅÔ∏è Xem Chi Ti·∫øt
            </button>
        </div>
        `;
    }).join('');

    contentArea.innerHTML = `<div class="roadmaps-grid">${roadsHTML}</div>`;
}
    async function openDetails(roadmapId) {
        currentRoadmapId = roadmapId;
        document.getElementById('detailsModal').classList.add('active');
        const modalBody = document.getElementById('modal-body');
        modalBody.innerHTML = `
            <div class="loading">
                <div class="spinner"></div>
                <br><br>
                ƒêang t·∫£i chi ti·∫øt...
            </div>
        `;

        try {
            const response = await fetch(`/api/roadmaps/${roadmapId}`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                }
            });

            if (!response.ok) {
                throw new Error('Failed to fetch roadmap details');
            }

            const result = await response.json();
            const roadmap = result.data.roadmap;
            const details = result.data.details;

            document.getElementById('modal-title').textContent = roadmap.roadmap_name;

            displayRoadmapDetails(roadmap, details);

        } catch (error) {
            console.error('Error fetching details:', error);
            modalBody.innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon">‚ö†Ô∏è</div>
                    <div class="empty-title">Kh√¥ng th·ªÉ t·∫£i chi ti·∫øt</div>
                    <button class="empty-btn" onclick="closeModal()">ƒê√≥ng</button>
                </div>
            `;
        }
    }

function displayRoadmapDetails(roadmap, details) {
    const analysisHTML = `
        <div class="analysis-section">
            <h3>üìä Ph√¢n T√≠ch AI</h3>
            <div class="analysis-content">${roadmap.roadmap_analyst}</div>
        </div>
    `;

    const tableHTML = `
        <div class="roadmap-section">
            <h3>üìÖ L·ªô Tr√¨nh Chi Ti·∫øt</h3>
            <table>
                <thead>
                    <tr>
                        <th style="width: 60px;">Ng√†y</th>
                        <th style="width: 100px;">Ng√†y h·ªçc</th>
                        <th style="min-width: 150px;">M·ª•c ti√™u</th>
                        <th style="min-width: 150px;">N·ªôi dung</th>
                        <th style="min-width: 120px;">B√†i t·∫≠p</th>
                        <th style="min-width: 120px;">T√†i li·ªáu</th>
                        <th style="min-width: 100px;">H∆∞·ªõng d·∫´n</th>
                        <th style="width: 80px;">Th·ªùi l∆∞·ª£ng</th>
                        <th style="width: 120px;">Tr·∫°ng th√°i</th>
                    </tr>
                </thead>
                <tbody>
                    ${details.map(d => {
                        // ‚úÖ Parse multiple links from materials
                        let materialsHTML = 'N/A';
                        if (d.learning_materials) {
                            const links = d.learning_materials
                                .split(/[;\n]/)
                                .map(link => link.trim())
                                .filter(link => link && link.match(/^https?:\/\//i));
                            
                            if (links.length > 0) {
                                materialsHTML = links.map((link, idx) => {
                                    try {
                                        const domain = new URL(link).hostname.replace(/^www\./, '');
                                        return `<a href="${link}" target="_blank" style="color: #007bff; display: block; margin: 2px 0; font-size: 0.85rem;"> ${domain}</a>`;
                                    } catch (e) {
                                        return `<span style="color: #6b7280; font-size: 0.85rem;">Link ${idx + 1}</span>`;
                                    }
                                }).join('');
                            } else if (d.learning_materials.trim()) {
                                materialsHTML = `<span style="font-size: 0.85rem;">${d.learning_materials}</span>`;
                            }
                        }

                        return `
                        <tr>
                            <td class="day-cell">${d.day_number}</td>
                            <td class="date-cell">${d.study_date ? new Date(d.study_date).toLocaleDateString('vi-VN') : 'N/A'}</td>
                            <td><strong>${d.daily_goal || 'N/A'}</strong></td>
                            <td>${d.learning_content || 'N/A'}</td>
                            <td>${d.practice_exercises || 'N/A'}</td>
                            <td>${materialsHTML}</td>
                            <td>${d.usage_instructions || 'N/A'}</td>
                            <td style="text-align: center;"><strong>${formatHours(d.study_duration_hours)}</strong></td>
                            <td>
                                <select onchange="updateStatus(${roadmap.roadmap_id}, ${d.detail_id}, this.value)">
                                    <option value="NOT_STARTED" ${d.completion_status === 'NOT_STARTED' ? 'selected' : ''}>Ch∆∞a b·∫Øt ƒë·∫ßu</option>
                                    <option value="IN_PROGRESS" ${d.completion_status === 'IN_PROGRESS' ? 'selected' : ''}>ƒêang h·ªçc</option>
                                    <option value="COMPLETED" ${d.completion_status === 'COMPLETED' ? 'selected' : ''}>Ho√†n th√†nh</option>
                                    <option value="SKIPPED" ${d.completion_status === 'SKIPPED' ? 'selected' : ''}>B·ªè qua</option>
                                </select>
                            </td>
                        </tr>
                        `;
                    }).join('')}
                </tbody>
            </table>
        </div>
    `;

    const evaluationHTML = buildEvaluationForm(roadmap);

    document.getElementById('modal-body').innerHTML = analysisHTML + tableHTML + evaluationHTML;
}
function buildEvaluationForm(roadmap) {
    // ‚úÖ H√†m helper ƒë·ªÉ render stars v·ªõi gi√° tr·ªã hi·ªán t·∫°i
    const renderRatingGroup = (fieldName, label, currentValue) => {
        const value = currentValue || 0;
        const starsHtml = [1,2,3,4,5].map(i => 
            `<span class="star ${value >= i ? 'active' : ''}" onclick="setRating('${fieldName}', ${i})">‚òÖ</span>`
        ).join('');
        
        return `
            <div class="rating-group">
                <label>${label} *</label>
                <div class="rating-stars" id="${fieldName}">
                    ${starsHtml}
                </div>
                <div class="rating-value">Ch·ªçn: <span id="${fieldName}-value">${value}</span>/5</div>
            </div>
        `;
    };

    return `
        <div class="evaluation-section">
            <h3>‚≠ê ƒê√°nh Gi√° L·ªô Tr√¨nh</h3>
            
            ${renderRatingGroup('overall_rating', 'ƒê√°nh gi√° t·ªïng th·ªÉ l·ªô tr√¨nh (1-5 sao)', roadmap.overall_rating)}
            ${renderRatingGroup('learning_effectiveness', 'Hi·ªáu qu·∫£ h·ªçc t·∫≠p (1-5 sao)', roadmap.learning_effectiveness)}
            ${renderRatingGroup('difficulty_suitability', 'ƒê·ªô kh√≥ ph√π h·ª£p (1-5 sao)', roadmap.difficulty_suitability)}
            ${renderRatingGroup('content_relevance', 'T√≠nh li√™n quan n·ªôi dung (1-5 sao)', roadmap.content_relevance)}
            ${renderRatingGroup('engagement_level', 'T√≠nh h·∫•p d·∫´n l·ªô tr√¨nh (1-5 sao)', roadmap.engagement_level)}

            <div class="textarea-group">
                <label>Nh·∫≠n x√©t chi ti·∫øt v·ªÅ l·ªô tr√¨nh</label>
                <textarea id="detailed_feedback" placeholder="Chia s·∫ª nh·∫≠n x√©t c·ªßa b·∫°n..." onchange="evaluationData['detailed_feedback'] = this.value">${roadmap.detailed_feedback || ''}</textarea>
            </div>

            <div class="select-group">
                <label>ƒê·ªÅ xu·∫•t danh m·ª•c ph√π h·ª£p h∆°n (n·∫øu c√≥)</label>
                <select id="recommended_category" onchange="evaluationData['recommended_category'] = this.value">
                    <option value="">Kh√¥ng c√≥ ƒë·ªÅ xu·∫•t</option>
                    <option value="L·∫≠p tr√¨nh" ${roadmap.recommended_category === 'L·∫≠p tr√¨nh' ? 'selected' : ''}>L·∫≠p tr√¨nh</option>
                    <option value="Marketing" ${roadmap.recommended_category === 'Marketing' ? 'selected' : ''}>Marketing</option>
                    <option value="Thi·∫øt k·∫ø" ${roadmap.recommended_category === 'Thi·∫øt k·∫ø' ? 'selected' : ''}>Thi·∫øt k·∫ø</option>
                    <option value="Ngo·∫°i ng·ªØ" ${roadmap.recommended_category === 'Ngo·∫°i ng·ªØ' ? 'selected' : ''}>Ngo·∫°i ng·ªØ</option>
                    <option value="Kinh doanh" ${roadmap.recommended_category === 'Kinh doanh' ? 'selected' : ''}>Kinh doanh</option>
                </select>
            </div>

            <div class="textarea-group">
                <label>K·∫øt qu·∫£ h·ªçc ƒë∆∞·ª£c th·ª±c t·∫ø sau ho√†n th√†nh</label>
                <textarea id="actual_learning_outcomes" placeholder="M√¥ t·∫£ k·ªπ nƒÉng b·∫°n ƒë√£ h·ªçc ƒë∆∞·ª£c..." onchange="evaluationData['actual_learning_outcomes'] = this.value">${roadmap.actual_learning_outcomes || ''}</textarea>
            </div>

            <div class="textarea-group">
                <label>ƒê·ªÅ xu·∫•t c·∫£i thi·ªán l·ªô tr√¨nh</label>
                <textarea id="improvement_suggestions" placeholder="G·ª£i √Ω c·∫£i thi·ªán..." onchange="evaluationData['improvement_suggestions'] = this.value">${roadmap.improvement_suggestions || ''}</textarea>
            </div>

            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="would_recommend" ${roadmap.would_recommend ? 'checked' : ''} onchange="evaluationData['would_recommend'] = this.checked">
                    <span>T√¥i s·∫Ω gi·ªõi thi·ªáu l·ªô tr√¨nh n√†y cho ng∆∞·ªùi kh√°c</span>
                </label>
            </div>

            <button class="submit-evaluation-btn" onclick="submitEvaluation()">
                üíæ L∆∞u ƒê√°nh Gi√°
            </button>
        </div>
    `;
}
    // SET RATING
function setRating(fieldName, value) {
    evaluationData[fieldName] = value;
    
    const starContainer = document.getElementById(fieldName);
    if (starContainer) {
        const stars = starContainer.querySelectorAll('.star');
        stars.forEach((star, index) => {
            if (index < value) {
                star.classList.add('active');
            } else {
                star.classList.remove('active');
            }
        });
    }
    
    // ‚úÖ C·∫¨P NH·∫¨T TEXT HI·ªÇN TH·ªä
    const valueSpan = document.getElementById(`${fieldName}-value`);
    if (valueSpan) {
        valueSpan.textContent = value;
    }
}

    // UPDATE STATUS
    async function updateStatus(roadmapId, detailId, status) {
        try {
            const response = await fetch(`/api/roadmap/${roadmapId}/update-status`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                },
                body: JSON.stringify({
                    detailId: detailId,
                    status: status,
                    studyDate: status === 'COMPLETED' ? new Date().toISOString().split('T')[0] : null
                })
            });

            if (!response.ok) {
                throw new Error('Failed to update status');
            }

            const result = await response.json();
            
            showNotification('‚úì ƒê√£ c·∫≠p nh·∫≠t tr·∫°ng th√°i!', 'success');
            
            await fetchRoadmaps();

        } catch (error) {
            console.error('Error updating status:', error);
            showNotification('‚úó Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i', 'error');
        }
    }
// SUBMIT EVALUATION
async function submitEvaluation() {
    // ‚úÖ CH·ªà KI·ªÇM TRA C√ÅC FIELD CH∆ØA C√ì GI√Å TR·ªä
    const requiredFields = ['overall_rating', 'learning_effectiveness', 'difficulty_suitability', 'content_relevance', 'engagement_level'];
    const missingFields = requiredFields.filter(field => !evaluationData[field]);
    
    if (missingFields.length > 0) {
        showNotification(`‚ö† Vui l√≤ng ƒë√°nh gi√° t·∫•t c·∫£ 5 ti√™u ch√≠!`, 'error');
        return;
    }

    const submitBtn = document.querySelector('.submit-evaluation-btn');
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<div class="loading"><div class="spinner"></div> ƒêang l∆∞u...</div>';

    try {
        const payload = {
            overall_rating: evaluationData.overall_rating,
            learning_effectiveness: evaluationData.learning_effectiveness,
            difficulty_suitability: evaluationData.difficulty_suitability,
            content_relevance: evaluationData.content_relevance,
            engagement_level: evaluationData.engagement_level,
            detailed_feedback: document.getElementById('detailed_feedback').value || '',
            recommended_category: document.getElementById('recommended_category').value || '',
            actual_learning_outcomes: document.getElementById('actual_learning_outcomes').value || '',
            improvement_suggestions: document.getElementById('improvement_suggestions').value || '',
            would_recommend: document.getElementById('would_recommend').checked
        };

        const response = await fetch(`/api/roadmap/${currentRoadmapId}/submit-evaluation`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('token')}`
            },
            body: JSON.stringify(payload)
        });

        if (!response.ok) {
            throw new Error('Failed to submit evaluation');
        }

        showNotification('‚úì ƒê√°nh gi√° ƒë√£ ƒë∆∞·ª£c l∆∞u th√†nh c√¥ng!', 'success');
        
        setTimeout(() => {
            closeModal();
            fetchRoadmaps();
        }, 1500);

    } catch (error) {
        console.error('Error submitting evaluation:', error);
        showNotification('‚úó C√≥ l·ªói x·∫£y ra khi l∆∞u ƒë√°nh gi√°', 'error');
        submitBtn.disabled = false;
        submitBtn.innerHTML = 'üíæ L∆∞u ƒê√°nh Gi√°';
    }
}
    function closeModal() {
        document.getElementById('detailsModal').classList.remove('active');
    }

    function goToCreateRoadmap() {
        window.location.href = 'create_roadmap_page.html';
    }

    // Close modal when clicking outside
    document.getElementById('detailsModal').addEventListener('click', function(e) {
        if (e.target === this) closeModal();
    });

    // Navigation setup (gi·ªØ nguy√™n behavior path.html)
    function setupNavigation() {
      const btnPath = document.getElementById('btnPath');
      const btnProgress = document.getElementById('btnProgress');
      const btnHome = document.getElementById('btnHome');

      if (btnPath) {
        btnPath.addEventListener('click', () => { 
          window.location.href = 'path.html';
        });
      }

      if (btnProgress) {
        btnProgress.addEventListener('click', () => { 
          window.location.href = 'progress.html';
        });
      }

      if (btnHome) {
        btnHome.addEventListener('click', () => { 
          window.location.href = 'main.html'; 
        });
      }

      // Check for admin role and add admin button
      const role = localStorage.getItem('role');
      if (role === 'admin') {
        const navButtons = document.getElementById('navButtons') || document.getElementById('mainNavButtons');
        if (navButtons) {
            const adminBtn = document.createElement('button');
            adminBtn.className = 'nav-btn';
            adminBtn.id = 'btnAdmin';
            adminBtn.innerHTML = '<i class="fa-solid fa-user-shield"></i> Qu·∫£n Tr·ªã';
            adminBtn.addEventListener('click', () => { 
              window.location.href = 'admin.html?page=admin'; 
            });
            navButtons.appendChild(adminBtn);
        }
      }

      // Set active state based on current page
      const params = new URLSearchParams(window.location.search);
      const page = params.get('page') || 'path';
      document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
      const idMap = { path: 'btnPath', progress: 'btnProgress', admin: 'btnAdmin', home: 'btnHome' };
      const btnId = idMap[page];
      if (btnId) {
        const el = document.getElementById(btnId);
        if (el) el.classList.add('active');
      }
    }

    // Upload modal handling (gi·ªØ nguy√™n)
function openUploadModal() {
    console.log('üîì Opening upload modal...');
    const modal = document.getElementById('uploadModal');
    if (modal) {
        modal.classList.add('active');
        console.log('‚úÖ Modal opened');
    } else {
        console.error('‚ùå uploadModal element not found!');
    }
}

    function closeUploadModal() {
        document.getElementById('uploadModal').classList.remove('active');
        const f = document.getElementById('uploadForm');
        if (f) f.reset();
    }

    async function confirmDeleteRoadmap(roadmapId, roadmapName) {
        if (!confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a l·ªô tr√¨nh "${roadmapName}"?\n\nH√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.`)) {
            return;
        }
        
        try {
            const response = await fetch(`/api/roadmaps/${roadmapId}`, {
                method: 'DELETE',
                headers: getAuthHeaders()
            });
            
            if (!response.ok) throw new Error('Delete failed');
            
            showNotification('‚úÖ ƒê√£ x√≥a l·ªô tr√¨nh th√†nh c√¥ng!', 'success');
            await fetchRoadmaps();
        } catch (error) {
            console.error('Error deleting roadmap:', error);
            showNotification('‚ùå Kh√¥ng th·ªÉ x√≥a l·ªô tr√¨nh', 'error');
        }
    }

    // Init
    function checkAuth() {
        const token = localStorage.getItem('token');
        if (!token) {
            // N·∫øu b·∫°n mu·ªën redirect non-auth users, gi·ªØ behavior g·ªëc path.html
            // window.location.href = 'login.html';
            return false;
        }
        return true;
    }

    function initApp() {
        // B·∫°n g·ªëc c√≥ checkAuth -> n·∫øu mu·ªën gi·ªØ redirect uncomment:
        // if (!checkAuth()) return;
        setupNavigation();
        fetchRoadmaps();
    }

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initApp);
    } else {
        initApp();
    }

    // Upload modal close on overlay click
document.addEventListener('DOMContentLoaded', function() {
    const uploadForm = document.getElementById('uploadForm');
    if (uploadForm) {
        uploadForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<div class="spinner"></div> ƒêang upload...';
            
            const formData = new FormData(e.target);
            
            // ‚úÖ VALIDATE FORM TR∆Ø·ªöC KHI G·ª¨I
            const roadmap_name = formData.get('roadmap_name');
            const category = formData.get('category');
            const start_level = formData.get('start_level');
            const expected_outcome = formData.get('expected_outcome');
            const file = formData.get('file');
            
            console.log('üì§ Form validation:', {
                roadmap_name: roadmap_name ? `"${roadmap_name}"` : '‚ùå EMPTY',
                category: category ? `"${category}"` : '‚ùå EMPTY',
                start_level: start_level ? `"${start_level}"` : '‚ùå EMPTY',
                expected_outcome: expected_outcome ? `"${expected_outcome}"` : '‚ùå EMPTY',
                file: file ? `‚úÖ ${file.name}` : '‚ùå NO FILE'
            });
            
            // ‚úÖ CHECK VALIDATION
            if (!roadmap_name || !category || !start_level || !expected_outcome || !file) {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
                
                const missing = [];
                if (!roadmap_name) missing.push('T√™n l·ªô tr√¨nh');
                if (!category) missing.push('Danh m·ª•c');
                if (!start_level) missing.push('Tr√¨nh ƒë·ªô');
                if (!expected_outcome) missing.push('K·∫øt qu·∫£ mong ƒë·ª£i');
                if (!file) missing.push('File Excel');
                
                showNotification(`‚ùå Thi·∫øu th√¥ng tin: ${missing.join(', ')}`, 'error');
                return;
            }
            
            try {
                console.log('üöÄ Sending upload request...');
                
                const response = await fetch('/api/roadmaps/upload', {
                    method: 'POST',
                    headers: { 
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: formData
                });
                
                console.log('üì• Response status:', response.status);
                
                const result = await response.json();
                console.log('üì• Response data:', result);
                
                if (result.success) {
                    showNotification('‚úÖ ' + result.message, 'success');
                    closeUploadModal();
                    setTimeout(() => fetchRoadmaps(), 500);
                } else {
                    console.error('‚ùå Upload failed:', result);
                    showNotification('‚ùå ' + (result.error || 'L·ªói kh√¥ng x√°c ƒë·ªãnh'), 'error');
                }
            } catch (error) {
                console.error('‚ùå Upload error:', error);
                showNotification('‚ùå L·ªói khi upload file: ' + error.message, 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        });
    }
    
    // ƒê√≥ng modal khi click b√™n ngo√†i
    const uploadModal = document.getElementById('uploadModal');
    if (uploadModal) {
        uploadModal.addEventListener('click', function(e) {
            if (e.target === this) {
                closeUploadModal();
            }
        });
    }
});
</script>

<!-- Modal Upload Excel (gi·ªØ nguy√™n t·ª´ path.html) -->
<!-- Modal Upload Excel -->
<div class="modal-overlay" id="uploadModal">
    <div class="modal-content">
        <div class="modal-header">
            <div>
                <h2>üì§ Upload L·ªô Tr√¨nh t·ª´ Excel</h2>
                <p>File Excel ph·∫£i c√≥ ƒë√∫ng 8 c·ªôt theo th·ª© t·ª±</p>
            </div>
            <button class="close-modal" onclick="closeUploadModal()">‚úï</button>
        </div>
        <div class="modal-body">
            <div class="info-box">
                <strong>‚ö†Ô∏è L∆∞u √Ω:</strong> File Excel ph·∫£i c√≥ <strong>ƒë√∫ng 8 c·ªôt</strong> theo th·ª© t·ª±:
                <ol style="margin: 10px 0 0 20px; line-height: 1.8;">
                    <li><code>day_number</code> - S·ªë ng√†y</li>
                    <li><code>day_study</code> - Ng√†y h·ªçc</li>
                    <li><code>daily_goal</code> - M·ª•c ti√™u ng√†y</li>
                    <li><code>learning_content</code> - N·ªôi dung h·ªçc</li>
                    <li><code>practice_exercises</code> - B√†i t·∫≠p</li>
                    <li><code>learning_materials</code> - T√†i li·ªáu</li>
                    <li><code>guide_learning</code> - H∆∞·ªõng d·∫´n h·ªçc t·∫≠p</li>
                    <li><code>study_duration_hours</code> - S·ªë gi·ªù</li>
                </ol>

                <br>
                V√≠ d·ª• h√¨nh cho file excel m·∫´u:
                <br><br>
                <img src="https://i.postimg.cc/sfP8Rhch/image.png">
                <p style="margin-top: 10px; color: #856404;">
                    <strong>L∆∞u √Ω th√™m:</strong>
                    <ul style="margin: 10px 0 0 20px; line-height: 1.8; ">
                        <li>·ªû d√≤ng ƒë√¢u ti√™n c·ªßa file excel ph·∫£i l√† t√™n c√°c c·ªôt theo th·ª© t·ª± nh∆∞ tr√™n</li>
                        <li><code>day_number</code> v√† <code>study_duration_hours</code> l√† b·∫Øt bu·ªôc ph·∫£i c√≥ gi√° tr·ªã. C√°c c·ªôt kh√°c c√≥ th·ªÉ ƒë·ªÉ tr·ªëng.</li>
                        <li><code>day_number</code> ph·∫£i c√≥ gi√° tr·ªã tƒÉng 1 ƒë∆°n v·ªã t·ª´ 1 tr·ªü ƒëi (v√≠ d·ª• 1, 2, 3...)</li>
                        <li><code>study_duration_hours</code> c√≥ d·∫•u th·∫≠p ph√¢n l√† . v√† t·ªëi thi·ªÉu l√† 0.5 (v√≠ d·ª• 0.5, 2, 3.5,...)</li>
                        <li>ƒê·ªãnh d·∫°ng c·ªßa <code>day_study</code> l√† d∆∞·ªõi d·∫°ng dd/mm/yyyy (n·∫øu s·ªë trong day ho·∫∑c month c√≥ 1 ch·ªØ s·ªë th√¨ th√™m s·ªë 0 ·ªü ƒë·∫ßu) (v√≠ d·ª• 26/10/2027 hay 06/01/2027)</li>
                        <li>Ng√†y ƒë·∫ßu ti√™n c·ªßa l·ªô tr√¨nh b·∫Øt bu·ªôc ph·∫£i c√≥ <code>day_study</code> ng√†y sau ng√†y hi·ªán t·∫°i</li>
                        <li>C·ªôt <code>day_study</code> ph·∫£i c√≥ d·∫•u ' ƒë·∫±ng tr∆∞·ªõc</li>
                        <li>File ƒë·ªãnh d·∫°ng ph·∫£i l√† .xlsx ho·∫∑c .xls</li>
                    </ul>
                </p>
            </div>

            <form id="uploadForm" enctype="multipart/form-data">
                <div class="form-group">
                    <label>T√™n l·ªô tr√¨nh *</label>
                    <input type="text" name="roadmap_name" required placeholder="V√≠ d·ª•: H·ªçc Python c∆° b·∫£n">
                </div>
                
                <div class="form-group">
                    <label>Danh m·ª•c *</label>
                    <input type="text" name="category" required placeholder="V√≠ d·ª•: L·∫≠p tr√¨nh">
                </div>
                
                <div class="form-group">
                    <label>Danh m·ª•c chi ti·∫øt</label>
                    <input type="text" name="sub_category" placeholder="V√≠ d·ª•: Python Programming">
                </div>
                
                <div class="form-group">
                    <label>Tr√¨nh ƒë·ªô *</label>
                    <select name="start_level" required>
                        <option value="">-- Ch·ªçn tr√¨nh ƒë·ªô --</option>
                        <option value="M·ªõi b·∫Øt ƒë·∫ßu">M·ªõi b·∫Øt ƒë·∫ßu</option>
                        <option value="C∆° b·∫£n">C∆° b·∫£n</option>
                        <option value="Trung b√¨nh">Trung b√¨nh</option>
                        <option value="Kh√° t·ªët">Kh√° t·ªët</option>
                        <option value="N√¢ng cao">N√¢ng cao</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>K·∫øt qu·∫£ mong ƒë·ª£i *</label>
                    <textarea name="expected_outcome" required placeholder="M√¥ t·∫£ nh·ªØng g√¨ b·∫°n mu·ªën ƒë·∫°t ƒë∆∞·ª£c sau khi ho√†n th√†nh l·ªô tr√¨nh n√†y..." rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label>File Excel * (.xlsx ho·∫∑c .xls)</label>
                    <input type="file" name="file" accept=".xlsx,.xls" required>
                </div>
                
                <button type="submit" class="submit-btn">
                    <i class="fa-solid fa-upload"></i> Upload L·ªô Tr√¨nh
                </button>
            </form>
        </div>
    </div>
</div>

<!-- ========== FOOTER: REPLACED WITH main.html exact HTML ========== -->
<footer>
    <div class="footer-content">
        <div class="footer-brand">
            <div class="footer-logo">
                <div class="footer-logo-icon">
                    <i class="fa-solid fa-graduation-cap"></i>
                </div>
                <div class="footer-logo-text">
                    <div class="footer-logo-title">Con ƒë∆∞·ªùng ƒëam m√™</div>
                    <div class="footer-logo-sub">AI-Powered Learning Path</div>
                </div>
            </div>
            <p class="footer-desc">N·ªÅn t·∫£ng h·ªçc t·∫≠p c√° nh√¢n h√≥a s·ª≠ d·ª•ng tr√≠ tu·ªá nh√¢n t·∫°o ƒë·ªÉ t·∫°o l·ªô tr√¨nh h·ªçc ph√π h·ª£p v·ªõi s·ªü th√≠ch v√† m·ª•c ti√™u c·ªßa t·ª´ng ng∆∞·ªùi.</p>
            <!--<div class="footer-social">
                <a href="#" class="social-icon"><i class="fa-brands fa-facebook-f"></i></a>
                <a href="#" class="social-icon"><i class="fa-brands fa-twitter"></i></a>
                <a href="#" class="social-icon"><i class="fa-brands fa-linkedin-in"></i></a>
            </div>-->
        </div>

            <div class="footer-section">
                <h3>T√≠nh NƒÉng</h3>
                <div class="footer-links">
                    <a href="create_roadmap_page.html" class="footer-link">T·∫°o l·ªô tr√¨nh v·ªõi AI</a>
                    <a href="path.html" class="footer-link">L∆∞u tr·ªØ c√°c l·ªô tr√¨nh</a>
                    <a href="progress.html" class="footer-link">Theo d√µi ti·∫øn ƒë·ªô</a>
                </div>
            </div>

        <div class="footer-section">
            <h3>H·ªó Tr·ª£</h3>
            <div class="footer-links">
                <a href="https://mail.google.com/mail/?view=cm&fs=1&to=passionpathaisystem@gmail.com" target="_blank" rel="noopener noreferrer" class="footer-link">Li√™n h·ªá</a>
                <a href="https://zalo.me/g/drfrli672" target="_blank" rel="noopener noreferrer" class="footer-link">Trung t√¢m tr·ª£ gi√∫p</a>
                <a href="javascript:void(0)" onclick="openFeedbackModal()" class="footer-link">Thu th·∫≠p √Ω ki·∫øn</a>
            </div>
        </div>
    </div>

    <div class="footer-bottom">
        ¬© 2025 Con ƒë∆∞·ªùng ƒëam m√™. All rights reserved. Made with <i class="fa-solid fa-heart" style="color:#e74c3c;"></i> for learners worldwide.
    </div>
</footer>
<!-- ========== END FOOTER ========== -->
<script>
/* ---------- b·∫Øt ch∆∞·ªõc behavior t·ª´ main.html (d√°n v√†o path.html) ---------- */
const ADMIN_TOKEN = 'admin-token';

function showAuthButtons(userArea, loginBtn, registerBtn) {
  if (loginBtn) loginBtn.style.display = "inline-flex";
  if (registerBtn) registerBtn.style.display = "inline-flex";

  if (userArea) {
    const children = Array.from(userArea.children);
    children.forEach(c => {
      if (!c.classList.contains('login-btn') && !c.classList.contains('register-btn')) {
        try { userArea.removeChild(c); } catch (e) {}
      }
    });
  }
}

function wireLogoutAndNav(logoutEl) {
  if (!logoutEl) return;
  logoutEl.addEventListener('click', () => {
    localStorage.removeItem('token');
    localStorage.removeItem('role');
    
    // ‚úÖ REDIRECT V·ªÄ MAIN.HTML NGAY L·∫¨P T·ª®C
    window.location.href = 'main.html';
  });
}

async function loadUser() {
  const token = localStorage.getItem('token');

  // h·ªó tr·ª£ c·∫£ 2 id navButtons (mainNavButtons trong main.html) v√† navButtons (trong path.html g·ªëc)
  const navButtons = document.getElementById('mainNavButtons') || document.getElementById('navButtons');
  const userArea = document.getElementById('userArea') || document.querySelector('.userInfo');

  // Ensure nav exists (so nav buttons visible)
  if (navButtons) {
    // n·∫øu b·∫°n mu·ªën gi·ªØ c·∫•u tr√∫c nav gi·ªëng main, uncomment/adjust theo needs:
    // navButtons.innerHTML = `...` (kh√¥ng b·∫Øt bu·ªôc)
  }

  const loginBtn = userArea ? userArea.querySelector('.login-btn') : document.querySelector('.login-btn');
  const registerBtn = userArea ? userArea.querySelector('.register-btn') : document.querySelector('.register-btn');

  // lu√¥n show 2 n√∫t tr∆∞·ªõc, n·∫øu login kh√¥ng t·ªìn t·∫°i s·∫Ω t·∫°o
  showAuthButtons(userArea, loginBtn, registerBtn);

  if (!token) return;

  let name = 'Ng∆∞·ªùi d√πng';
  let serverRole = 'user';

  if (token === ADMIN_TOKEN) {
    name = 'Admin';
    serverRole = 'admin';
    localStorage.setItem('role', 'admin');
  } else {
    try {
      const res = await fetch('/api/me', { headers: { 'Authorization': 'Bearer ' + token }});
      if (!res.ok) {
        // token h·ªèng => show n√∫t auth v√† exit
        showAuthButtons(userArea, loginBtn, registerBtn);
        return;
      }
      const data = await res.json();
      serverRole = (data && (data.role || (data.user && data.user.role))) ? (data.role || data.user.role) : 'user';
      name = (data && data.user && data.user.name) ? data.user.name : name;
      localStorage.setItem('role', serverRole);
    } catch (err) {
      console.error('loadUser error', err);
      showAuthButtons(userArea, loginBtn, registerBtn);
      return;
    }
  }

  // ·∫©n 2 n√∫t login/register n·∫øu c√≥
  if (loginBtn) loginBtn.style.display = 'none';
  if (registerBtn) registerBtn.style.display = 'none';

  if (userArea) {
    userArea.innerHTML = `
      <span>Xin ch√†o <strong style="color:white;">${name}</strong></span>
      <button id="logout" class="logout-btn"><i class="fa-solid fa-right-from-bracket"></i> ƒêƒÉng xu·∫•t</button>
    `;
    const logoutEl = document.getElementById('logout');
    wireLogoutAndNav(logoutEl);
  }

  // n·∫øu l√† admin th√¨ th√™m n√∫t admin v√†o nav
  if (serverRole === 'admin' && navButtons) {
    if (!document.getElementById('btnAdmin')) {
      const adminBtn = document.createElement('button');
      adminBtn.className = 'nav-btn';
      adminBtn.id = 'btnAdmin';
      adminBtn.innerHTML = '<i class="fa-solid fa-user-shield"></i> Qu·∫£n tr·ªã';
      adminBtn.addEventListener('click', () => { window.location.href = 'admin.html?page=admin'; });
      navButtons.appendChild(adminBtn);
    }
  }
}

/* g·ªçi loadUser khi DOM s·∫µn s√†ng */
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', loadUser);
} else {
  loadUser();
}
</script>
<!-- Modal Thu th·∫≠p √Ω ki·∫øn -->
<div class="modal-overlay" id="feedbackModal">
    <div class="modal-content" style="max-width: 900px;">
        <div class="modal-header">
            <div>
                <h2>üìã Thu Th·∫≠p √ù Ki·∫øn</h2>
                <p>ƒê√°nh gi√° tr·∫£i nghi·ªám c·ªßa b·∫°n v·ªõi h·ªá th·ªëng</p>
            </div>
            <button class="close-modal" onclick="closeFeedbackModal()">‚úï</button>
        </div>
        <div class="modal-body">
            <div class="info-box" style="margin-bottom: 20px;">
                <strong>üìå M·ª•c ƒë√≠ch thu th·∫≠p:</strong>
                <p style="margin: 10px 0 0 0; line-height: 1.6;">
                    K·∫øt qu·∫£ kh·∫£o s√°t s·∫Ω ƒë∆∞·ª£c t·ªïng h·ª£p nh·∫±m ho√†n thi·ªán m√¥ h√¨nh thi·∫øt k·∫ø l·ªô tr√¨nh h·ªçc c√° nh√¢n h√≥a, 
                    ƒë·∫£m b·∫£o t√≠nh hi·ªáu qu·∫£ v√† tr·∫£i nghi·ªám t·ªët h∆°n cho ng∆∞·ªùi d√πng.
                </p>
            </div>

            <form id="feedbackForm">
                <div style="background: #f0f9ff; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h3 style="color: #0369a1; margin-bottom: 15px;">‚≠ê ƒê√°nh Gi√° (1-5)</h3>
                    <p class="small" style="margin-bottom: 20px;">
                        Sau khi tr·∫£i nghi·ªám l·ªô tr√¨nh h·ªçc c√° nh√¢n h√≥a, vui l√≤ng cho √Ω ki·∫øn ƒë√°nh gi√° theo c√°c ti√™u ch√≠ sau 
                        (ch·ªçn 1‚Üí5, trong ƒë√≥ 1 = ch∆∞a t·ªët, 5 = r·∫•t t·ªët)
                    </p>

                    <!-- Rating 1 -->
                    <div class="rating-group">
                        <label>1. M·ª©c ƒë·ªô ph√π h·ª£p c·ªßa n·ªôi dung h·ªçc *</label>
                        <div class="rating-stars" id="rating_1">
                            <span class="star" onclick="setFeedbackRating('rating_1', 1)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_1', 2)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_1', 3)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_1', 4)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_1', 5)">‚òÖ</span>
                        </div>
                        <div class="rating-value">Ch·ªçn: <span id="rating_1-value">0</span>/5</div>
                    </div>

                    <!-- Rating 2 -->
                    <div class="rating-group">
                        <label>2. M·ª©c ƒë·ªô h·ªØu √≠ch c·ªßa h·ªçc li·ªáu (link, b√†i t·∫≠p, h∆∞·ªõng d·∫´n) *</label>
                        <div class="rating-stars" id="rating_2">
                            <span class="star" onclick="setFeedbackRating('rating_2', 1)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_2', 2)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_2', 3)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_2', 4)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_2', 5)">‚òÖ</span>
                        </div>
                        <div class="rating-value">Ch·ªçn: <span id="rating_2-value">0</span>/5</div>
                    </div>

                    <!-- Rating 3 -->
                    <div class="rating-group">
                        <label>3. T√≠nh d·ªÖ hi·ªÉu, d·ªÖ √°p d·ª•ng *</label>
                        <div class="rating-stars" id="rating_3">
                            <span class="star" onclick="setFeedbackRating('rating_3', 1)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_3', 2)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_3', 3)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_3', 4)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_3', 5)">‚òÖ</span>
                        </div>
                        <div class="rating-value">Ch·ªçn: <span id="rating_3-value">0</span>/5</div>
                    </div>

                    <!-- Rating 4 -->
                    <div class="rating-group">
                        <label>4. T√≠nh th·ª±c t·∫ø v√† kh·∫£ nƒÉng ·ª©ng d·ª•ng v√†o c√¥ng vi·ªác / h·ªçc t·∫≠p *</label>
                        <div class="rating-stars" id="rating_4">
                            <span class="star" onclick="setFeedbackRating('rating_4', 1)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_4', 2)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_4', 3)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_4', 4)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_4', 5)">‚òÖ</span>
                        </div>
                        <div class="rating-value">Ch·ªçn: <span id="rating_4-value">0</span>/5</div>
                    </div>

                    <!-- Rating 5 -->
                    <div class="rating-group">
                        <label>5. T√≠nh c√° nh√¢n h√≥a (ph√π h·ª£p phong c√°ch h·ªçc, m·ª•c ti√™u c√° nh√¢n) *</label>
                        <div class="rating-stars" id="rating_5">
                            <span class="star" onclick="setFeedbackRating('rating_5', 1)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_5', 2)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_5', 3)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_5', 4)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_5', 5)">‚òÖ</span>
                        </div>
                        <div class="rating-value">Ch·ªçn: <span id="rating_5-value">0</span>/5</div>
                    </div>

                    <!-- Rating 6 -->
                    <div class="rating-group">
                        <label>6. M·ª©c ƒë·ªô duy tr√¨ ƒë·ªông l·ª±c h·ªçc *</label>
                        <div class="rating-stars" id="rating_6">
                            <span class="star" onclick="setFeedbackRating('rating_6', 1)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_6', 2)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_6', 3)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_6', 4)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_6', 5)">‚òÖ</span>
                        </div>
                        <div class="rating-value">Ch·ªçn: <span id="rating_6-value">0</span>/5</div>
                    </div>

                    <!-- Rating 7 -->
                    <div class="rating-group">
                        <label>7. Tr·∫£i nghi·ªám t·ªïng th·ªÉ v·ªõi h·ªá th·ªëng *</label>
                        <div class="rating-stars" id="rating_7">
                            <span class="star" onclick="setFeedbackRating('rating_7', 1)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_7', 2)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_7', 3)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_7', 4)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_7', 5)">‚òÖ</span>
                        </div>
                        <div class="rating-value">Ch·ªçn: <span id="rating_7-value">0</span>/5</div>
                    </div>

                    <!-- Rating 8 -->
                    <div class="rating-group">
                        <label>8. S·ª± ti·ªán l·ª£i c·ªßa ng∆∞·ªùi d√πng sau khi h·ªçc xong l·ªô tr√¨nh *</label>
                        <div class="rating-stars" id="rating_8">
                            <span class="star" onclick="setFeedbackRating('rating_8', 1)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_8', 2)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_8', 3)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_8', 4)">‚òÖ</span>
                            <span class="star" onclick="setFeedbackRating('rating_8', 5)">‚òÖ</span>
                        </div>
                        <div class="rating-value">Ch·ªçn: <span id="rating_8-value">0</span>/5</div>
                    </div>
                </div>

                <!-- C√¢u h·ªèi m·ªü -->
                <div style="background: #fef3c7; padding: 20px; border-radius: 12px; margin-top: 20px;">
                    <h3 style="color: #92400e; margin-bottom: 15px;">üí¨ C√¢u H·ªèi M·ªü</h3>

                    <div class="textarea-group">
                        <label>1. B·∫°n th√≠ch nh·∫•t ƒëi·ªÉm n√†o trong l·ªô tr√¨nh h·ªçc n√†y?</label>
                        <textarea id="question_1" rows="3" placeholder="Chia s·∫ª √Ω ki·∫øn c·ªßa b·∫°n..."></textarea>
                    </div>

                    <div class="textarea-group">
                        <label>2. B·∫°n g·∫∑p kh√≥ khƒÉn g√¨ trong qu√° tr√¨nh h·ªçc?</label>
                        <textarea id="question_2" rows="3" placeholder="Chia s·∫ª √Ω ki·∫øn c·ªßa b·∫°n..."></textarea>
                    </div>

                    <div class="textarea-group">
                        <label>3. B·∫°n c√≥ ƒë·ªÅ xu·∫•t c·∫£i thi·ªán n√†o ƒë·ªÉ h·ªá th·ªëng c√° nh√¢n h√≥a t·ªët h∆°n?</label>
                        <textarea id="question_3" rows="3" placeholder="Chia s·∫ª √Ω ki·∫øn c·ªßa b·∫°n..."></textarea>
                    </div>
                </div>

                <button type="submit" class="submit-evaluation-btn" style="margin-top: 20px;">
                    üíæ G·ª≠i Ph·∫£n H·ªìi
                </button>
            </form>
        </div>
    </div>
</div>

<script>
// Feedback modal logic
let feedbackRatings = {};

function openFeedbackModal() {
    // Check if user is logged in
    const token = localStorage.getItem('token');
    if (!token) {
        alert('Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ g·ª≠i ph·∫£n h·ªìi!');
        window.location.href = 'login.html';
        return;
    }

    document.getElementById('feedbackModal').classList.add('active');
    feedbackRatings = {}; // Reset ratings
    
    // Reset all stars
    for (let i = 1; i <= 8; i++) {
        const stars = document.querySelectorAll(`#rating_${i} .star`);
        stars.forEach(star => star.classList.remove('active'));
        document.getElementById(`rating_${i}-value`).textContent = '0';
    }
    
    // Reset textareas
    document.getElementById('question_1').value = '';
    document.getElementById('question_2').value = '';
    document.getElementById('question_3').value = '';
}

function closeFeedbackModal() {
    document.getElementById('feedbackModal').classList.remove('active');
}

function setFeedbackRating(ratingId, value) {
    feedbackRatings[ratingId] = value;
    
    const stars = document.querySelectorAll(`#${ratingId} .star`);
    stars.forEach((star, index) => {
        if (index < value) {
            star.classList.add('active');
        } else {
            star.classList.remove('active');
        }
    });
    
    document.getElementById(`${ratingId}-value`).textContent = value;
}

// Handle feedback form submission
document.getElementById('feedbackForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    // Validate all 8 ratings are filled
    for (let i = 1; i <= 8; i++) {
        if (!feedbackRatings[`rating_${i}`]) {
            showNotification(`‚ö† Vui l√≤ng ƒë√°nh gi√° t·∫•t c·∫£ 8 ti√™u ch√≠!`, 'error');
            return;
        }
    }
    
    const submitBtn = this.querySelector('button[type="submit"]');
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<div class="spinner"></div> ƒêang g·ª≠i...';
    
    try {
        const payload = {
            rating_1: feedbackRatings.rating_1,
            rating_2: feedbackRatings.rating_2,
            rating_3: feedbackRatings.rating_3,
            rating_4: feedbackRatings.rating_4,
            rating_5: feedbackRatings.rating_5,
            rating_6: feedbackRatings.rating_6,
            rating_7: feedbackRatings.rating_7,
            rating_8: feedbackRatings.rating_8,
            question_1: document.getElementById('question_1').value.trim(),
            question_2: document.getElementById('question_2').value.trim(),
            question_3: document.getElementById('question_3').value.trim()
        };
        
        const response = await fetch('/api/feedback/submit', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('token')}`
            },
            body: JSON.stringify(payload)
        });
        
        const result = await response.json();
        
        if (result.success) {
            showNotification('‚úÖ C·∫£m ∆°n b·∫°n ƒë√£ g·ª≠i ph·∫£n h·ªìi!', 'success');
            setTimeout(() => {
                closeFeedbackModal();
            }, 1500);
        } else {
            throw new Error(result.error || 'Kh√¥ng th·ªÉ g·ª≠i ph·∫£n h·ªìi');
        }
        
    } catch (error) {
        console.error('Error submitting feedback:', error);
        showNotification('‚ùå ' + error.message, 'error');
    } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = 'üíæ G·ª≠i Ph·∫£n H·ªìi';
    }
});

// Close modal when clicking outside
document.getElementById('feedbackModal').addEventListener('click', function(e) {
    if (e.target === this) closeFeedbackModal();
});
</script>
</body>
</html>
