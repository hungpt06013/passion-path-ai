<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>C√°c L·ªô Tr√¨nh H·ªçc Ph·ªï Bi·∫øn - Con ƒë∆∞·ªùng theo ƒëu·ªïi ƒëam m√™</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  <style>
    :root {
      --primary:#007bff;
      --primary-dark: #1e6fe6;
      --muted: #6b7280;
      --bg: #f5f8fb;
    }
    html, body {
      height: 100%;
      margin: 0;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Inter', sans-serif;
      background: #f5f7fa;
      color: #1f2937; 
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      overflow-x: hidden;
    }
main {
  flex: 1 0 auto;
  box-sizing: border-box;
  max-width: 1200px;
  width: 100%;
  margin-left: auto;
  margin-right: auto;
  padding-top: calc(var(--header-height, 80px) + 20px);
  padding-left: 20px;
  padding-right: 20px;
}
    /* Adjust page content to account for fixed header */
    .page-offset { padding-top: 100px; /* header height + spacing */ }

    /* ... the rest of styles unchanged (kept for brevity) ... */
    /* Breadcrumb, page header, grid, cards, footer styles follow (same as before) */
    /* For completeness they are included below (kept identical to previous version) */

    /* Breadcrumb */
    .breadcrumb { max-width: 1200px; margin: 24px auto 0; padding: 0 24px; display: flex; align-items: center; gap: 8px; font-size: 14px; color: #6b7280; }
    .breadcrumb a { color: #6b7280; text-decoration: none; transition: color 0.2s; }
    .breadcrumb a:hover { color: #007bff; }
    .breadcrumb .current { color: #1f2937; font-weight: 600; }

    .page-header { max-width: 1200px; margin: 32px auto; padding: 0 24px; }
    .page-header h1 { font-size: 40px; font-weight: 700; margin-bottom: 12px; }
    .page-header p { font-size: 18px; color: #6b7280; margin-bottom: 24px; }

    .category-stats { display: flex; gap: 32px; align-items: center; }
    .stat-badge { display: flex; align-items: center; gap: 8px; padding: 10px 18px; background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
    .stat-badge i { color: #007bff; font-size: 18px; }
    .stat-badge span { font-weight: 600; color: #1f2937; }
.filters {
  max-width: 1200px;
  margin: 0 auto 32px;
  padding: 0 24px;
  display: flex;
  gap: 16px;
  align-items: center;
}
    .filter-group { display: flex; gap: 8px; align-items: center; }
    .filter-label { font-size: 14px; font-weight: 600; color: #4b5563; }
    .filter-select { padding: 10px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; font-weight: 500; background: white; cursor: pointer; transition: border-color 0.2s; }
    .filter-select:focus { outline: none; border-color: #007bff; }

.roadmaps {
  max-width: 1200px;
  margin: 0 auto 80px;
  padding: 0 24px;
}
    .roadmaps-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 24px; }
    .roadmap-card { background: white; border-radius: 16px; padding: 24px; cursor: pointer; transition: all 0.3s; border: 2px solid transparent; }
    .roadmap-card:hover { transform: translateY(-4px); box-shadow: 0 12px 32px rgba(0,0,0,0.12); border-color: #007bff; }
    .roadmap-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; }
    .roadmap-level { padding: 6px 12px; background: #dbeafe; color: #1e40af; border-radius: 8px; font-size: 12px; font-weight: 700; text-transform: uppercase; }
    .roadmap-level.intermediate { background: #fef3c7; color: #92400e; }
    .roadmap-level.advanced { background: #fee2e2; color: #991b1b; }
    .roadmap-card h3 { font-size: 20px; font-weight: 700; margin-bottom: 12px; color: #1f2937; line-height: 1.3; }
    .roadmap-meta { display: flex; gap: 16px; margin-bottom: 16px; flex-wrap: wrap; }
    .meta-item { display: flex; align-items: center; gap: 6px; font-size: 13px; color: #6b7280; }
    .meta-item i { color: #9ca3af; }
    .roadmap-rating { display: flex; gap: 12px; padding: 12px 0; border-top: 1px solid #e5e7eb; border-bottom: 1px solid #e5e7eb; margin-bottom: 16px; }
    .rating-item { display: flex; align-items: center; gap: 6px; font-size: 13px; }
    .rating-stars-2 { color: #fbbf24; }
    .rating-value-2 { font-weight: 700; color: #1f2937; }
    .roadmap-footer { display: flex; justify-content: space-between; align-items: center; }
    .learner-count { display: flex; align-items: center; gap: 6px; font-size: 13px; color: #6b7280; }
    .learner-avatars { display: flex; margin-left: -4px; }
    .learner-avatar { width: 28px; height: 28px; border-radius: 50%; border: 2px solid white; background: linear-gradient(135deg, #667eea, #764ba2); margin-left: -8px; display: flex; align-items: center; justify-content: center; color: white; font-size: 11px; font-weight: 700; }
    .view-btn { padding: 10px 20px; background: linear-gradient(135deg, #007bff, #1e40af); color: white; border: none; border-radius: 10px; font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.3s; }
    .view-btn:hover { transform: scale(1.05); box-shadow: 0 4px 12px rgba(79, 70, 229, 0.4); }

    .loading { text-align: center; padding: 60px 24px; color: #6b7280; }
    .spinner { width: 48px; height: 48px; margin: 0 auto 20px; border: 4px solid #e5e7eb; border-top-color: #007bff; border-radius: 50%; animation: spin 0.8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }

    .empty-state { text-align: center; padding: 80px 24px; }
    .empty-icon { font-size: 64px; margin-bottom: 20px; opacity: 0.3; }
    .empty-state h3 { font-size: 24px; font-weight: 700; margin-bottom: 12px; color: #1f2937; }
    .empty-state p { color: #6b7280; font-size: 16px; }

@media (max-width: 900px) {
  body {
    padding-top: 100px; /* ‚úÖ ƒê·∫©y xu·ªëng nh∆∞ create_roadmap */
  }

  main {
    padding-top: 20px; /* ‚úÖ Gi·∫£m padding-top v√¨ body ƒë√£ c√≥ padding */
    padding-left: 15px;
    padding-right: 15px;
  }

  .breadcrumb {
    padding: 0 15px;
    font-size: 13px;
    margin: 16px auto 0;
  }

  .page-header {
    padding: 0 15px;
    margin: 24px auto;
  }

  .page-header h1 {
    font-size: 28px;
  }

  .page-header p {
    font-size: 16px;
  }

  .category-stats {
    flex-direction: column;
    align-items: flex-start;
    gap: 12px;
  }

  .stat-badge {
    width: 100%;
    justify-content: center;
  }

  .filters {
    flex-direction: column;
    align-items: stretch;
    gap: 12px;
    padding: 0 15px;
    margin: 0 auto 24px;
    margin-left: auto;
    margin-right: auto;
    max-width: 100%;
  }

  .filter-group {
    flex-direction: column;
    align-items: stretch;
    width: 100%;
  }

  .filter-select {
    width: 100%;
    padding: 12px 14px;
    font-size: 14px;
  }

  .roadmaps {
    padding: 0 15px;
    margin: 0 auto 40px;
    margin-left: auto;
    margin-right: auto;
    max-width: 100%;
  }

  .roadmaps-grid {
    grid-template-columns: 1fr;
    gap: 16px;
  }

  .roadmap-card {
    padding: 20px;
  }

  .roadmap-card h3 {
    font-size: 18px;
  }

  .roadmap-meta {
    gap: 12px;
  }

  .meta-item {
    font-size: 12px;
  }

  .roadmap-rating {
    flex-direction: column;
    gap: 8px;
  }

  .rating-item {
    font-size: 12px;
  }

  .roadmap-footer {
    flex-direction: column;
    gap: 12px;
    align-items: stretch;
  }

  .learner-count {
    justify-content: center;
  }

  .view-btn {
    width: 100%;
    padding: 12px 20px;
  }

  .empty-state {
    padding: 60px 15px;
  }

  .empty-icon {
    font-size: 48px;
  }

  .empty-state h3 {
    font-size: 20px;
  }

  .empty-state p {
    font-size: 14px;
  }

  .loading {
    padding: 40px 15px;
  }
}

@media (max-width: 480px) {
  body {
    padding-top: 90px; /* ‚úÖ Gi·∫£m nh·∫π tr√™n m√†n h√¨nh r·∫•t nh·ªè */
  }

  .breadcrumb {
    font-size: 12px;
  }

  .page-header h1 {
    font-size: 24px;
  }

  .page-header p {
    font-size: 14px;
  }

  .stat-badge {
    padding: 8px 14px;
    font-size: 13px;
  }

  .stat-badge i {
    font-size: 16px;
  }

  .roadmap-card {
    padding: 16px;
  }

  .roadmap-card h3 {
    font-size: 16px;
  }

  .roadmap-level {
    padding: 5px 10px;
    font-size: 11px;
  }

  .meta-item {
    font-size: 11px;
  }

  .meta-item i {
    font-size: 12px;
  }

  .view-btn {
    font-size: 13px;
    padding: 10px 16px;
  }

  .learner-avatar {
    width: 24px;
    height: 24px;
    font-size: 10px;
  }

  .learner-count span {
    font-size: 12px;
  }

  .empty-state {
    padding: 40px 10px;
  }

  .empty-icon {
    font-size: 40px;
  }

  .empty-state h3 {
    font-size: 18px;
  }

  .spinner {
    width: 40px;
    height: 40px;
  }
}
  </style>
    <!-- Preload Font Awesome CSS -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" as="style">
    
    <!-- Load Font Awesome async -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"></noscript>
    
    <!-- Load Google Fonts async with display swap -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;300;400;500;600;700;900&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;300;400;500;600;700;900&display=swap" rel="stylesheet"></noscript>
    
    <!-- Load footer.css async (non-critical) -->
    <link rel="preload" href="footer.css" as="style">
    <link rel="stylesheet" href="footer.css" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="footer.css"></noscript>

    <link rel="preload" href="header.css" as="style">
    <link rel="stylesheet" href="header.css" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="header.css"></noscript>
</head>
<body>
<div id="header"></div>
<script>
  fetch('header.html')
    .then(res => res.text())
    .then(html => {
      document.getElementById('header').innerHTML = html;
      const script = document.createElement('script');
      script.src = 'header.js';
      document.body.appendChild(script);
    });
</script>

  <main class="page-offset">
    <!-- Breadcrumb -->
    <div class="breadcrumb">
      <a href="main.html"><i class="fas fa-home"></i></a>
      <span>/</span>
      <span class="current" id="categoryBreadcrumb">Lƒ©nh v·ª±c</span>
    </div>

    <!-- Page Header -->
    <div class="page-header">
      <p id="categoryDescription">Kh√°m ph√° c√°c l·ªô tr√¨nh h·ªçc t·∫≠p ch·∫•t l∆∞·ª£ng cao</p>
      <div class="category-stats">
        <div class="stat-badge">
          <i class="fas fa-route"></i>
          <span id="totalRoadmaps">0 l·ªô tr√¨nh</span>
        </div>
        <div class="stat-badge">
          <i class="fas fa-users"></i>
          <span id="totalLearners">0 h·ªçc vi√™n</span>
        </div>
      </div>
    </div>

    <div class="filters">
        <div class="filter-group">
            <span class="filter-label">C·∫•p ƒë·ªô:</span>
            <select class="filter-select" id="filterLevel">
              <option value="">T·∫•t c·∫£</option>
              <option value="M·ªõi b·∫Øt ƒë·∫ßu">M·ªõi b·∫Øt ƒë·∫ßu</option>
              <option value="C∆° b·∫£n">C∆° b·∫£n</option>
              <option value="Trung b√¨nh">Trung b√¨nh</option>
              <option value="Kh√° t·ªët">Kh√° t·ªët</option>
              <option value="N√¢ng cao">N√¢ng cao</option>
            </select>
        </div>

        <div class="filter-group">
            <span class="filter-label">S·∫Øp x·∫øp:</span>
            <select class="filter-select" id="filterSort">
              <option value="newest">M·ªõi nh·∫•t</option>
              <option value="popular">Ph·ªï bi·∫øn nh·∫•t</option>
              <option value="rating_overall">T·ªïng th·ªÉ ‚â•4‚≠ê (nhi·ªÅu ‚Üí √≠t)</option>
              <option value="rating_effectiveness">Hi·ªáu qu·∫£ ‚â•4‚≠ê (nhi·ªÅu ‚Üí √≠t)</option>
            </select>
        </div>
    </div>

    <!-- Roadmaps Grid -->
    <div class="roadmaps">
      <div id="loadingState" class="loading" style="display: none;">
        <div class="spinner"></div>
        <p>ƒêang t·∫£i l·ªô tr√¨nh h·ªçc t·∫≠p...</p>
      </div>

      <div id="emptyState" class="empty-state" style="display: none;">
        <div class="empty-icon">üìö</div>
        <h3>Ch∆∞a c√≥ l·ªô tr√¨nh n√†o</h3>
        <p>Hi·ªán t·∫°i ch∆∞a c√≥ l·ªô tr√¨nh h·ªçc t·∫≠p cho lƒ©nh v·ª±c n√†y</p>
      </div>

      <div id="roadmapsGrid" class="roadmaps-grid"></div>
    </div>
</main>
<div id="footer"></div>
  <script>
// Initialize
    const API_BASE_URL = 'http://localhost:3000/api';
    let currentPage = 1;
    let currentCategory = '';
    let allRoadmaps = [];
    let filteredRoadmaps = [];

    // Get category from URL
    const urlParams = new URLSearchParams(window.location.search);
    currentCategory = urlParams.get('category') || '';

    async function loadCategoryData() {
      if (!currentCategory) {
        showError('Kh√¥ng t√¨m th·∫•y th√¥ng tin lƒ©nh v·ª±c');
        return;
      }

      document.getElementById('loadingState').style.display = 'block';
      document.getElementById('emptyState').style.display = 'none';
      document.getElementById('roadmapsGrid').innerHTML = '';
      document.getElementById('categoryBreadcrumb').textContent = currentCategory;

      try {
        const categoryResponse = await fetch(`/api/categories/${currentCategory}`, {
          method: 'GET',
          headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });

        if (categoryResponse.ok) {
          const categoryData = await categoryResponse.json();
          if (categoryData.success) {
            document.getElementById('categoryBreadcrumb').textContent = categoryData.data.name;
            document.getElementById('categoryDescription').textContent = categoryData.data.description || 'Kh√°m ph√° c√°c l·ªô tr√¨nh h·ªçc t·∫≠p ch·∫•t l∆∞·ª£ng cao';
          }
        }

        const roadmapsResponse = await fetch(`/api/roadmapsystem/category/${currentCategory}?limit=100`, {
          method: 'GET',
          headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });

        const roadmapsData = await roadmapsResponse.json();

        if (roadmapsData.success) {
          if (roadmapsData.data && roadmapsData.data.length > 0) {
            allRoadmaps = roadmapsData.data;
            filteredRoadmaps = allRoadmaps;
            updateStats();
            renderRoadmaps();
          } else {
            showEmptyState();
          }
        } else {
          showError(roadmapsData.error || 'Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu');
        }
      } catch (error) {
        showError('Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu: ' + error.message);
      } finally {
        document.getElementById('loadingState').style.display = 'none';
      }
    }

    function updateStats() {
      document.getElementById('totalRoadmaps').textContent = `${allRoadmaps.length} l·ªô tr√¨nh`;
      const totalLearners = allRoadmaps.reduce((sum, r) => sum + (r.total_user_learning || 0), 0);
      document.getElementById('totalLearners').textContent = `${totalLearners.toLocaleString()} h·ªçc vi√™n`;
    }
function renderRoadmaps() {
  const grid = document.getElementById('roadmapsGrid');
  if (!filteredRoadmaps || filteredRoadmaps.length === 0) {
    showEmptyState();
    return;
  }
  document.getElementById('emptyState').style.display = 'none';
  grid.innerHTML = filteredRoadmaps.map(roadmap => {
    // Map level class
    let levelClass = '';
    if (roadmap.start_level === 'Trung b√¨nh' || roadmap.start_level === 'Kh√° t·ªët') {
      levelClass = 'intermediate';
    } else if (roadmap.start_level === 'N√¢ng cao') {
      levelClass = 'advanced';
    }
    
    const levelText = roadmap.start_level; // Hi·ªÉn th·ªã nguy√™n vƒÉn
    // ‚úÖ THAY ƒê·ªîI RATING SECTION
    let ratingHtml = '';
    if (roadmap.high_overall_rating_count > 0 || roadmap.high_effectiveness_count > 0) {
      ratingHtml = '<div class="roadmap-rating">';
      
      if (roadmap.high_overall_rating_count > 0) {
        ratingHtml += `
          <div class="rating-item">
            <span class="rating-value-2">${roadmap.high_overall_rating_count}</span>
            <span style="color: #9ca3af; font-size: 12px;">h·ªçc vi√™n</span>
            <span style="color: #9ca3af;">T·ªïng th·ªÉ: ‚â•4‚≠ê</span>
          </div>
        `;
      }
      
      if (roadmap.high_effectiveness_count > 0) {
        ratingHtml += `
          <div class="rating-item">
            <span class="rating-value-2">${roadmap.high_effectiveness_count}</span>
            <span style="color: #9ca3af; font-size: 12px;">h·ªçc vi√™n</span>
            <span style="color: #9ca3af;">Hi·ªáu qu·∫£: ‚â•4‚≠ê</span>
          </div>
        `;
      }
      
      ratingHtml += '</div>';
    }
    
    return `
      <div class="roadmap-card" onclick="viewRoadmapDetails(${roadmap.roadmap_id})">
        <div class="roadmap-header">
          <span class="roadmap-level ${levelClass}">${levelText}</span>
        </div>
        <h3>${escapeHtml(roadmap.roadmap_name)}</h3>
        <div class="roadmap-meta">
          <div class="meta-item"><i class="fas fa-calendar"></i><span>${roadmap.duration_days} ng√†y</span></div>
          <div class="meta-item"><i class="fas fa-clock"></i><span>${roadmap.duration_hours}h</span></div>
          ${roadmap.sub_category ? `<div class="meta-item"><i class="fas fa-tag"></i><span>${escapeHtml(roadmap.sub_category)}</span></div>` : ''}
        </div>
        ${ratingHtml}
        <div class="roadmap-footer">
          <div class="learner-count">
            <div class="learner-avatars">
              <div class="learner-avatar">üë§</div>
              <div class="learner-avatar" style="background: linear-gradient(135deg, #f093fb, #f5576c);">üë§</div>
              <div class="learner-avatar" style="background: linear-gradient(135deg, #4facfe, #00f2fe);">üë§</div>
            </div>
            <span>${roadmap.total_user_learning || 0} ƒëang h·ªçc</span>
          </div>
          <button class="view-btn" onclick="event.stopPropagation(); viewRoadmapDetails(${roadmap.roadmap_id})">Xem chi ti·∫øt</button>
        </div>
      </div>
    `;
  }).join('');
}
    function viewRoadmapDetails(roadmapId) {
      const token = localStorage.getItem('token');
      if(!token) {alert('Vui l√≤ng ƒëƒÉng nh·∫≠p!');window.location.href='login.html';}
      else window.location.href = `roadmap_details.html?id=${roadmapId}`;
    }

    function showEmptyState() {
      document.getElementById('roadmapsGrid').innerHTML = '';
      document.getElementById('emptyState').style.display = 'block';
    }

    function showError(message) {
      document.getElementById('categoryDescription').textContent = message;
      showEmptyState();
    }

    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Filters
    document.getElementById('filterLevel').addEventListener('change', (e) => {
      const level = e.target.value;
      filteredRoadmaps = level ? allRoadmaps.filter(r => r.start_level === level) : allRoadmaps;
      renderRoadmaps();
    });

    document.getElementById('filterSort').addEventListener('change', (e) => {
      const sort = e.target.value;
      
      if (sort === 'popular') {
        // Ph·ªï bi·∫øn nh·∫•t (total_user_learning cao ‚Üí th·∫•p)
        filteredRoadmaps.sort((a, b) => (b.total_user_learning || 0) - (a.total_user_learning || 0));
      } 
      else if (sort === 'rating_overall') {
        // S·ªë l∆∞·ª£t ƒë√°nh gi√° T·ªïng th·ªÉ ‚â•4‚≠ê (nhi·ªÅu ‚Üí √≠t)
        filteredRoadmaps.sort((a, b) => (b.high_overall_rating_count || 0) - (a.high_overall_rating_count || 0));
      } 
      else if (sort === 'rating_effectiveness') {
        // S·ªë l∆∞·ª£t ƒë√°nh gi√° Hi·ªáu qu·∫£ ‚â•4‚≠ê (nhi·ªÅu ‚Üí √≠t)
        filteredRoadmaps.sort((a, b) => (b.high_effectiveness_count || 0) - (a.high_effectiveness_count || 0));
      } 
      else {
        // M·ªõi nh·∫•t
        filteredRoadmaps.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
      }
      
      renderRoadmaps();
    });

    // Load data on page load
    document.addEventListener('DOMContentLoaded', () => {
      loadCategoryData();
    });
  </script>
  <script src="footer.js"></script>
</body>
</html>
