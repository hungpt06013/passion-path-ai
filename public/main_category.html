<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>L·ªô Tr√¨nh H·ªçc - H·ªçc T·∫≠p Th√¥ng Minh</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
        :root {
        --primary:#007bff;
        --primary-dark: #1e6fe6;
        --muted: #6b7280;
        --bg: #f5f8fb;
        --header-height: 80px;
    }
html, body {
  height: 100%;
  margin: 0;
}
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', sans-serif; background: #f5f7fa; color: #1f2937; 
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  overflow-x: hidden;
  }
main {
  flex: 1 0 auto;  /* Quan tr·ªçng nh·∫•t! */
  box-sizing: border-box;
  max-width: 1200px;
  width: 100%;
  margin-left: auto;
  margin-right: auto;
  padding-top: calc(var(--header-height) + 20px);
  padding-left: 20px;
  padding-right: 20px;
}

    .fixed-bar {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 80px;
        background: var(--primary);
        box-shadow: 0 6px 20px rgba(14, 30, 37, 0.12);
        z-index: 50;
    }

    .bar-inner {
        max-width: 1200px;
        height: 100%;
        margin: 0 auto;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 20px;
        box-sizing: border-box;
    }

    .brand {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .brand-icon {
        width: 48px;
        height: 48px;
        background: rgba(255,255,255,0.2);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 22px;
        flex-shrink: 0;
    }

    .brand-text {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .brand-title {
        color: white;
        font-size: 20px;
        font-weight: 700;
    }

    .brand-sub {
        color: rgba(255,255,255,0.9);
        font-size: 12px;
        font-weight: 600;
    }

    .nav-buttons {
        display: flex;
        gap: 22px;
        align-items: center;
    }

    .nav-btn {
        background: none;
        color: #fff;
        padding: 0;
        font-size: 15px;
        font-weight: 600;
        border-radius: 9999px;
    }

    .nav-btn .fa {
        margin-right: 8px;
        opacity: 0.95;
    }

    .nav-btn.active {
        color: #e6f2ff;
    }

    button {
        font-family: 'Inter', sans-serif;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        border: none;
        border-radius: 9999px;
        padding: 10px 20px;
        font-size: 15px;
        font-weight: 600;
    }

    .userInfo {
        color: white;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .login-btn {
        background: white;
        color: #333;
        box-shadow: 0 2px 5px rgba(0,0,0,0.12);
    }

    .login-btn:hover {
        background: #f0f0f0;
    }

    .register-btn {
        background: #28a745;
        color: white;
        box-shadow: 0 2px 5px rgba(0,0,0,0.12);
    }

    .register-btn:hover {
        background: #218838;
    }

    .logout-btn {
        background: linear-gradient(135deg, #4b0ee5 0%, #0682d4 100%);
        color: white;
        box-shadow: 0 2px 5px rgba(0,0,0,0.12);
    }

    .toApp-btn {
        background: #000;
        color: white;
        box-shadow: 0 2px 5px rgba(0,0,0,0.12);
    }

    .admin-btn {
        background: #6f42c1;
        color: white;
        box-shadow: 0 2px 5px rgba(0,0,0,0.12);
    }
    /* Adjust page content to account for fixed header */
    .page-offset { padding-top: 100px; /* header height + spacing */ }

    /* ... the rest of styles unchanged (kept for brevity) ... */
    /* Breadcrumb, page header, grid, cards, footer styles follow (same as before) */
    /* For completeness they are included below (kept identical to previous version) */

    /* Breadcrumb */
    .breadcrumb { max-width: 1200px; margin: 24px auto 0; padding: 0 24px; display: flex; align-items: center; gap: 8px; font-size: 14px; color: #6b7280; }
    .breadcrumb a { color: #6b7280; text-decoration: none; transition: color 0.2s; }
    .breadcrumb a:hover { color: #007bff; }
    .breadcrumb .current { color: #1f2937; font-weight: 600; }

    .page-header { max-width: 1200px; margin: 32px auto; padding: 0 24px; }
    .page-header h1 { font-size: 40px; font-weight: 700; margin-bottom: 12px; }
    .page-header p { font-size: 18px; color: #6b7280; margin-bottom: 24px; }

    .category-stats { display: flex; gap: 32px; align-items: center; }
    .stat-badge { display: flex; align-items: center; gap: 8px; padding: 10px 18px; background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
    .stat-badge i { color: #007bff; font-size: 18px; }
    .stat-badge span { font-weight: 600; color: #1f2937; }

    .filters { max-width: 1200px; margin: 0 auto 32px; padding: 0 24px; display: flex; gap: 16px; align-items: center; }
    .filter-group { display: flex; gap: 8px; align-items: center; }
    .filter-label { font-size: 14px; font-weight: 600; color: #4b5563; }
    .filter-select { padding: 10px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; font-weight: 500; background: white; cursor: pointer; transition: border-color 0.2s; }
    .filter-select:focus { outline: none; border-color: #007bff; }

    .roadmaps { max-width: 1200px; margin: 0 auto 80px; padding: 0 24px; }
    .roadmaps-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 24px; }
    .roadmap-card { background: white; border-radius: 16px; padding: 24px; cursor: pointer; transition: all 0.3s; border: 2px solid transparent; }
    .roadmap-card:hover { transform: translateY(-4px); box-shadow: 0 12px 32px rgba(0,0,0,0.12); border-color: #007bff; }
    .roadmap-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; }
    .roadmap-level { padding: 6px 12px; background: #dbeafe; color: #1e40af; border-radius: 8px; font-size: 12px; font-weight: 700; text-transform: uppercase; }
    .roadmap-level.intermediate { background: #fef3c7; color: #92400e; }
    .roadmap-level.advanced { background: #fee2e2; color: #991b1b; }
    .roadmap-card h3 { font-size: 20px; font-weight: 700; margin-bottom: 12px; color: #1f2937; line-height: 1.3; }
    .roadmap-meta { display: flex; gap: 16px; margin-bottom: 16px; flex-wrap: wrap; }
    .meta-item { display: flex; align-items: center; gap: 6px; font-size: 13px; color: #6b7280; }
    .meta-item i { color: #9ca3af; }
    .roadmap-rating { display: flex; gap: 12px; padding: 12px 0; border-top: 1px solid #e5e7eb; border-bottom: 1px solid #e5e7eb; margin-bottom: 16px; }
    .rating-item { display: flex; align-items: center; gap: 6px; font-size: 13px; }
    .rating-stars { color: #fbbf24; }
    .rating-value { font-weight: 700; color: #1f2937; }
    .roadmap-footer { display: flex; justify-content: space-between; align-items: center; }
    .learner-count { display: flex; align-items: center; gap: 6px; font-size: 13px; color: #6b7280; }
    .learner-avatars { display: flex; margin-left: -4px; }
    .learner-avatar { width: 28px; height: 28px; border-radius: 50%; border: 2px solid white; background: linear-gradient(135deg, #667eea, #764ba2); margin-left: -8px; display: flex; align-items: center; justify-content: center; color: white; font-size: 11px; font-weight: 700; }
    .view-btn { padding: 10px 20px; background: linear-gradient(135deg, #007bff, #1e40af); color: white; border: none; border-radius: 10px; font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.3s; }
    .view-btn:hover { transform: scale(1.05); box-shadow: 0 4px 12px rgba(79, 70, 229, 0.4); }

    .loading { text-align: center; padding: 60px 24px; color: #6b7280; }
    .spinner { width: 48px; height: 48px; margin: 0 auto 20px; border: 4px solid #e5e7eb; border-top-color: #007bff; border-radius: 50%; animation: spin 0.8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }

    .empty-state { text-align: center; padding: 80px 24px; }
    /* Footer */
footer {
  flex-shrink: 0;  /* Quan tr·ªçng! */
  background: #1a202c;
  color: #e5e7eb;
  padding: 28px 20px 16px;
  margin-top: 40px;
}
    .empty-icon { font-size: 64px; margin-bottom: 20px; opacity: 0.3; }
    .empty-state h3 { font-size: 24px; font-weight: 700; margin-bottom: 12px; color: #1f2937; }
    .empty-state p { color: #6b7280; font-size: 16px; }

    /* Footer */
footer {
  flex-shrink: 0;  /* Quan tr·ªçng! */
  background: #1a202c;
  color: #e5e7eb;
  padding: 28px 20px 16px;
  margin-top: 40px;
}

    .footer-content {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 2fr 1fr 1fr;
        gap: 24px;
        margin-bottom: 20px;
    }

    .footer-brand {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .footer-logo {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .footer-logo-icon {
        width: 44px;
        height: 44px;
        background: var(--primary);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 20px;
    }

    .footer-logo-text {
        display: flex;
        flex-direction: column;
    }

    .footer-logo-title {
        font-size: 18px;
        font-weight: 700;
        color: white;
    }

    .footer-logo-sub {
        font-size: 11px;
        color: #9ca3af;
    }

    .footer-desc {
        color: #9ca3af;
        line-height: 1.5;
        font-size: 13px;
    }

    .footer-social {
        display: flex;
        gap: 12px;
        margin-top: 8px;
    }

    .social-icon {
        width: 36px;
        height: 36px;
        background: #374151;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        transition: all 0.3s ease;
        text-decoration: none;
    }

    .social-icon:hover {
        background: var(--primary);
        transform: translateY(-2px);
    }

    .footer-section h3 {
        font-size: 15px;
        font-weight: 700;
        color: white;
        margin: 0 0 12px 0;
    }

    .footer-links {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .footer-link {
        color: #9ca3af;
        text-decoration: none;
        font-size: 13px;
        transition: color 0.3s ease;
    }

    .footer-link:hover {
        color: var(--primary);
    }

    .footer-bottom {
        max-width: 1200px;
        margin: 0 auto;
        padding-top: 16px;
        border-top: 1px solid #374151;
        text-align: center;
        color: #9ca3af;
        font-size: 13px;
    }

    @media (max-width: 768px) {
      .page-header h1 { font-size: 28px; }
      .category-stats { flex-direction: column; align-items: flex-start; gap: 12px; }
      .roadmaps-grid { grid-template-columns: 1fr; }
      .footer-content { grid-template-columns: 1fr; gap: 32px; }
      .nav-menu { display: none; }
      .nav-buttons { gap: 12px; padding-right: 12px; }
    }
  </style>
</head>
<body>
  <!-- Header (brand is NOT clickable) -->
<div class="fixed-bar">
  <div class="bar-inner">
    <div class="brand">
      <div class="brand-icon">
        <i class="fa-solid fa-graduation-cap"></i>
      </div>
      <div class="brand-text">
        <div class="brand-title">Con ƒë∆∞·ªùng ƒëam m√™</div>
        <div class="brand-sub">AI-Powered Learning Path</div>
      </div>
    </div>
    <div class="nav-buttons" id="mainNavButtons">
      <!-- Buttons s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JavaScript -->
    </div>
    <div id="userArea" class="userInfo">
      <button class="login-btn"><i class="fa-solid fa-right-to-bracket"></i> ƒêƒÉng nh·∫≠p</button>
      <button class="register-btn"><i class="fa-solid fa-user-plus"></i> ƒêƒÉng k√Ω</button>
    </div>
  </div>
</div>

  <main class="page-offset">
    <!-- Breadcrumb -->
    <div class="breadcrumb">
      <a href="main.html"><i class="fas fa-home"></i></a>
      <span>/</span>
      <span class="current" id="categoryBreadcrumb">Lƒ©nh v·ª±c</span>
    </div>

    <!-- Page Header -->
    <div class="page-header">
      <p id="categoryDescription">Kh√°m ph√° c√°c l·ªô tr√¨nh h·ªçc t·∫≠p ch·∫•t l∆∞·ª£ng cao</p>
      <div class="category-stats">
        <div class="stat-badge">
          <i class="fas fa-route"></i>
          <span id="totalRoadmaps">0 l·ªô tr√¨nh</span>
        </div>
        <div class="stat-badge">
          <i class="fas fa-users"></i>
          <span id="totalLearners">0 h·ªçc vi√™n</span>
        </div>
      </div>
    </div>

    <!-- Filters -->
    <div class="filters">
      <div class="filter-group">
        <span class="filter-label">C·∫•p ƒë·ªô:</span>
        <select class="filter-select" id="filterLevel">
          <option value="">T·∫•t c·∫£</option>
          <option value="Beginner">C∆° b·∫£n</option>
          <option value="Intermediate">Trung c·∫•p</option>
          <option value="Advanced">N√¢ng cao</option>
        </select>
      </div>

      <div class="filter-group">
        <span class="filter-label">S·∫Øp x·∫øp:</span>
        <select class="filter-select" id="filterSort">
          <option value="newest">M·ªõi nh·∫•t</option>
          <option value="popular">Ph·ªï bi·∫øn nh·∫•t</option>
          <option value="rating">ƒê√°nh gi√° cao</option>
        </select>
      </div>
    </div>

    <!-- Roadmaps Grid -->
    <div class="roadmaps">
      <div id="loadingState" class="loading" style="display: none;">
        <div class="spinner"></div>
        <p>ƒêang t·∫£i l·ªô tr√¨nh h·ªçc t·∫≠p...</p>
      </div>

      <div id="emptyState" class="empty-state" style="display: none;">
        <div class="empty-icon">üìö</div>
        <h3>Ch∆∞a c√≥ l·ªô tr√¨nh n√†o</h3>
        <p>Hi·ªán t·∫°i ch∆∞a c√≥ l·ªô tr√¨nh h·ªçc t·∫≠p cho lƒ©nh v·ª±c n√†y</p>
      </div>

      <div id="roadmapsGrid" class="roadmaps-grid"></div>
    </div>
</main>

  <!-- Footer (copied) -->
    <footer>
        <div class="footer-content">
            <div class="footer-brand">
                <div class="footer-logo">
                    <div class="footer-logo-icon">
                        <i class="fa-solid fa-graduation-cap"></i>
                    </div>
                    <div class="footer-logo-text">
                        <div class="footer-logo-title">Con ƒë∆∞·ªùng ƒëam m√™</div>
                        <div class="footer-logo-sub">AI-Powered Learning Path</div>
                    </div>
                </div>
                <p class="footer-desc">N·ªÅn t·∫£ng h·ªçc t·∫≠p c√° nh√¢n h√≥a s·ª≠ d·ª•ng tr√≠ tu·ªá nh√¢n t·∫°o ƒë·ªÉ t·∫°o l·ªô tr√¨nh h·ªçc ph√π h·ª£p v·ªõi s·ªü th√≠ch v√† m·ª•c ti√™u c·ªßa t·ª´ng ng∆∞·ªùi.</p>
                <!--<div class="footer-social">
                    <a href="#" class="social-icon"><i class="fa-brands fa-facebook-f"></i></a>
                    <a href="#" class="social-icon"><i class="fa-brands fa-twitter"></i></a>
                    <a href="#" class="social-icon"><i class="fa-brands fa-linkedin-in"></i></a>
                </div>-->
            </div>

            <div class="footer-section">
                <h3>T√≠nh NƒÉng</h3>
                <div class="footer-links">
                    <a href="auth-check.html?target=create_roadmap_page.html" class="footer-link">T·∫°o l·ªô tr√¨nh v·ªõi AI</a>
                    <a href="auth-check.html?target=path.html" class="footer-link">L∆∞u tr·ªØ c√°c l·ªô tr√¨nh</a>
                    <a href="auth-check.html?target=progress.html" class="footer-link">Theo d√µi ti·∫øn ƒë·ªô</a>
                </div>
            </div>

            <div class="footer-section">
                <h3>H·ªó Tr·ª£</h3>
                <div class="footer-links">
                    <a href="https://mail.google.com/mail/?view=cm&fs=1&to=passionpathaisystem@gmail.com" target="_blank" rel="noopener noreferrer" class="footer-link">Li√™n h·ªá</a>
                    <a href="https://zalo.me/g/drfrli672" target="_blank" rel="noopener noreferrer" class="footer-link">Trung t√¢m tr·ª£ gi√∫p</a>
                    <a href="#" class="footer-link">Thu th·∫≠p √Ω ki·∫øn</a>
                </div>
            </div>
        </div>

        <div class="footer-bottom">
            ¬© 2025 Con ƒë∆∞·ªùng ƒëam m√™. All rights reserved. Made with <i class="fa-solid fa-heart" style="color:#e74c3c;"></i> for learners worldwide.
        </div>
    </footer>

  <script>
    const loginBtn = document.querySelector(".login-btn");
const registerBtn = document.querySelector(".register-btn");
const userArea = document.getElementById("userArea");
const ADMIN_TOKEN = 'admin-token';

function showAuthButtons() {
  if (loginBtn) loginBtn.style.display = "inline-flex";
  if (registerBtn) registerBtn.style.display = "inline-flex";
  const children = Array.from(userArea.children);
  children.forEach(c => {
    if (!c.classList.contains('login-btn') && !c.classList.contains('register-btn')) {
      try {
        userArea.removeChild(c);
      } catch (e) {}
    }
  });
}

if (loginBtn) {
  loginBtn.addEventListener("click", () => {
    window.location.href = "login.html";
  });
}

if (registerBtn) {
  registerBtn.addEventListener("click", () => {
    window.location.href = "register.html";
  });
}

function wireLogoutAndNav(logoutEl) {
  if (logoutEl) {
    logoutEl.addEventListener('click', () => {
      localStorage.removeItem('token');
      localStorage.removeItem('role');

      if (!document.querySelector('.login-btn')) {
        const b = document.createElement('button');
        b.className = 'login-btn';
        b.innerHTML = '<i class="fa-solid fa-right-to-bracket"></i> ƒêƒÉng nh·∫≠p';
        b.addEventListener('click', () => window.location.href = 'login.html');
        userArea.appendChild(b);
      }

      if (!document.querySelector('.register-btn')) {
        const b2 = document.createElement('button');
        b2.className = 'register-btn';
        b2.innerHTML = '<i class="fa-solid fa-user-plus"></i> ƒêƒÉng k√Ω';
        b2.addEventListener('click', () => window.location.href = 'register.html');
        userArea.appendChild(b2);
      }

      showAuthButtons();
    });
  }
}

async function loadUser() {
  const token = localStorage.getItem('token');
  const navButtons = document.getElementById('mainNavButtons');
  
  // Lu√¥n hi·ªÉn th·ªã navigation buttons ngay t·ª´ ƒë·∫ßu
  if (navButtons) {
    navButtons.innerHTML = `
      <button class="nav-btn" id="btnHome"><i class="fa-solid fa-house"></i> Trang Ch·ªß</button>
      <button class="nav-btn" id="btnPath"><i class="fa-solid fa-route"></i> L·ªô Tr√¨nh H·ªçc</button>
      <button class="nav-btn" id="btnProgress"><i class="fa-solid fa-chart-line"></i> Ti·∫øn ƒê·ªô</button>
    `;
    
    // Add event listeners cho nav buttons
    document.getElementById('btnHome').addEventListener('click', () => { 
      window.location.href = 'main.html'; 
    });
    
    document.getElementById('btnPath').addEventListener('click', () => { 
      const token = localStorage.getItem('token');
      if (!token) {
        window.location.href = 'login.html';
      } else {
        window.location.href = 'path.html';
      }
    });
    
    document.getElementById('btnProgress').addEventListener('click', () => { 
      const token = localStorage.getItem('token');
      if (!token) {
        window.location.href = 'login.html';
      } else {
        window.location.href = 'progress.html';
      }
    });
  }
  
  showAuthButtons();
  if (!token) return;

  let name = 'Ng∆∞·ªùi d√πng';
  let serverRole = 'user';

  if (token === ADMIN_TOKEN) {
    name = 'Admin';
    serverRole = 'admin';
    localStorage.setItem('role', 'admin');
  } else {
    try {
      const res = await fetch('/api/me', { headers: { 'Authorization': 'Bearer ' + token }});
      if (!res.ok) { 
        showAuthButtons(); 
        return; 
      }
      const data = await res.json();
      serverRole = (data && (data.role || (data.user && data.user.role))) ? (data.role || data.user.role) : 'user';
      name = (data && data.user && data.user.name) ? data.user.name : 'Ng∆∞·ªùi d√πng';
      localStorage.setItem('role', serverRole);
    } catch (err) {
      console.error(err);
      showAuthButtons();
      return;
    }
  }

  if (document.querySelector('.login-btn')) {
    document.querySelector('.login-btn').style.display = 'none';
  }
  if (document.querySelector('.register-btn')) {
    document.querySelector('.register-btn').style.display = 'none';
  }

  userArea.innerHTML = `
    <span>Xin ch√†o <strong style="color:white;">${name}</strong></span>
    <button id="logout" class="logout-btn"><i class="fa-solid fa-right-from-bracket"></i> ƒêƒÉng xu·∫•t</button>
  `;
  const logoutEl = document.getElementById('logout');
  wireLogoutAndNav(logoutEl);


  // Active state
  const params = new URLSearchParams(window.location.search);
  const page = params.get('page') || 'progress';
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  const idMap = { home: 'btnHome', path: 'btnPath', progress: 'btnProgress', admin: 'btnAdmin' };
  const btnId = idMap[page];
  if (btnId) {
    const el = document.getElementById(btnId);
    if (el) el.classList.add('active');
  }
}

// Initialize
loadUser().catch((e)=>console.error(e));
    const API_BASE_URL = 'http://localhost:3000/api';
    let currentPage = 1;
    let currentCategory = '';
    let allRoadmaps = [];
    let filteredRoadmaps = [];

    // Get category from URL
    const urlParams = new URLSearchParams(window.location.search);
    currentCategory = urlParams.get('category') || '';

    async function loadCategoryData() {
      if (!currentCategory) {
        showError('Kh√¥ng t√¨m th·∫•y th√¥ng tin lƒ©nh v·ª±c');
        return;
      }

      document.getElementById('loadingState').style.display = 'block';
      document.getElementById('emptyState').style.display = 'none';
      document.getElementById('roadmapsGrid').innerHTML = '';
      document.getElementById('categoryBreadcrumb').textContent = currentCategory;

      try {
        const categoryResponse = await fetch(`/api/categories/${currentCategory}`, {
          method: 'GET',
          headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });

        if (categoryResponse.ok) {
          const categoryData = await categoryResponse.json();
          if (categoryData.success) {
            document.getElementById('categoryBreadcrumb').textContent = categoryData.data.name;
            document.getElementById('categoryDescription').textContent = categoryData.data.description || 'Kh√°m ph√° c√°c l·ªô tr√¨nh h·ªçc t·∫≠p ch·∫•t l∆∞·ª£ng cao';
          }
        }

        const roadmapsResponse = await fetch(`/api/roadmapsystem/category/${currentCategory}?limit=100`, {
          method: 'GET',
          headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });

        const roadmapsData = await roadmapsResponse.json();

        if (roadmapsData.success) {
          if (roadmapsData.data && roadmapsData.data.length > 0) {
            allRoadmaps = roadmapsData.data;
            filteredRoadmaps = allRoadmaps;
            updateStats();
            renderRoadmaps();
          } else {
            showEmptyState();
          }
        } else {
          showError(roadmapsData.error || 'Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu');
        }
      } catch (error) {
        showError('Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu: ' + error.message);
      } finally {
        document.getElementById('loadingState').style.display = 'none';
      }
    }

    function updateStats() {
      document.getElementById('totalRoadmaps').textContent = `${allRoadmaps.length} l·ªô tr√¨nh`;
      const totalLearners = allRoadmaps.reduce((sum, r) => sum + (r.total_user_learning || 0), 0);
      document.getElementById('totalLearners').textContent = `${totalLearners.toLocaleString()} h·ªçc vi√™n`;
    }

function renderRoadmaps() {
  const grid = document.getElementById('roadmapsGrid');
  if (!filteredRoadmaps || filteredRoadmaps.length === 0) {
    showEmptyState();
    return;
  }
  document.getElementById('emptyState').style.display = 'none';
  grid.innerHTML = filteredRoadmaps.map(roadmap => {
    const levelClass = roadmap.start_level === 'Intermediate' ? 'intermediate' : roadmap.start_level === 'Advanced' ? 'advanced' : '';
    const levelText = roadmap.start_level === 'Beginner' ? 'C∆° b·∫£n' : roadmap.start_level === 'Intermediate' ? 'Trung c·∫•p' : roadmap.start_level === 'Advanced' ? 'N√¢ng cao' : roadmap.start_level;
    return `
      <div class="roadmap-card" onclick="viewRoadmapDetails(${roadmap.roadmap_id})">
        <div class="roadmap-header">
          <span class="roadmap-level ${levelClass}">${levelText}</span>
        </div>
        <h3>${escapeHtml(roadmap.roadmap_name)}</h3>
        <div class="roadmap-meta">
          <div class="meta-item"><i class="fas fa-calendar"></i><span>${roadmap.duration_days} ng√†y</span></div>
          <div class="meta-item"><i class="fas fa-clock"></i><span>${roadmap.duration_hours}h</span></div>
          ${roadmap.sub_category ? `<div class="meta-item"><i class="fas fa-tag"></i><span>${escapeHtml(roadmap.sub_category)}</span></div>` : ''}
        </div>
        ${roadmap.overall_rating || roadmap.learning_effectiveness ? `
          <div class="roadmap-rating">
            ${roadmap.overall_rating ? `<div class="rating-item"><span class="rating-stars">‚≠ê</span><span class="rating-value">${Number(roadmap.overall_rating).toFixed(1)}</span><span style="color: #9ca3af;">T·ªïng th·ªÉ</span></div>` : ''}
            ${roadmap.learning_effectiveness ? `<div class="rating-item"><span class="rating-stars">üìà</span><span class="rating-value">${Number(roadmap.learning_effectiveness).toFixed(1)}</span><span style="color: #9ca3af;">Hi·ªáu qu·∫£</span></div>` : ''}
          </div>
        ` : ''}
        <div class="roadmap-footer">
          <div class="learner-count">
            <div class="learner-avatars">
              <div class="learner-avatar">üë§</div>
              <div class="learner-avatar" style="background: linear-gradient(135deg, #f093fb, #f5576c);">üë§</div>
              <div class="learner-avatar" style="background: linear-gradient(135deg, #4facfe, #00f2fe);">üë§</div>
            </div>
            <span>${roadmap.total_user_learning || 0}+ ƒëang h·ªçc</span>
          </div>
          <button class="view-btn" onclick="event.stopPropagation(); viewRoadmapDetails(${roadmap.roadmap_id})">Xem chi ti·∫øt</button>
        </div>
      </div>
    `;
  }).join('');
}

    function viewRoadmapDetails(roadmapId) {
      window.location.href = `roadmap_details.html?id=${roadmapId}`;
    }

    function showEmptyState() {
      document.getElementById('roadmapsGrid').innerHTML = '';
      document.getElementById('emptyState').style.display = 'block';
    }

    function showError(message) {
      document.getElementById('categoryDescription').textContent = message;
      showEmptyState();
    }

    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Filters
    document.getElementById('filterLevel').addEventListener('change', (e) => {
      const level = e.target.value;
      filteredRoadmaps = level ? allRoadmaps.filter(r => r.start_level === level) : allRoadmaps;
      renderRoadmaps();
    });

    document.getElementById('filterSort').addEventListener('change', (e) => {
      const sort = e.target.value;
      if (sort === 'popular') {
        filteredRoadmaps.sort((a, b) => (b.total_user_learning || 0) - (a.total_user_learning || 0));
      } else if (sort === 'rating') {
        filteredRoadmaps.sort((a, b) => (b.overall_rating || 0) - (a.overall_rating || 0));
      } else {
        filteredRoadmaps.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
      }
      renderRoadmaps();
    });

    // Load data on page load
    document.addEventListener('DOMContentLoaded', () => {
      loadCategoryData();
    });

    // Load navigation buttons based on user role ‚Äî updated to create actual Home button like main.html
    async function loadNavButtons() {
      const navButtons = document.getElementById('mainNavButtons');
      if (!navButtons) return;

      const token = localStorage.getItem('token');
      const role = localStorage.getItem('role') || 'user';

      // Always show Home button (so it behaves like main.html)
      let navHtml = `<button class="nav-btn" id="btnHome"><i class="fa-solid fa-house"></i> Trang Ch·ªß</button>`;
      // If token exists, include Path / Progress and Admin (if role)
      if (token) {
        navHtml += `<button class="nav-btn" id="btnPath"><i class="fa-solid fa-route"></i> L·ªô Tr√¨nh H·ªçc</button>`;
        navHtml += `<button class="nav-btn" id="btnProgress"><i class="fa-solid fa-chart-line"></i> Ti·∫øn ƒê·ªô</button>`;
        if (role === 'admin') {
          navHtml += `<button class="nav-btn" id="btnAdmin"><i class="fa-solid fa-user-shield"></i> Qu·∫£n Tr·ªã</button>`;
        }
      } else {
        // When not logged in, we still optionally show Path/Progress as links (you can change this behavior)
        navHtml += `<button class="nav-btn" id="btnPath"><i class="fa-solid fa-route"></i> L·ªô Tr√¨nh H·ªçc</button>`;
        navHtml += `<button class="nav-btn" id="btnProgress"><i class="fa-solid fa-chart-line"></i> Ti·∫øn ƒê·ªô</button>`;
      }

      navButtons.innerHTML = navHtml;

      // Attach event listeners
      const btnHome = document.getElementById('btnHome');
      if (btnHome) btnHome.addEventListener('click', () => { window.location.href = 'main.html'; });

      const btnPath = document.getElementById('btnPath');
      if (btnPath) btnPath.addEventListener('click', () => { window.location.href = 'path.html'; });

      const btnProgress = document.getElementById('btnProgress');
      if (btnProgress) btnProgress.addEventListener('click', () => { window.location.href = 'progress.html'; });

      const btnAdmin = document.getElementById('btnAdmin');
      if (btnAdmin) btnAdmin.addEventListener('click', () => { window.location.href = 'admin.html?page=admin'; });
    }

    // Call on page load
    document.addEventListener('DOMContentLoaded', loadNavButtons);
  </script>
</body>
</html>
