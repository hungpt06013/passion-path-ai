<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Con đường đam mê</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;300;400;500;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
    :root {
        --primary:#007bff;
        --primary-dark: #1e6fe6;
        --muted: #6b7280;
        --bg: #f5f8fb;
    }

    html, 
    body {
        height: 100%;
        overflow-x: hidden;
        overflow-y: auto;
    }

    body {
        margin: 0;
        padding: 0;
        background: var(--bg);
        font-family: 'Inter', sans-serif;
        color: #0f172a;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    .fixed-bar {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 80px;
        background: var(--primary);
        box-shadow: 0 6px 20px rgba(14, 30, 37, 0.12);
        z-index: 50;
    }

    .bar-inner {
        max-width: 1200px;
        height: 100%;
        margin: 0 auto;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 20px;
        box-sizing: border-box;
    }

    .brand {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .brand-icon {
        width: 48px;
        height: 48px;
        background: rgba(255,255,255,0.2);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 22px;
        flex-shrink: 0;
    }

    .brand-text {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .brand-title {
        color: white;
        font-size: 20px;
        font-weight: 700;
    }

    .brand-sub {
        color: rgba(255,255,255,0.9);
        font-size: 12px;
        font-weight: 600;
    }

    .nav-buttons {
        display: flex;
        gap: 22px;
        align-items: center;
    }

    .nav-btn {
        background: none;
        color: #fff;
        padding: 0;
        font-size: 15px;
        font-weight: 600;
        border-radius: 9999px;
    }

    .nav-btn .fa {
        margin-right: 8px;
        opacity: 0.95;
    }

    .nav-btn.active {
        color: #e6f2ff;
        text-decoration: underline;
    }

    button {
        font-family: 'Inter', sans-serif;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        border: none;
        border-radius: 9999px;
        padding: 10px 20px;
        font-size: 15px;
        font-weight: 600;
    }

    .userInfo {
        color: white;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .login-btn {
        background: white;
        color: #333;
        box-shadow: 0 2px 5px rgba(0,0,0,0.12);
    }

    .login-btn:hover {
        background: #f0f0f0;
    }

    .register-btn {
        background: #28a745;
        color: white;
        box-shadow: 0 2px 5px rgba(0,0,0,0.12);
    }

    .register-btn:hover {
        background: #218838;
    }

    .logout-btn {
        background: linear-gradient(135deg, #4b0ee5 0%, #0682d4 100%);
        color: white;
        box-shadow: 0 2px 5px rgba(0,0,0,0.12);
    }

    .toApp-btn {
        background: #000;
        color: white;
        box-shadow: 0 2px 5px rgba(0,0,0,0.12);
    }

    .admin-btn {
        background: #6f42c1;
        color: white;
        box-shadow: 0 2px 5px rgba(0,0,0,0.12);
    }

    main {
        margin-top: 135px;
        max-width: 1200px;
        margin-left: auto;
        margin-right: auto;
        padding: 30px 20px;
        box-sizing: border-box;
        position: relative;
    }

    .hero {
        display: grid;
        grid-template-columns: 1fr 560px;
        gap: 28px;
        align-items: start;
    }

    .hero-left {
        padding: 24px 12px;
    }

    .headline {
        font-size: 56px;
        line-height: 0.95;
        font-weight: 700;
        margin: 0;
        color: rgba(15,23,42,0.92);
    }

    .headline .accent {
        color: rgba(43,140,255,0.86);
        display: block;
        font-weight: 700;
    }

    .subdesc {
        margin-top: 18px;
        font-size: 18px;
        color: var(--muted);
        max-width: 640px;
    }

    .cta-row {
        margin-top: 28px;
        display: flex;
        gap: 12px;
        align-items: center;
    }

    .cta-center {
        display: flex;
        justify-content: center;
        width: 100%;
    }

    .cta-main {
        background: linear-gradient(180deg, var(--primary), var(--primary-dark));
        color: white;
        padding: 14px 28px;
        font-size: 18px;
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(43,140,255,0.18);
        display: inline-flex;
        align-items: center;
        gap: 10px;
    }

    .progress-card {
        background: white;
        border-radius: 14px;
        padding: 20px;
        box-shadow: 0 20px 40px rgba(13, 38, 71, 0.08);
        min-height: 370px;
    }

    .card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
    }

    .card-title {
        font-weight: 800;
        color: #0f172a;
        font-size: 20px;
    }
    .card-sub {
        color: var(--muted);
        font-size: 13px;
    }

    .progress-bar-wrap {
        margin-top: 14px;
        background: #eef2ff;
        height: 10px;
        border-radius: 999px;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        width: 42%;
        background: linear-gradient(90deg, var(--primary), var(--primary-dark));
    }

    .course-list {
        margin-top: 16px;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .course {
        border-radius: 10px;
        padding: 12px;
        background: #f8fbff;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        font-size: 14px;
    }

    .course.done {
        background: #e9f9ef;
    }

    .card-footer {
        margin-top: 18px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
    }

    .badges {
        display: flex;
        gap: 8px;
        align-items: center;
    }

    .badge {
        width: 28px;
        height: 28px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 10px rgba(12,40,80,0.06);
    }

    .points {
        font-weight: 700;
        color: #0f172a;
        font-size: 18px;
    }

    .features {
        margin-top: 28px;
        display: flex;
        gap: 22px;
        align-items: center;
        justify-content: center;
        width: 100%;
        box-sizing: border-box;
        padding-top: 8px;
    }

    .feature {
        display: flex;
        align-items: center;
        gap: 12px;
        background: white;
        padding: 12px 16px;
        border-radius: 12px;
        box-shadow: 0 8px 20px rgba(12,38,71,0.04);
        min-width: 180px;
        transition: transform 0.18s ease, box-shadow 0.18s ease;
    }

    .feature:hover {
        transform: translateY(-6px);
        box-shadow: 0 18px 40px rgba(12,38,71,0.08);
    }

    /* default icon style (kept for other features) */
    .feature i {
        background: linear-gradient(180deg, var(--primary), var(--primary-dark));
        color: white;
        padding: 8px;
        border-radius: 10px;
        width: 44px;
        height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        box-shadow: 0 8px 20px rgba(43,140,255,0.12);
    }

    /* custom styles for the two target features */
    .feature.ai i {
        /* purple -> teal gradient to be distinct from primary blue */
        background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%);
        box-shadow: 0 10px 26px rgba(124,58,237,0.16);
        transform: translateZ(0);
    }

    .feature.progress i {
        /* warm orange -> yellow gradient for progress/gamification */
        background: linear-gradient(135deg, #11a811 0%, #15c051 100%);
        box-shadow: 0 10px 26px rgba(249,115,22,0.14);
        transform: translateZ(0);
    }

    .feature .f-text {
        display: flex;
        flex-direction: column;
    }

    .feature .f-title {
        font-weight: 700;
        font-size: 14px;
    }

    .feature .f-sub {
        font-size: 13px;
        color: var(--muted);
    }

    /* Phần Lĩnh Vực Phổ Biến */
    .categories-section {
        /* kéo lên một chút so với trước, vẫn giữ khoảng trống thoáng */
        margin-top: 8px;
        padding: 30px 20px;
        max-width: 1200px;
        margin-left: auto;
        margin-right: auto;
    }

    .section-header {
        text-align: center;
        margin-bottom: 30px;
    }

    .section-title {
        font-size: 42px;
        font-weight: 800;
        color: #0f172a;
        margin: 0 0 12px 0;
    }

    .section-subtitle {
        font-size: 18px;
        color: var(--muted);
    }

    .categories-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
        gap: 24px;
    }

    .category-card {
        background: white;
        border-radius: 16px;
        padding: 28px;
        box-shadow: 0 4px 20px rgba(13, 38, 71, 0.08);
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
        overflow: hidden;
    }

    .category-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 40px rgba(13, 38, 71, 0.12);
    }

    .category-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--primary), var(--primary-dark));
    }

    .category-icon {
        width: 64px;
        height: 64px;
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        margin-bottom: 18px;
        color: white;
    }

    .category-name {
        font-size: 22px;
        font-weight: 700;
        color: #0f172a;
        margin: 0 0 8px 0;
    }

    .category-desc {
        font-size: 14px;
        color: var(--muted);
        margin: 0 0 16px 0;
        line-height: 1.6;
    }

    .category-stats {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-top: 16px;
        border-top: 1px solid #e5e7eb;
    }

    .category-count {
        font-size: 16px;
        font-weight: 600;
        color: var(--primary);
    }

    .category-btn {
        background: transparent;
        color: var(--primary);
        padding: 8px 16px;
        font-size: 14px;
        font-weight: 600;
        border: 2px solid var(--primary);
        border-radius: 8px;
        transition: all 0.3s ease;
    }

    .category-btn:hover {
        background: var(--primary);
        color: white;
    }

    /* Footer (rút gọn chiều cao) */
    footer {
        background: #1a202c;
        color: #e5e7eb;
        padding: 28px 20px 16px;
        margin-top: 40px;
    }

    .footer-content {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 2fr 1fr 1fr;
        gap: 24px;
        margin-bottom: 20px;
    }

    .footer-brand {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .footer-logo {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .footer-logo-icon {
        width: 44px;
        height: 44px;
        background: var(--primary);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 20px;
    }

    .footer-logo-text {
        display: flex;
        flex-direction: column;
    }

    .footer-logo-title {
        font-size: 18px;
        font-weight: 700;
        color: white;
    }

    .footer-logo-sub {
        font-size: 11px;
        color: #9ca3af;
    }

    .footer-desc {
        color: #9ca3af;
        line-height: 1.5;
        font-size: 13px;
    }

    .footer-social {
        display: flex;
        gap: 12px;
        margin-top: 8px;
    }

    .social-icon {
        width: 36px;
        height: 36px;
        background: #374151;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        transition: all 0.3s ease;
        text-decoration: none;
    }

    .social-icon:hover {
        background: var(--primary);
        transform: translateY(-2px);
    }

    .footer-section h3 {
        font-size: 15px;
        font-weight: 700;
        color: white;
        margin: 0 0 12px 0;
    }

    .footer-links {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .footer-link {
        color: #9ca3af;
        text-decoration: none;
        font-size: 13px;
        transition: color 0.3s ease;
    }

    .footer-link:hover {
        color: var(--primary);
    }

    .footer-bottom {
        max-width: 1200px;
        margin: 0 auto;
        padding-top: 16px;
        border-top: 1px solid #374151;
        text-align: center;
        color: #9ca3af;
        font-size: 13px;
    }

    @media (max-width:1100px) {
        .hero {
            grid-template-columns: 1fr 360px;
        }
        .headline {
            font-size: 48px;
        }
        .categories-grid {
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        }
    }

    @media (max-width:820px) {
        .bar-inner {
            flex-direction: column;
            height: auto;
            padding: 15px;
            gap: 10px;
        }

        .fixed-bar {
            height: auto;
        }

        .userInfo {
            flex-wrap: wrap;
            justify-content: center;
        }

        main {
            margin-top: 200px;
        }

        .hero {
            grid-template-columns: 1fr;
        }
        
        .progress-card {
            order: -1;
            margin-bottom: 16px;
        }
        
        .headline {
            font-size: 40px;
        }
        
        .card-footer {
            flex-direction: column;
            align-items: flex-start;
            gap: 8px;
        }
        
        .features {
            justify-content: flex-start;
            padding-left: 12px;
            flex-wrap: wrap;
        }

        .footer-content {
            grid-template-columns: 1fr;
            gap: 24px;
        }
    }

    @media (max-width:520px) {
        .brand-title {
            font-size: 16px;
        }

        .brand-sub {
            font-size: 11px;
        }

        button {
            font-size: 13px;
            padding: 8px 14px;
        }

        main {
            padding: 20px 15px;
        }

        .headline {
            font-size: 32px;
        }
        
        .subdesc {
            font-size: 15px;
        }
        
        .progress-card {
            padding: 16px;
        }
        
        .feature {
            min-width: 140px;
            padding: 10px 12px;
        }

        .feature i {
            width: 38px;
            height: 38px;
            font-size: 16px;
        }

        .cta-main {
            font-size: 16px;
            padding: 12px 24px;
        }

        .section-title {
            font-size: 32px;
        }

        .categories-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
</head>
<body>
    <div class="fixed-bar">
        <div class="bar-inner">
            <div class="brand">
                <div class="brand-icon">
                    <i class="fa-solid fa-graduation-cap"></i>
                </div>
                <div class="brand-text">
                    <div class="brand-title">Con đường đam mê</div>
                    <div class="brand-sub">AI-Powered Learning Path</div>
                </div>
            </div>
            <div class="nav-buttons" id="mainNavButtons">
            <!-- Buttons sẽ được thêm bằng JavaScript -->
            </div>
            <div id="userArea" class="userInfo">
                <button class="login-btn"><i class="fa-solid fa-right-to-bracket"></i> Đăng nhập</button>
                <button class="register-btn"><i class="fa-solid fa-user-plus"></i> Đăng ký</button>
            </div>
        </div>
    </div>

    <main>
        <div class="hero">
            <div class="hero-left">
                <h1 class="headline">Trưởng thành từ <span class="accent">Những Sở Thích</span></h1>
                <p class="subdesc">Khám phá hệ thống học tập thông minh sử dụng AI để tạo lộ trình học tập cá nhân hóa. Biến đam mê thành kỹ năng, biến sở thích thành thành công.</p>

                <div class="cta-row">
                    <div class="cta-center" style="width:100%;">
                        <button class="cta-main" id="startNowBtn"><i class="fa-solid fa-rocket"></i> Bắt Đầu Ngay</button>
                    </div>
                </div>

                <div class="features" role="list">
                    <div class="feature ai" role="listitem">
                        <i class="fa-solid fa-brain"></i>
                        <div class="f-text">
                            <div class="f-title">AI Thông Minh</div>
                            <div class="f-sub">Phân tích sở thích</div>
                        </div>
                    </div>

                    <div class="feature progress" role="listitem">
                        <i class="fa-solid fa-chart-line"></i>
                        <div class="f-text">
                            <div class="f-title">Theo Dõi Tiến Độ</div>
                            <div class="f-sub">Gamification</div>
                        </div>
                    </div>
                </div>
            </div>

            <aside class="progress-card" aria-hidden="false">
                <div class="card-header">
                    <div>
                        <div class="card-title">Lộ Trình Học: Lập Trình C++</div>
                        <div class="card-sub">5% hoàn thành • 30 ngày</div>
                    </div>
                    <div style="text-align:right;">
                        <div style="font-weight:800; font-size:16px; color:#0f172a;">5%</div>
                        <div style="font-size:12px; color:var(--muted);">Tiến độ tổng thể</div>
                    </div>
                </div>

                <div class="progress-bar-wrap" aria-hidden="true">
                    <div class="progress-fill" style="width:5%;"></div>
                </div>

                <div class="course-list">
                    <div class="course done">
                        <div class="label">
                            <i class="fa-solid fa-check-circle" style="color:#16a34a;"></i>
                            <div>Bài 1: Giới thiệu C++</div>
                        </div>
                        <div class="meta">30 phút • 100% hoàn thành</div>
                    </div>

                    <div class="course">
                        <div class="label">
                            <i class="fa-solid fa-play-circle" style="color:#2563eb;"></i>
                            <div>Bài 2: Lấy, xuất dữ liệu</div>
                        </div>
                        <div class="meta">30 phút • 50% hoàn thành</div>
                    </div>

                    <div class="course">
                        <div class="label">
                            <i class="fa-regular fa-clock" style="color:#9ca3af;"></i>
                            <div>Bài 3: Số nguyên và toán cơ bản</div>
                        </div>
                        <div class="meta">30 phút • Sắp tới</div>
                    </div>
                </div>

                <div class="card-footer">
                    <div class="badges">
                        <div class="badge" style="background:#fff5f0;"><i class="fa-solid fa-medal" style="color:#fb923c;"></i></div>
                        <div class="badge" style="background:#f8fafc;"><i class="fa-solid fa-star" style="color:#a78bfa;"></i></div>
                        <div class="badge" style="background:#f0fdf4;"><i class="fa-solid fa-trophy" style="color:#34d399;"></i></div>
                    </div>
                    <div style="text-align:right;">
                        <div class="points">1/30</div>
                        <div class="card-sub" style="text-align:right;">Số bài đã làm</div>
                    </div>
                </div>
            </aside>
        </div>
    </main>

    <!-- Phần Lĩnh Vực Phổ Biến -->
    <section class="categories-section">
        <div class="section-header">
            <h2 class="section-title">Lĩnh Vực Phổ Biến</h2>
            <p class="section-subtitle">Khám phá các lộ trình học tập được yêu thích nhất</p>
        </div>
        <div class="categories-grid" id="categoriesGrid">
            <!-- Categories will be loaded here -->
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-brand">
                <div class="footer-logo">
                    <div class="footer-logo-icon">
                        <i class="fa-solid fa-graduation-cap"></i>
                    </div>
                    <div class="footer-logo-text">
                        <div class="footer-logo-title">Con đường đam mê</div>
                        <div class="footer-logo-sub">AI-Powered Learning Path</div>
                    </div>
                </div>
                <p class="footer-desc">Nền tảng học tập cá nhân hóa sử dụng trí tuệ nhân tạo để tạo lộ trình học phù hợp với sở thích và mục tiêu của từng người.</p>
                <!--<div class="footer-social">
                    <a href="#" class="social-icon"><i class="fa-brands fa-facebook-f"></i></a>
                    <a href="#" class="social-icon"><i class="fa-brands fa-twitter"></i></a>
                    <a href="#" class="social-icon"><i class="fa-brands fa-linkedin-in"></i></a>
                </div>-->
            </div>

            <div class="footer-section">
                <h3>Tính Năng</h3>
                <div class="footer-links">
                    <a href="#" class="footer-link">Tạo lộ trình với AI</a>
                    <a href="#" class="footer-link">Lưu trữ các lộ trình</a>
                    <a href="#" class="footer-link">Theo dõi tiến độ</a>
                </div>
            </div>

            <div class="footer-section">
                <h3>Hỗ Trợ</h3>
                <div class="footer-links">
                    <a href="https://zalo.me/g/drfrli672" target="_blank" rel="noopener noreferrer" class="footer-link">Trung tâm trợ giúp</a>
                    <a href="https://mail.google.com/mail/?view=cm&fs=1&to=passionpathaisystem@gmail.com" target="_blank" rel="noopener noreferrer" class="footer-link">Liên hệ</a>
                    <a href="#" class="footer-link">Thu thập ý kiến</a>
                </div>
            </div>
        </div>

        <div class="footer-bottom">
            © 2025 Con đường đam mê. All rights reserved. Made with <i class="fa-solid fa-heart" style="color:#e74c3c;"></i> for learners worldwide.
        </div>
    </footer>

    <script>
        const loginBtn = document.querySelector(".login-btn");
        const registerBtn = document.querySelector(".register-btn");
        const userArea = document.getElementById("userArea");
        const ADMIN_TOKEN = 'admin-token';

        // Color schemes for categories
        const categoryColors = [
            { bg: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', icon: 'fa-code' },
            { bg: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)', icon: 'fa-globe' },
            { bg: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)', icon: 'fa-palette' },
            { bg: 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)', icon: 'fa-calculator' },
            { bg: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)', icon: 'fa-chart-line' },
            { bg: 'linear-gradient(135deg, #30cfd0 0%, #330867 100%)', icon: 'fa-music' }
        ];

        function showAuthButtons() {
            loginBtn.style.display = "inline-flex";
            registerBtn.style.display = "inline-flex";
            const children = Array.from(userArea.children);
            children.forEach(c => {
                if (!c.classList.contains('login-btn') && !c.classList.contains('register-btn')) {
                    try {
                        userArea.removeChild(c);
                    } catch (e) {}
                }
            });
        }

        loginBtn.addEventListener("click", () => {
            window.location.href = "login.html";
        });

        registerBtn.addEventListener("click", () => {
            window.location.href = "register.html";
        });

        function wireLogoutAndNav(logoutEl) {
            if (logoutEl) {
                logoutEl.addEventListener('click', () => {
                    localStorage.removeItem('token');
                    localStorage.removeItem('role');

                    if (!document.querySelector('.login-btn')) {
                        const b = document.createElement('button');
                        b.className = 'login-btn';
                        b.innerHTML = '<i class="fa-solid fa-right-to-bracket"></i> Đăng nhập';
                        b.addEventListener('click', () => window.location.href = 'login.html');
                        userArea.appendChild(b);
                    }

                    if (!document.querySelector('.register-btn')) {
                        const b2 = document.createElement('button');
                        b2.className = 'register-btn';
                        b2.innerHTML = '<i class="fa-solid fa-user-plus"></i> Đăng ký';
                        b2.addEventListener('click', () => window.location.href = 'register.html');
                        userArea.appendChild(b2);
                    }

                    showAuthButtons();
                });
            }
        }
        async function loadUser() {
            const token = localStorage.getItem('token');
            const navButtons = document.getElementById('mainNavButtons');
            
            // Reset navigation buttons
            if (navButtons) {
                navButtons.innerHTML = '';
            }
            
            showAuthButtons();
            if (!token) return;

            let name = 'Người dùng';
            let serverRole = 'user';

            if (token === ADMIN_TOKEN) {
                name = 'Admin';
                serverRole = 'admin';
                localStorage.setItem('role', 'admin');
            } else {
                try {
                    const res = await fetch('/api/me', { headers: { 'Authorization': 'Bearer ' + token }});
                    if (!res.ok) { 
                        showAuthButtons(); 
                        return; 
                    }
                    const data = await res.json();
                    serverRole = (data && (data.role || (data.user && data.user.role))) ? (data.role || data.user.role) : 'user';
                    name = (data && data.user && data.user.name) ? data.user.name : 'Người dùng';
                    localStorage.setItem('role', serverRole);
                } catch (err) {
                    console.error(err);
                    showAuthButtons();
                    return;
                }
            }

            if (document.querySelector('.login-btn')) {
                document.querySelector('.login-btn').style.display = 'none';
            }
            if (document.querySelector('.register-btn')) {
                document.querySelector('.register-btn').style.display = 'none';
            }

            userArea.innerHTML = `
                <span>Xin chào <strong style="color:white;">${name}</strong></span>
                <button id="logout" class="logout-btn"><i class="fa-solid fa-right-from-bracket"></i> Đăng xuất</button>
            `;
            const logoutEl = document.getElementById('logout');
            wireLogoutAndNav(logoutEl);

            // Thêm navigation buttons
            let navHtml = `
                <button class="nav-btn" id="btnHome"><i class="fa-solid fa-house"></i> Trang chủ</button>
                <button class="nav-btn" id="btnPath"><i class="fa-solid fa-route"></i> Lộ Trình Học</button>
                <button class="nav-btn" id="btnProgress"><i class="fa-solid fa-chart-line"></i> Tiến Độ</button>
            `;
            if (serverRole === 'admin') {
                navHtml += `
                    <button class="nav-btn" id="btnAdmin"><i class="fa-solid fa-user-shield"></i> Quản Trị</button>
                `;
            }
            navButtons.innerHTML = navHtml;

            // Add event listeners
            document.getElementById('btnHome').addEventListener('click', () => { window.location.href = 'main.html'; });
            document.getElementById('btnPath').addEventListener('click', () => { window.location.href = 'path.html'; });
            document.getElementById('btnProgress').addEventListener('click', () => { window.location.href = 'progress.html'; });
            if (serverRole === 'admin') {
                document.getElementById('btnAdmin').addEventListener('click', () => { window.location.href = 'admin.html?page=admin'; });
            }

            // Active state
            const params = new URLSearchParams(window.location.search);
            const page = params.get('page') || 'home';
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            const idMap = { home: 'btnHome', path: 'btnPath', progress: 'btnProgress', admin: 'btnAdmin' };
            const btnId = idMap[page];
            if (btnId) {
                const el = document.getElementById(btnId);
                if (el) el.classList.add('active');
            }
        }
        // Load top categories
        async function loadTopCategories() {
            try {
                const res = await fetch('/api/categories/top', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });

                if (!res.ok) throw new Error('Failed to load categories');
                
                const categories = await res.json();
                const grid = document.getElementById('categoriesGrid');
                
                categories.forEach((cat, index) => {
                    const colorScheme = categoryColors[index % categoryColors.length];
                    const card = document.createElement('div');
                    card.className = 'category-card';
                    card.onclick = () => {
                        window.location.href = `main_category.html?category=${encodeURIComponent(cat.id)}`;
                    };
                    
                    card.innerHTML = `
                        <div class="category-icon" style="background: ${colorScheme.bg};">
                            <i class="fa-solid ${colorScheme.icon}"></i>
                        </div>
                        <h3 class="category-name">${cat.name}</h3>
                        <p class="category-desc">${cat.description}</p>
                        <div class="category-stats">
                            <span class="category-count">${cat.roadmap_count}+ lộ trình</span>
                            <button class="category-btn">Xem chi tiết</button>
                        </div>
                    `;
                    
                    grid.appendChild(card);
                });
            } catch (err) {
                console.error('Error loading categories:', err);
            }
        }

        loadUser();
        loadTopCategories();

        const startBtn = document.getElementById('startNowBtn');
        if (startBtn) {
            startBtn.addEventListener('click', () => {
                const token = localStorage.getItem('token');
                if (!token) {
                    window.location.href = 'login.html';
                } else {
                    window.location.href = 'path.html';
                }
            });
        }
    </script>
</body>
</html>

