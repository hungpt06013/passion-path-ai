<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Trang chủ - Con đường đam mê</title>
    
    <!-- Preconnect to external resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    
    <!-- Critical CSS inline (moved from style tag) -->
    <style>
    :root {
        --primary:#007bff;
        --primary-dark: #1e6fe6;
        --muted: #6b7280;
        --bg: #f5f8fb;
    }

    html, 
    body {
        height: 100%;
        overflow-x: hidden;
        overflow-y: auto;
    }

    body {
        margin: 0;
        padding: 0;
        background: var(--bg);
        font-family: 'Inter', sans-serif;
        color: #0f172a;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    .fixed-bar {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 80px;
        background: var(--primary);
        box-shadow: 0 6px 20px rgba(14, 30, 37, 0.12);
        z-index: 50;
    }

    .bar-inner {
        max-width: 1200px;
        height: 100%;
        margin: 0 auto;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 20px;
        box-sizing: border-box;
    }

    .brand {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .brand-icon {
        width: 48px;
        height: 48px;
        background: rgba(255,255,255,0.2);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 22px;
        flex-shrink: 0;
    }

    .brand-text {
        display: flex;
        flex-direction: column;
        margin-top: -1px;
    }

    .brand-title {
        color: white;
        font-size: 20px;
        font-weight: 700;
    }

    .brand-sub {
        color: rgba(255,255,255,0.9);
        font-size: 12px;
        font-weight: 600;
    }

    .nav-buttons {
        display: flex;
        gap: 22px;
        align-items: center;
    }

    .nav-btn {
        background: none;
        color: #fff;
        padding: 0;
        font-size: 15px;
        font-weight: 600;
        border-radius: 9999px;
    }

    .nav-btn .fa {
        margin-right: 8px;
        opacity: 0.95;
    }

    .nav-btn.active {
        color: #e6f2ff;
        text-decoration: underline;
    }

    button {
        font-family: 'Inter', sans-serif;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        border: none;
        border-radius: 9999px;
        padding: 10px 20px;
        font-size: 15px;
        font-weight: 600;
    }

    .userInfo {
        color: white;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .login-btn {
        background: white;
        color: #333;
        box-shadow: 0 2px 5px rgba(0,0,0,0.12);
    }

    .login-btn:hover {
        background: #f0f0f0;
    }

    .register-btn {
        background: #28a745;
        color: white;
        box-shadow: 0 2px 5px rgba(0,0,0,0.12);
    }

    .register-btn:hover {
        background: #218838;
    }

    .logout-btn {
        background: linear-gradient(135deg, #4b0ee5 0%, #0682d4 100%);
        color: white;
        box-shadow: 0 2px 5px rgba(0,0,0,0.12);
    }

    .toApp-btn {
        background: #000;
        color: white;
        box-shadow: 0 2px 5px rgba(0,0,0,0.12);
    }

    .admin-btn {
        background: #6f42c1;
        color: white;
        box-shadow: 0 2px 5px rgba(0,0,0,0.12);
    }

    main {
        margin-top: 135px;
        max-width: 1200px;
        margin-left: auto;
        margin-right: auto;
        padding: 30px 20px;
        box-sizing: border-box;
        position: relative;
    }

    .hero {
        display: grid;
        grid-template-columns: 1fr 560px;
        gap: 28px;
        align-items: start;
    }

    .hero-left {
        padding: 24px 12px;
    }

    .headline {
        font-size: 56px;
        line-height: 0.95;
        font-weight: 700;
        margin: 0;
        color: rgba(15,23,42,0.92);
    }

    .headline .accent {
        color: rgba(43,140,255,0.86);
        display: block;
        font-weight: 700;
    }

    .subdesc {
        margin-top: 18px;
        font-size: 18px;
        color: var(--muted);
        max-width: 640px;
    }

    .cta-row {
        margin-top: 28px;
        display: flex;
        gap: 12px;
        align-items: center;
    }

    .cta-center {
        display: flex;
        justify-content: center;
        width: 100%;
    }

    .cta-main {
        background: linear-gradient(180deg, var(--primary), var(--primary-dark));
        color: white;
        padding: 14px 28px;
        font-size: 18px;
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(43,140,255,0.18);
        display: inline-flex;
        align-items: center;
        gap: 10px;
    }

    .progress-card {
        background: white;
        border-radius: 14px;
        padding: 20px;
        box-shadow: 0 20px 40px rgba(13, 38, 71, 0.08);
        min-height: 370px;
    }

    .card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
    }

    .card-title {
        font-weight: 800;
        color: #0f172a;
        font-size: 20px;
    }
    .card-sub {
        color: var(--muted);
        font-size: 13px;
    }

    .progress-bar-wrap {
        margin-top: 14px;
        background: #eef2ff;
        height: 10px;
        border-radius: 999px;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        width: 42%;
        background: linear-gradient(90deg, var(--primary), var(--primary-dark));
    }

    .course-list {
        margin-top: 16px;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .course {
        border-radius: 10px;
        padding: 12px;
        background: #f8fbff;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        font-size: 14px;
    }

    .course.done {
        background: #e9f9ef;
    }

    .card-footer {
        margin-top: 18px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
    }

    .badges {
        display: flex;
        gap: 8px;
        align-items: center;
    }

    .badge {
        width: 28px;
        height: 28px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 10px rgba(12,40,80,0.06);
    }

    .points {
        font-weight: 700;
        color: #0f172a;
        font-size: 18px;
    }

    .features {
        margin-top: 28px;
        display: flex;
        gap: 22px;
        align-items: center;
        justify-content: center;
        width: 100%;
        box-sizing: border-box;
        padding-top: 8px;
    }

    .feature {
        display: flex;
        align-items: center;
        gap: 12px;
        background: white;
        padding: 12px 16px;
        border-radius: 12px;
        box-shadow: 0 8px 20px rgba(12,38,71,0.04);
        min-width: 180px;
        transition: transform 0.18s ease, box-shadow 0.18s ease;
    }

    .feature:hover {
        transform: translateY(-6px);
        box-shadow: 0 18px 40px rgba(12,38,71,0.08);
    }

    /* default icon style (kept for other features) */
    .feature i {
        background: linear-gradient(180deg, var(--primary), var(--primary-dark));
        color: white;
        padding: 8px;
        border-radius: 10px;
        width: 44px;
        height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        box-shadow: 0 8px 20px rgba(43,140,255,0.12);
    }

    /* custom styles for the two target features */
    .feature.ai i {
        /* purple -> teal gradient to be distinct from primary blue */
        background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%);
        box-shadow: 0 10px 26px rgba(124,58,237,0.16);
        transform: translateZ(0);
    }

    .feature.progress i {
        /* warm orange -> yellow gradient for progress/gamification */
        background: linear-gradient(135deg, #11a811 0%, #15c051 100%);
        box-shadow: 0 10px 26px rgba(249,115,22,0.14);
        transform: translateZ(0);
    }

    .feature .f-text {
        display: flex;
        flex-direction: column;
    }

    .feature .f-title {
        font-weight: 700;
        font-size: 14px;
    }

    .feature .f-sub {
        font-size: 13px;
        color: var(--muted);
    }

    /* Phần Lĩnh Vực Phổ Biến */
    .categories-section {
        /* kéo lên một chút so với trước, vẫn giữ khoảng trống thoáng */
        margin-top: 8px;
        padding: 30px 20px;
        max-width: 1400px;
        margin-left: auto;
        margin-right: auto;
    }

    .section-header {
        text-align: center;
        margin-bottom: 30px;
    }

    .section-title {
        font-size: 42px;
        font-weight: 800;
        color: #0f172a;
        margin: 0 0 12px 0;
    }

    .section-subtitle {
        font-size: 18px;
        color: var(--muted);
    }

    .categories-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 24px;
        align-items: stretch;
    }

    .category-card {
        background: white;
        border-radius: 16px;
        padding: 28px;
        box-shadow: 0 4px 20px rgba(13, 38, 71, 0.08);
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
        overflow: hidden;
        min-height: 240px;
    }

    .category-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 40px rgba(13, 38, 71, 0.12);
    }

    .category-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--primary), var(--primary-dark));
    }

    .category-icon {
        width: 64px;
        height: 64px;
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        margin-bottom: 18px;
        color: white;
    }

    .category-name {
        font-size: 22px;
        font-weight: 700;
        color: #0f172a;
        margin: 0 0 8px 0;
    }

    .category-desc {
        font-size: 14px;
        color: var(--muted);
        margin: 0 0 16px 0;
        line-height: 1.6;
        flex-grow: 1; /* Cho phép phần này tự mở rộng để đẩy phần stats xuống dưới */
        min-height: 42px;
    }

    .category-stats {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-top: 16px;
        border-top: 1px solid #e5e7eb;
    }

    .category-count {
        font-size: 16px;
        font-weight: 600;
        color: var(--primary);
    }

    .category-btn {
        background: transparent;
        color: var(--primary);
        padding: 8px 16px;
        font-size: 14px;
        font-weight: 600;
        border: 2px solid var(--primary);
        border-radius: 8px;
        transition: all 0.3s ease;
    }

    .category-btn:hover {
        background: var(--primary);
        color: white;
    }

    @media (max-width:1100px) {
        .hero {
            grid-template-columns: 1fr 360px;
        }
        .headline {
            font-size: 48px;
        }
        .categories-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width:820px) {
        .bar-inner {
            flex-direction: column;
            height: auto;
            padding: 15px;
            gap: 10px;
        }

        .fixed-bar {
            height: auto;
        }

        .userInfo {
            flex-wrap: wrap;
            justify-content: center;
        }

        main {
            margin-top: 200px;
        }

        .hero {
            grid-template-columns: 1fr;
        }
        
        .progress-card {
            order: -1;
            margin-bottom: 16px;
        }
        
        .headline {
            font-size: 40px;
        }
        
        .card-footer {
            flex-direction: column;
            align-items: flex-start;
            gap: 8px;
        }
        
        .features {
            justify-content: flex-start;
            padding-left: 12px;
            flex-wrap: wrap;
        }

        .footer-content {
            grid-template-columns: 1fr;
            gap: 24px;
        }
    }

    @media (max-width:520px) {
        .brand-title {
            font-size: 16px;
        }

        .brand-sub {
            font-size: 11px;
        }

        button {
            font-size: 13px;
            padding: 8px 14px;
        }

        main {
            padding: 20px 15px;
        }

        .headline {
            font-size: 32px;
        }
        
        .subdesc {
            font-size: 15px;
        }
        
        .progress-card {
            padding: 16px;
        }
        
        .feature {
            min-width: 140px;
            padding: 10px 12px;
        }

        .feature i {
            width: 38px;
            height: 38px;
            font-size: 16px;
        }

        .cta-main {
            font-size: 16px;
            padding: 12px 24px;
        }

        .section-title {
            font-size: 32px;
        }

        .categories-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
    <!-- Load Google Fonts async with display swap -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;300;400;500;600;700;900&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;300;400;500;600;700;900&display=swap" rel="stylesheet"></noscript>
    
    <!-- Load footer.css async (non-critical) -->
    <link rel="preload" href="footer.css" as="style">
    <link rel="stylesheet" href="footer.css" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="footer.css"></noscript>
</head>
<body>
    <div class="fixed-bar">
        <div class="bar-inner">
            <div class="brand">
                <div class="brand-icon">
                    <i class="fa-solid fa-graduation-cap"></i>
                </div>
                <div class="brand-text">
                    <div class="brand-title">Con đường đam mê</div>
                    <div class="brand-sub">AI-Powered Learning Path</div>
                </div>
            </div>
            <div class="nav-buttons" id="mainNavButtons">
            <!-- Buttons sẽ được thêm bằng JavaScript -->
            </div>
            <div id="userArea" class="userInfo">
                <button class="login-btn"><i class="fa-solid fa-right-to-bracket"></i> Đăng nhập</button>
                <button class="register-btn"><i class="fa-solid fa-user-plus"></i> Đăng ký</button>
            </div>
        </div>
    </div>

    <main>
        <div class="hero">
            <div class="hero-left">
                <h1 class="headline">Trưởng thành từ <span class="accent">Những Sở Thích</span></h1>
                <p class="subdesc">Khám phá hệ thống học tập thông minh sử dụng AI để tạo lộ trình học tập cá nhân hóa. Biến đam mê thành kỹ năng, biến sở thích thành thành công.</p>

                <div class="cta-row">
                    <div class="cta-center" style="width:100%;">
                        <button class="cta-main" id="startNowBtn"><i class="fa-solid fa-rocket"></i> Bắt Đầu Ngay</button>
                    </div>
                </div>

                <div class="features" role="list">
                    <div class="feature ai" role="listitem">
                        <i class="fa-solid fa-brain"></i>
                        <div class="f-text">
                            <div class="f-title">AI Thông Minh</div>
                            <div class="f-sub">Phân tích sở thích</div>
                        </div>
                    </div>

                    <div class="feature progress" role="listitem">
                        <i class="fa-solid fa-chart-line"></i>
                        <div class="f-text">
                            <div class="f-title">Theo Dõi Tiến Độ</div>
                            <div class="f-sub">Gamification</div>
                        </div>
                    </div>
                </div>
            </div>

            <aside class="progress-card" aria-hidden="false">
                <div class="card-header">
                    <div>
                        <div class="card-title">Lộ Trình Học: Lập Trình C++</div>
                        <div class="card-sub">5% hoàn thành • 30 ngày</div>
                    </div>
                    <div style="text-align:right;">
                        <div style="font-weight:800; font-size:16px; color:#0f172a;">5%</div>
                        <div style="font-size:12px; color:var(--muted);">Tiến độ tổng thể</div>
                    </div>
                </div>

                <div class="progress-bar-wrap" aria-hidden="true">
                    <div class="progress-fill" style="width:5%;"></div>
                </div>

                <div class="course-list">
                    <div class="course done">
                        <div class="label">
                            <i class="fa-solid fa-check-circle" style="color:#16a34a;"></i>
                            <div>Bài 1: Giới thiệu C++</div>
                        </div>
                        <div class="meta">30 phút • 100% hoàn thành</div>
                    </div>

                    <div class="course">
                        <div class="label">
                            <i class="fa-solid fa-play-circle" style="color:#2563eb;"></i>
                            <div>Bài 2: Lấy, xuất dữ liệu</div>
                        </div>
                        <div class="meta">30 phút • 50% hoàn thành</div>
                    </div>

                    <div class="course">
                        <div class="label">
                            <i class="fa-regular fa-clock" style="color:#9ca3af;"></i>
                            <div>Bài 3: Số nguyên và toán cơ bản</div>
                        </div>
                        <div class="meta">30 phút • Sắp tới</div>
                    </div>
                </div>

                <div class="card-footer">
                    <div class="badges">
                        <div class="badge" style="background:#fff5f0;"><i class="fa-solid fa-medal" style="color:#fb923c;"></i></div>
                        <div class="badge" style="background:#f8fafc;"><i class="fa-solid fa-star" style="color:#a78bfa;"></i></div>
                        <div class="badge" style="background:#f0fdf4;"><i class="fa-solid fa-trophy" style="color:#34d399;"></i></div>
                    </div>
                    <div style="text-align:right;">
                        <div class="points">1/30</div>
                        <div class="card-sub" style="text-align:right;">Số bài đã làm</div>
                    </div>
                </div>
            </aside>
        </div>
    <!-- Phần Lĩnh Vực Phổ Biến -->
    <section class="categories-section">
        <div class="section-header">
            <h2 class="section-title">Lĩnh Vực Phổ Biến</h2>
            <p class="section-subtitle">Khám phá các lộ trình học tập được yêu thích nhất</p>
        </div>
        <div class="categories-grid" id="categoriesGrid">
            <!-- Categories will be loaded here -->
        </div>
    </section>
    </main>


  <div id="footer"></div>
  <script>
// Lazy load Font Awesome sau khi trang đã render
window.addEventListener('load', function() {
    const link = document.createElement('link');
    link.rel = 'stylesheet';
    link.href = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css';
    document.head.appendChild(link);
});
</script>
<script>
    const loginBtn = document.querySelector(".login-btn");
    const registerBtn = document.querySelector(".register-btn");
    const createBtn = document.querySelector("create-btn");
    const pathBtn = document.querySelector("path-btn");
    const progressBtn = document.querySelector("progress-btn");
    const userArea = document.getElementById("userArea");
    const ADMIN_TOKEN = 'admin-token';
    // Color schemes for categories
    const categoryColors = {
        'Lập trình': { bg: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', icon: 'fa-code' },
        'Marketing': { bg: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)', icon: 'fa-globe' },
        'Thiết kế': { bg: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)', icon: 'fa-palette' },
        'Ngoại ngữ': { bg: 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)', icon: 'fa-calculator' },
        'Kinh doanh': { bg: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)', icon: 'fa-chart-line' },
        'Kỹ năng mềm': { bg: 'linear-gradient(135deg, #30cfd0 0%, #330867 100%)', icon: 'fa-music' },
        'default': { bg: 'linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%)', icon: 'fa-lightbulb' }
    };
(function createNavButtons() {
    const navButtons = document.getElementById('mainNavButtons');
    if (navButtons) {
        navButtons.innerHTML = `
            <button class="nav-btn active" id="btnHome"><i class="fa-solid fa-house"></i> Trang Chủ</button>
            <button class="nav-btn" id="btnPath"><i class="fa-solid fa-route"></i> Lộ Trình Học</button>
            <button class="nav-btn" id="btnProgress"><i class="fa-solid fa-chart-line"></i> Tiến Độ</button>
        `;
        
        // Gắn sự kiện click ngay
        document.getElementById('btnHome').addEventListener('click', () => { 
            window.location.href = 'main.html'; 
        });
        
        document.getElementById('btnPath').addEventListener('click', () => {
            const token = localStorage.getItem('token');
             if (!token) {
                alert('Vui lòng đăng nhập!');
                window.location.href = 'login.html';
             }else {
            window.location.href = 'path.html';
             }
        });
        
        document.getElementById('btnProgress').addEventListener('click', () => { 
                        const token = localStorage.getItem('token');
             if (!token) {
                alert('Vui lòng đăng nhập!');
                window.location.href = 'login.html';
             }else {
            window.location.href = 'progress.html';
             }
        });
    }
})();

// Đợi DOM load xong
document.addEventListener('DOMContentLoaded', function() {
    const createBtn = document.getElementById('create-btn'); // Sửa lại ID đúng
    if (createBtn) {
        createBtn.addEventListener('click', (e) => {
            e.preventDefault(); // Ngăn link mặc định
            const token = localStorage.getItem('token');
            if (!token) {
                alert('Vui lòng đăng nhập!');
                window.location.href = 'login.html';
            } else {
                window.location.href = 'create_roadmap_page.html';
            }
        });
    }
});
document.addEventListener('DOMContentLoaded', function() {
    const createBtn = document.getElementById('path-btn'); // Sửa lại ID đúng
    if (createBtn) {
        createBtn.addEventListener('click', (e) => {
            e.preventDefault(); // Ngăn link mặc định
            const token = localStorage.getItem('token');
            if (!token) {
                alert('Vui lòng đăng nhập!');
                window.location.href = 'login.html';
            } else {
                window.location.href = 'path.html';
            }
        });
    }
});
document.addEventListener('DOMContentLoaded', function() {
    const createBtn = document.getElementById('progress-btn'); // Sửa lại ID đúng
    if (createBtn) {
        createBtn.addEventListener('click', (e) => {
            e.preventDefault(); // Ngăn link mặc định
            const token = localStorage.getItem('token');
            if (!token) {
                alert('Vui lòng đăng nhập!');
                window.location.href = 'login.html';
            } else {
                window.location.href = 'progress.html';
            }
        });
    }
});
    function showAuthButtons() {
        loginBtn.style.display = "inline-flex";
        registerBtn.style.display = "inline-flex";
        const children = Array.from(userArea.children);
        children.forEach(c => {
            if (!c.classList.contains('login-btn') && !c.classList.contains('register-btn')) {
                try {
                    userArea.removeChild(c);
                } catch (e) {}
            }
        });
    }

    loginBtn.addEventListener("click", () => {
        window.location.href = "login.html";
    });

    registerBtn.addEventListener("click", () => {
        window.location.href = "register.html";
    });

    function wireLogoutAndNav(logoutEl) {
        if (logoutEl) {
            logoutEl.addEventListener('click', () => {
                localStorage.removeItem('token');
                localStorage.removeItem('role');

                if (!document.querySelector('.login-btn')) {
                    const b = document.createElement('button');
                    b.className = 'login-btn';
                    b.innerHTML = '<i class="fa-solid fa-right-to-bracket"></i> Đăng nhập';
                    b.addEventListener('click', () => window.location.href = 'login.html');
                    userArea.appendChild(b);
                }

                if (!document.querySelector('.register-btn')) {
                    const b2 = document.createElement('button');
                    b2.className = 'register-btn';
                    b2.innerHTML = '<i class="fa-solid fa-user-plus"></i> Đăng ký';
                    b2.addEventListener('click', () => window.location.href = 'register.html');
                    userArea.appendChild(b2);
                }

                showAuthButtons();
            });
        }
    }

    async function loadUser() {
        const token = localStorage.getItem('token');
        const navButtons = document.getElementById('mainNavButtons');
        

        
        showAuthButtons();
        if (!token) return;

        let name = 'Người dùng';
        let serverRole = 'user';

        if (token === ADMIN_TOKEN) {
            name = 'Admin';
            serverRole = 'admin';
            localStorage.setItem('role', 'admin');
        } else {
            try {
                const res = await fetch('/api/me', { headers: { 'Authorization': 'Bearer ' + token }});
                if (!res.ok) { 
                    showAuthButtons(); 
                    return; 
                }
                const data = await res.json();
                serverRole = (data && (data.role || (data.user && data.user.role))) ? (data.role || data.user.role) : 'user';
                name = (data && data.user && data.user.name) ? data.user.name : 'Người dùng';
                localStorage.setItem('role', serverRole);
            } catch (err) {
                console.error(err);
                showAuthButtons();
                return;
            }
        }

        if (document.querySelector('.login-btn')) {
            document.querySelector('.login-btn').style.display = 'none';
        }
        if (document.querySelector('.register-btn')) {
            document.querySelector('.register-btn').style.display = 'none';
        }

        userArea.innerHTML = `
            <span>Xin chào <strong style="color:white;">${name}</strong></span>
            <button id="logout" class="logout-btn"><i class="fa-solid fa-right-from-bracket"></i> Đăng xuất</button>
        `;
        const logoutEl = document.getElementById('logout');
        wireLogoutAndNav(logoutEl);

        // Thêm nút Admin nếu là admin
        if (serverRole === 'admin') {
            const adminBtn = document.createElement('button');
            adminBtn.className = 'nav-btn';
            adminBtn.id = 'btnAdmin';
            adminBtn.innerHTML = '<i class="fa-solid fa-user-shield"></i> Quản Trị';
            adminBtn.addEventListener('click', () => { 
                window.location.href = 'admin.html?page=admin'; 
            });
            navButtons.appendChild(adminBtn);
        }

        // Active state
        const params = new URLSearchParams(window.location.search);
        const page = params.get('page') || 'home';
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        const idMap = { home: 'btnHome', path: 'btnPath', progress: 'btnProgress', admin: 'btnAdmin' };
        const btnId = idMap[page];
        if (btnId) {
            const el = document.getElementById(btnId);
            if (el) el.classList.add('active');
        }
    }

    // Load top categories
    async function loadTopCategories() {
        try {
            const res = await fetch('/api/categories/top', {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                }
            });

            if (!res.ok) throw new Error('Failed to load categories');
            
            const categories = await res.json();
            const grid = document.getElementById('categoriesGrid');
            
            categories.forEach((cat) => {
                // Tìm color scheme theo tên category, nếu không có thì dùng default
                const colorScheme = categoryColors[cat.name] || categoryColors['default'];
                const card = document.createElement('div');
                card.className = 'category-card';
                card.onclick = () => {
                    window.location.href = `main_category.html?category=${encodeURIComponent(cat.id)}`;
                };
                
                card.innerHTML = `
                    <div class="category-icon" style="background: ${colorScheme.bg};">
                        <i class="fa-solid ${colorScheme.icon}"></i>
                    </div>
                    <h3 class="category-name">${cat.name}</h3>
                    <p class="category-desc">${cat.description}</p>
                    <div class="category-stats">
                        <span class="category-count">${cat.roadmap_count}+ lộ trình</span>
                        <button class="category-btn">Xem chi tiết</button>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        } catch (err) {
            console.error('Error loading categories:', err);
        }
    }

    loadUser();
    loadTopCategories();

    document.getElementById('startNowBtn').addEventListener('click', () => { 
            const token = localStorage.getItem('token');
             if (!token) {
                alert('Vui lòng đăng nhập!');
                window.location.href = 'login.html';
             }else {
            window.location.href = 'path.html';
             }
    });

</script>
<script src="footer.js"></script>
</body>
</html>



